(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{d109cf62f75337f82f82:function(s,n){s.exports='<h2 id=\u4e3a\u4ec0\u4e48\u4f7f\u7528make>\u4e3a\u4ec0\u4e48\u4f7f\u7528make</h2> <p>\u5728\u9879\u76ee\u4e2d\u90e8\u7f72\u4f7f\u7528\u4e86makefile\u914d\u7f6e,\u6765\u65b9\u4fbf\u5feb\u901f\u7684\u6267\u884c\u4e00\u4e9b\u5de5\u4f5c\u6d41</p> <p>\u76f8\u6bd4\u4e8e\u5176\u5b83task runner\uff0cmake\u7684\u4f18\u52bf\u662f\u4e0d\u9700\u8981\u5b89\u88c5\uff0c\u6240\u6709\u7cfb\u7edf\u5f53\u524d\u90fd\u5df2\u7ecf\u9884\u7f6e</p> <p>\u65b9\u4fbf\uff0c\u662f\u6700\u5927\u7684\u539f\u56e0</p> <p>\u76ee\u524d\u4f7f\u7528\u7684makefile\u5982\u4e0b\uff1a</p> <pre class=hljs><code class=language-makefile>GREEN=\\033[0;32m\nNC=\\033[0m\nINSTALL_DIR=/usr/local/public\nPUBLIC=./public\nHOST=10.1.101.60\nTARFILE=assets.tar.bz2\nHASHFILE=assets.hash.txt\n\n<span class=hljs-section>.ONESHELL:</span>\n\n<span class=hljs-section>default:</span>\n    @cat ReadMe\n\n<span class=hljs-section>zddi:</span>\n    @rm -rf public/assets/*\n    @./yarn run build\n\n<span class=hljs-section>watch:</span>\n    @./yarn watch\n\n<span class=hljs-section>build-system:</span>\n    @./yarn --offline\n\n<span class=hljs-section>rebuild-system:</span>\n    @./yarn cache clean\n    @rm -rf node_modules\n    @rm -f yarn.lock\n    @./yarn\n\n<span class=hljs-section>tar:</span>\n    @cd ${PUBLIC} ;\\\n    tar jcf ${TARFILE} assets\n\n<span class=hljs-section>rmtar:</span>\n    @cd ${PUBLIC} ;\\\n    rm ${TARFILE}\n\n<span class=hljs-section>commit: tar</span>\n    @-cd ${PUBLIC} ;\\\n    SHASUM=<span class=hljs-variable>$(<span class=hljs-built_in>shell</span> shasum ${PUBLIC}/${TARFILE} | awk \'{print $$1}\')</span> ;\\\n    echo $${SHASUM} &gt; ${HASHFILE} ;\\\n    git add ${HASHFILE} ;\\\n    git commit -nm <span class=hljs-string>"create checksum commit HASH: [$${SHASUM}]"</span> ;\n\n<span class=hljs-section>upload: commit</span>\n    @cd ${PUBLIC} ;\\\n    SHASUM=<span class=hljs-variable>$(<span class=hljs-built_in>shell</span> shasum ${PUBLIC}/${TARFILE} | awk \'{print $$1}\')</span> ;\\\n    COMMIT=<span class=hljs-variable>$(<span class=hljs-built_in>shell</span> git log -1 --pretty=format:%H)</span> ;\\\n    BRANCH=<span class=hljs-variable>$(<span class=hljs-built_in>shell</span> git rev-parse --abbrev-ref HEAD)</span> ;\\\n    curl -X POST http://${HOST}/api/web_build/upload \\\n -F hash=$${SHASUM} \\\n -F user=<span class=hljs-variable>$(<span class=hljs-built_in>shell</span> git config --get user.name)</span> \\\n -F commit=$${COMMIT} \\\n -F branch=$${BRANCH} \\\n -F assets=@./${TARFILE}\n\n<span class=hljs-section>push: zddi upload rmtar</span>\n\n<span class=hljs-section>download:</span>\n    @cd ${PUBLIC} ;\\\n    curl http://${HOST}/api/web_build/<span class=hljs-variable>$(<span class=hljs-built_in>shell</span> cat ${PUBLIC}/${HASHFILE})</span> &gt; ${TARFILE}\n\n<span class=hljs-section>install: download</span>\n    @rm -rf ${PUBLIC}/assets\n    @cd ${PUBLIC} ;\\\n    tar jxf ${TARFILE}\n    @rm -rf ${INSTALL_DIR}\n    @cp -r ${PUBLIC} /usr/local/\n    @rm -rf ${PUBLIC}/assets\n    @rm ${PUBLIC}/${TARFILE}\n    @rm /usr/local/${PUBLIC}/${TARFILE}\n    @echo -e <span class=hljs-string>"Install public folder to ${GREEN}${INSTALL_DIR}${NC}"</span>\n\n<span class=hljs-section>pull: download</span>\n    @rm -rf ${PUBLIC}/assets\n    @cd ${PUBLIC} ;\\\n    tar jxf ${TARFILE}\n    @rm ${PUBLIC}/${TARFILE}\n    @echo -e <span class=hljs-string>"${GREEN}Code pull from remote done!${NC}"</span>\n\n</code></pre><h3 id=\u5b9a\u4e49\u53d8\u91cf>\u5b9a\u4e49\u53d8\u91cf</h3> <p>makefile \u4e2d\u7684\u53d8\u91cf\u5b9a\u4e49\u548cshell\u4e2d\u4e00\u6837\uff0c\u90fd\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528</p> <pre class=hljs><code class=language->abc = 123\nbcd += ddd\ncc := f2</code></pre><h4 id=shel\u4e2d\u7684\u53d8\u91cf>shel\u4e2d\u7684\u53d8\u91cf</h4> <p>\u7531\u4e8emakefile\u4e2d\u7684\u53d8\u91cf\u548cshell\u683c\u5f0f\u4e00\u6837\uff0c\u6240\u4ee5\u5f53\u8981\u4f7f\u7528shell\u53d8\u91cf\u65f6\uff0c \u4f1a\u9700\u8981\u4f7f\u7528\u8f6c\u4e49\u5e8f\u5217\u6765\u5904\u7406\uff0c\u65b9\u5f0f\u662f\u4e24\u4e2a<code>$</code>\u7b26\u53f7</p> <h3 id=shell>shell</h3> <p>makefile \u4e2d\u7684shell\u4f7f\u7528\u9700\u8981\u6ce8\u610f\uff0c\u6bcf\u4e00\u884c\u90fd\u4f1a\u542f\u52a8\u4e00\u4e2ashell\uff0c\u5355\u72ec\u8fd0\u884c \u5f53\u8c03\u7528shell\u8fdb\u884c\u63d2\u503c\u7684\u65f6\u5019\uff0cshell\u7684\u6267\u884c\u987a\u5e8f\u4e5f\u4e0d\u662f\u987a\u5e8f\u6267\u884c\u7684</p> <p>\u7531\u4e8e\u90fd\u662f\u4f7f\u7528\u5355\u72ec\u7684shell\uff0c\u6240\u4ee5\u5f53\u60f3\u8981\u4f7f\u7528\u76f8\u540c\u7684\u4e0a\u4e0b\u6587\u65f6\uff0c \u53ef\u4ee5\u4f7f\u7528<code>.ONESHELL</code>\u6307\u4ee4\u8bbe\u7f6e\uff0c\u6216\u8005\u662f\u8f6c\u4e49\u6362\u884c\u7b26</p> <h3 id=\u8fde\u7eed\u7684task>\u8fde\u7eed\u7684task</h3> <p>\u7531\u4e8emakefile\u4e2dshell\u65e0\u6cd5\u8fde\u7eed\u6267\u884c\uff0c\u6240\u4ee5\uff0c\u5c06task\u62c6\u5206\u6210\u591a\u4e2a\uff0c\u7136\u540e\u901a\u8fc7task\u4f9d\u8d56\u5173\u7cfb\u987a\u5e8f\u6267\u884c</p> <p>task\u4f9d\u8d56\uff0c\u5728task\u540e\u8f93\u5165\u5176\u5b83\u7684task\u540d\u79f0\uff0c\u5c31\u4f1a\u6309\u7167\u987a\u5e8f\uff0c\u8fde\u7eed\u6267\u884c\u8fd9\u4e9btask</p> <p>\u5f53\u51fa\u73b0\u9519\u8bef\uff0ctask\u961f\u5217\u4f1a\u4e2d\u65ad\uff0c\u8fd9\u65f6\u9700\u8981\u5728shell\u5f00\u59cb\u7684\u884c\u6dfb\u52a0\u4e00\u4e2a<code>-</code>\u6765\u7ee7\u7eed\u6267\u884ctask</p> '}}]);