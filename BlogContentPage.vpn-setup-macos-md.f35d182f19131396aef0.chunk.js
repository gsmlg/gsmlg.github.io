(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{"./app/data/blogs/vpn-setup-macos.md":function(s,n){s.exports='<h2 id=-macos-vpn>为macOS配置VPN</h2> <h3 id=-vpn->配置VPN服务器</h3> <p>搭建vpn服务</p> <p>从系统仓库 安装<code>ipsec</code> 安装<code>xl2tpd</code></p> <p>在服务器上启动服务</p> <p>配置好服务账户</p> <pre class=hljs><code class="language-undefined">systemctl restart<span class=hljs-built_in> ipsec\n</span>systemctl restart xl2tpd</code></pre><h3 id=-vpn-client>配置VPN Client</h3> <p>从<code>Mac App Store</code>安装<code>Apple Configurator 2</code></p> <p>创建VPN描述文件</p> <p>选择<code>l2tp</code>协议 配置<em>服务器地址、用户名、密码和共享密钥</em></p> <p>把描述文件安装到<code>macOS</code>的系统配置，<code>iOS</code>通过<code>airDrop</code>安装</p> <p>安装完成即可连接vpn</p> <h3 id=-macos-vpn->配置macOS在VPN连接时的路由表</h3> <p>使用<code>[static-routes][https://github.com/gsmlg/static-routes]</code>的配置</p> <p>路由表数据时使用maxmine公开的geoip数据库来进行配置</p> <p>在<code>/etc/ppp/</code>目录配置<code>ip-up</code>,<code>ip-down</code>对应在VPN启动和停止时执行对应脚本</p> <p>脚本中可以使用变量说明</p> <pre class=hljs><code class="language-undefined"><span class=hljs-variable>$1</span><span class=hljs-built_in> interface </span>etc: ppp0\n<span class=hljs-variable>$2</span> none?\n<span class=hljs-variable>$3</span> ? 0\n<span class=hljs-variable>$4</span><span class=hljs-built_in> client ip\n</span><span class=hljs-variable>$5</span> remote<span class=hljs-built_in> ip\n</span><span class=hljs-variable>$6</span> local gateway</code></pre><h3 id=-vpn>命令行中控制VPN</h3> <pre class=hljs><code class="language-undefined">VPN connections\n\nUsage: scutil --nc [command]\n\n    list\n        List available<span class=hljs-built_in> network connection </span>services <span class=hljs-keyword>in</span> the current <span class=hljs-builtin-name>set</span>\n\n    status &lt;service&gt;\n        Indicate whether a given<span class=hljs-built_in> service </span>is connected, as well as extended status information <span class=hljs-keyword>for</span> the<span class=hljs-built_in> service\n</span>\n    show &lt;service&gt;\n        Display configuration information <span class=hljs-keyword>for</span> a given<span class=hljs-built_in> service\n</span>\n    statistics &lt;service&gt;\n        Provide statistics on bytes, packets, <span class=hljs-keyword>and</span> errors <span class=hljs-keyword>for</span> a given<span class=hljs-built_in> service\n</span>\n    select &lt;service&gt;\n        Make the given<span class=hljs-built_in> service </span>active <span class=hljs-keyword>in</span> the current set. This allows it <span class=hljs-keyword>to</span> be started\n\n    start &lt;service&gt; [--user user] [--password password] [--secret secret]\n        Start a given service. Can take optional arguments <span class=hljs-keyword>for</span> user, password, <span class=hljs-keyword>and</span><span class=hljs-built_in> secret\n</span>\n    stop &lt;service&gt;\n        Stop a given<span class=hljs-built_in> service\n</span>\n    suspend &lt;service&gt;\n        Suspend a given<span class=hljs-built_in> service </span>(PPP, Modem on Hold)\n\n    resume &lt;service&gt;\n        Resume a given<span class=hljs-built_in> service </span>(PPP, Modem on Hold)\n\n    ondemand [-W] [hostname]\n    ondemand -- --refresh\n        Display VPN on-demand information\n\n    trigger &lt;hostname&gt; [background] [port]\n        Trigger VPN on-demand with specified hostname, <span class=hljs-keyword>and</span> optional<span class=hljs-built_in> port </span><span class=hljs-keyword>and</span> background flag\n\n    enablevpn &lt;service <span class=hljs-keyword>or</span> vpn type&gt; [path]\n        Enables the given VPN application type. Takes either a<span class=hljs-built_in> service </span><span class=hljs-keyword>or</span> VPN type. Pass a path <span class=hljs-keyword>to</span> <span class=hljs-builtin-name>set</span> ApplicationURL\n\n    disablevpn &lt;service <span class=hljs-keyword>or</span> vpn type&gt;\n        Disables the given VPN application type. Takes either a<span class=hljs-built_in> service </span><span class=hljs-keyword>or</span> VPN<span class=hljs-built_in> type\n</span>\n    help\n        Display available commands <span class=hljs-keyword>for</span> --nc\n</code></pre>'}}]);