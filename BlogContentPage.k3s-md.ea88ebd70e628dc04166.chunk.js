(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{"16dc0d4efb5ad4395fef":function(l,e,i){"use strict";i.r(e),e.default=i.p+"c9941fd66590c7308bd03dc0d067298e.png"},"2132df9c4e85a2771191":function(l,e,i){"use strict";i.r(e),e.default=i.p+"60dfbaaadc75990c3cc3a19dad563a13.png"},"22bbd12c85d836da70ae":function(l,e,i){"use strict";i.r(e),e.default=i.p+"17d0ed11a72299344333aebc954c324b.png"},"2488d5ff1d1878f9455f":function(l,e,i){"use strict";i.r(e),e.default=i.p+"10eec311b063fcd1465550cf597ce84d.png"},"25d5adabd4a6475f78c5":function(l,e,i){"use strict";i.r(e),e.default=i.p+"b5f8aae534469bac7850f84a92c172f0.png"},"395beddd1ade924f5f35":function(l,e,i){"use strict";i.r(e),e.default=i.p+"bcf2e6e48726d68dee5dca5a99ca99be.png"},"4425f3cedd84243ff501":function(l,e,i){"use strict";i.r(e),e.default=i.p+"9e8a7fa83db882d7a913e2f666b9a9b1.png"},"48db18e6a0b9d2828130":function(l,e,i){"use strict";i.r(e),e.default=i.p+"b63c1c1d269651ebbc54bf079714a9e1.png"},"48e656c7bc1daf78e88f":function(l,e,i){"use strict";i.r(e),e.default=i.p+"c1ef4677a3a3a8b6bb0ece341bcbcd45.png"},"5620f12a2578743dfca7":function(l,e,i){"use strict";i.r(e),e.default=i.p+"056b25b852a2f944f47464643557fad9.png"},"576cd1537c41e91748c0":function(l,e,i){"use strict";i.r(e),e.default=i.p+"718befb163aa32a40313d0004c76fcaa.png"},"5b8a5b95e379efe60ed2":function(l,e,i){"use strict";i.r(e),e.default=i.p+"24da19c1a1e515d592bb27537860294b.png"},"609e8ab7fce783ca7763":function(l,e,i){var a=i("302492d1afd5e0e000f5"),c=i("48db18e6a0b9d2828130"),s=i("6648c2400f74d21b732f"),t=i("5b8a5b95e379efe60ed2"),r=i("c1ac4a4baa1015af129b"),d=i("f988a40abbd814ab95f8"),p=i("395beddd1ade924f5f35"),n=i("beae2b273ce7d94d24fd"),o=i("b3c7f79f8966b8d94c72"),f=i("2132df9c4e85a2771191"),u=i("f8619b261daca4e4e633"),h=i("2488d5ff1d1878f9455f"),b=i("576cd1537c41e91748c0"),g=i("4425f3cedd84243ff501"),k=i("9761f48e785b39fd4bbc"),m=i("b76b07ea8c7189ac0e8c"),v=i("5620f12a2578743dfca7"),C=i("e0267d30eff98a9ea578"),D=i("25d5adabd4a6475f78c5"),S=i("22bbd12c85d836da70ae"),K=i("16dc0d4efb5ad4395fef"),P=i("fc302cb7754df2fa2a92"),w=i("48e656c7bc1daf78e88f"),I=i("dce181ab8ec2fbc18c60"),j=i("d1fb8d66e3d18d560727"),L="<h3 id=\u4ec0\u4e48\u662fk3s\uff1f>\u4ec0\u4e48\u662fk3s\uff1f</h3> <p>k3s\u662f\u5fae\u578b\u7684kubernetes\u53d1\u884c\u7248\u672c</p> <ol> <li>CNCF\u8ba4\u8bc1\u7684Kubernetes\u53d1\u884c\u7248</li> <li>50MB\u5de6\u53f3\u4e8c\u8fdb\u5236\u5305\uff0c500MB\u5de6\u53f3\u5185\u5b58\u6d88\u8017</li> <li>\u5355\u4e00\u8fdb\u7a0b\u5305\u542bKubernetes master, Kubelet, \u548c containerd </li> <li>\u652f\u6301SQLite/Mysql/PostgreSQL/DQlite\u548cetcd</li> <li>\u540c\u65f6\u4e3ax86_64, Arm64, \u548c Armv7 \u5e73\u53f0\u53d1\u5e03</li> </ol> <h3 id=k3s-\u57fa\u672c\u67b6\u6784>k3s \u57fa\u672c\u67b6\u6784</h3> <h4 id=\u6574\u4f53\u67b6\u6784>\u6574\u4f53\u67b6\u6784</h4> <h5 id=\u90e8\u7f72\u67b6\u6784>\u90e8\u7f72\u67b6\u6784</h5> <p><img src="+a(c)+" alt=cc737ff7270d834dd8ca3e6efcc4509b.png></p> <p>\u8f7b\u91cf\u5316</p> <p>\u76f8\u6bd4k8s \u79fb\u9664</p> <ul> <li>\u5220\u9664\u65e7\u7684\u548c\u975e\u5fc5\u8981\u7684\u7ec4\u4ef6</li> <li>alpha feature</li> <li>In-tree cloud providers</li> <li>In-tree storage strivers</li> <li>Docker (optional)</li> </ul> <p>\u589e\u52a0</p> <ul> <li>\u7b80\u5355\u7684\u5b89\u88c5</li> <li>etcd\u9ed8\u8ba4\u4f7f\u7528SQLite\u505a\u6570\u636e\u6e90</li> <li>TLS\u7ba1\u7406</li> <li>\u81ea\u52a8helm chart\u7ba1\u7406</li> <li>containerd\u3001cordons\u3001Flannel\u96c6\u6210</li> </ul> <h5 id=k3s-\u4ee3\u7801\u7ed3\u6784>k3s \u4ee3\u7801\u7ed3\u6784</h5> <p><img src="+a(s)+" alt=d7fece440f1c3f7c3a4333c3c924ebfd.png></p> <p>\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ul> <li>contaienrd\u662f\u72ec\u7acb\u8fdb\u7a0b\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528docker</li> <li>Tunnel Proxy \u8d1f\u8d23\u7ef4\u62a4 k3s server \u548c k3s agent \u4e4b\u95f4\u7684\u94fe\u63a5\uff0c\u91c7\u7528Basic Auth\u7684\u65b9\u5f0f\u6765\u8fdb\u884c\u8ba4\u8bc1</li> </ul> <h5 id=demo>Demo</h5> <p>k3s \u8fdb\u7a0b</p> <ul> <li>server</li> </ul> <p># 6443 k3s server, 6444 api-server</p> <ul> <li>agent</li> </ul> <pre class=hljs><code class=language-><span class=hljs-attribute>pstree</span> -p -aT <span class=hljs-variable>$pid</span>\nps -T <span class=hljs-variable>$pid</span></code></pre><h5 id=\u53c2\u8003\u94fe\u63a5>\u53c2\u8003\u94fe\u63a5</h5> <ul> <li><a href=https://mp.weixin.qq.com/s/1o9X0Dlv2WhUS6iC9P-KQA>k3s \u4ee3\u7801\u7ec4\u7ec7\u7ed3\u6784\u5206\u6790\u53c2\u8003</a></li> <li><a href=https://mp.weixin.qq.com/s/V-VyWrCZux5WXxD__QpEWQ>k3s \u90e8\u7f72\u53c2\u8003</a></li> <li><a href=https://mp.weixin.qq.com/s/5aprEfYSWJyVoW4trDp4Hw>k3s \u4e3a\u4f55\u8f7b\u91cf</a></li> </ul> <h4 id=k3s\u7684\u9ad8\u53ef\u7528\u67b6\u6784>k3s\u7684\u9ad8\u53ef\u7528\u67b6\u6784</h4> <p><img src="+a(t)+" alt=efddb62fd824b694d539d686cbdf5cbd.png></p> <p><img src="+a(r)+" alt=01a39ea3b8684c5889e69a1c625e8a95.png></p> <p><img src="+a(d)+" alt=983420ce2dbc3d812c68639fae050dee.png></p> <h5 id=\u9ad8\u53ef\u7528---\u5916\u7f6e\u6570\u636e\u5e93>\u9ad8\u53ef\u7528 - \u5916\u7f6e\u6570\u636e\u5e93</h5> <ul> <li>PostgreSQL (v10.7\u3001v11.5) \xfc </li> <li>MySQL (v5.7)</li> <li>etcd (v3.3.15)</li> </ul> <p>\u5b9e\u73b0\u65b9\u5f0f\uff1a rancher/kine</p> <p><img src="+a(p)+" alt=fb719eff62e7da623289c06cf66e9f2e.png></p> <h5 id=\u9ad8\u53ef\u7528---\u5206\u5e03\u6570\u636e\u5e93>\u9ad8\u53ef\u7528 - \u5206\u5e03\u6570\u636e\u5e93</h5> <p><strong>SQLite</strong></p> <ul> <li>\u8f6f\u4ef6\u5e93\uff0c\u65e0\u72ec\u7acb\u8fdb\u7a0b:C \u8bed\u8a00\u7f16\u5199</li> <li>\u96f6\u7ba1\u7406\u914d\u7f6e:\u4e0d\u9700\u8981\u670d\u52a1\u7ba1\u7406\u8fdb\u7a0b</li> <li>\u4e8b\u52a1\u5b89\u5168:\u517c\u5bb9ACID\uff0c\u53ef\u5e76\u53d1\u8bbf\u95ee</li> <li>\u6807\u51c6SQL\u652f\u6301</li> <li>\u5355\u4e00\u78c1\u76d8\u6587\u4ef6</li> </ul> <p>k3s\u9ed8\u8ba4\u4f7f\u7528 <code>/var/lib/rancher/k3s/server/db/state.db</code></p> <p><strong>Dqlite</strong></p> <ul> <li>\u8f6f\u4ef6\u5e93\uff0c\u65e0\u72ec\u7acb\u8fdb\u7a0b:C \u8bed\u8a00\u7f16\u5199</li> <li>\u5206\u5e03\u5f0f\u4e00\u81f4:C-Raft \u5b9e\u73b0</li> <li>\u517c\u5bb9 SQLite</li> </ul> <p>Dqlite \u539f\u7406</p> <ul> <li>\u4e00\u4e2ak3sserver\u8fdb\u7a0b\u5185\u542bSQL\u7684client\u7ec4 \u4ef6\u548c server \u7ec4\u4ef6</li> <li>client \u4ec5\u8fde\u63a5\u4e00\u4e2a server</li> <li>server \u94fe\u63a5 SQLite \u8f6f\u4ef6\u5e93</li> <li>\u5947\u6570\u4e2ak3sserver\u8fdb\u7a0b</li> <li>client \u9700\u8fde\u63a5\u6240\u6709 server</li> <li>server \u94fe\u63a5 Dqlite \u8f6f\u4ef6\u5e93</li> <li>server \u901a\u8fc7 C-Raft \u6765\u9009\u4e3b</li> <li>client \u53d1\u73b0 \u4e3b server</li> <li>client \u628a\u8bf7\u6c42\u90fd\u53d1\u9001\u5230\u4e3b server</li> <li>\u4e3bserver\u901a\u8fc7C-Raft\u7ed9\u4eceserver\u53d1\u9001\u5dee\u5206\u65e5\u5fd7\u4f5c\u4e3a\u6570\u636e\u540c\u6b65</li> </ul> <p><img src="+a(n)+" alt=e8387ec04f8c4c9843d12e1c2c5659fb.png></p> <h5 id=\u53c2\u8003\u94fe\u63a5-1>\u53c2\u8003\u94fe\u63a5</h5> <ul> <li><a href=https://www.runoob.com/sqlite/sqlite-commands.html>SQLite \u57fa\u7840\u547d\u4ee4</a></li> <li><a href=https://github.com/mattn/go-sqlite3>SQLite Go\u8bed\u8a00\u9a71\u52a8\u5b9e\u73b0</a></li> <li><a href=https://books.studygolang.com/advanced-go-programming-book/ch2-cgo/ch2-06-static-shared-lib.html>CGO\u7684\u52a8\u9759\u6001\u94fe\u63a5\u4ecb\u7ecd</a></li> <li><a href=https://fosdem.org/2020/schedule/event/dqlite/ >Dqlite \u8bb2\u89e3</a></li> <li><a href=https://raft.github.io/ >Raft \u534f\u8bae\u4ecb\u7ecd</a></li> <li><a href=https://mp.weixin.qq.com/s/3by95UIJ7v41KXElt7uvGA>k3s \u793e\u533a\u9ad8\u53ef\u7528\u4ecb\u7ecd</a></li> </ul> <h4 id=containerd>Containerd</h4> <p><code>Containerd</code>\u7684\u8bbe\u8ba1\u76ee\u7684\u662f\u5d4c\u5165\u66f4\u5927\u7684\u7cfb\u7edf</p> <p>Docker\u7684\u5386\u53f2</p> <ul> <li>1.8 \u4e4b\u524d:docker -d - 2015\u5e74\uff0cOCI \u6210\u7acb</li> <li>1.8 - 1.11:docker daemon - runtime-spec \u5236\u5b9a</li> <li>1.11\u4ee5\u540e:docker\u3001dockerd - libcontainer -&gt; runC</li> <li>dockerd = docker engine + containerd + containerd-shim + runC</li> </ul> <p><img src="+a(o)+" alt=a558aca87f7a8679d9fe1a2da820ec21.png></p> <p><img src="+a(f)+" alt=5471d6d59bbe3ba83a514e23af38dcef.png></p> <p><img src="+a(u)+" alt=1c7a968cb544086aaaa167819a26a1b0.png></p> <p><img src="+a(h)+" alt=33bede9601ebd8546cd7de980cc55135.png></p> <p><img src="+a(b)+' alt=1cc7615d71efe2799e6bbcd38bb3d718.png></p> <p><strong>\u64cd\u4f5c</strong></p> <p>|\u955c\u50cf\u64cd\u4f5c|Docker|ContainerD| |:---|:---|:---|:---| |\u672c\u5730\u955c\u50cf\u5217\u8868 |docker images |crictl images| ctr images list |\u4e0b\u8f7d\u955c\u50cf| docker pull | crictl pull| ctr (images) pull |\u4e0a\u4f20\u955c\u50cf |docker push | |ctr (images) push |\u5220\u9664\u672c\u5730\u955c\u50cf |docker rmi |crictl rmi |ctr images remove |\u6807\u8bb0\u672c\u5730\u955c\u50cf |docker tag | | ctr (images) tag |\u955c\u50cf\u8be6\u60c5|docker inspect|crictl inspecti |\u5bb9\u5668\u5217\u8868 |docker ps |crictl ps |ctr containers list |\u521b\u5efa\u5bb9\u5668 |docker create |crictl create |ctr containers create |\u8fd0\u884c\u5bb9\u5668 |docker start |crictl start |ctr (tasks) start |\u505c\u6b62\u5bb9\u5668 |docker stop |crictl stop |ctr (tasks) pause |\u5220\u9664\u5bb9\u5668 |docker rm |crictl rm |ctr (tasks) rm |\u5bb9\u5668\u8be6\u60c5 |docker inspect |crictl inspect |\u8fde\u63a5\u5bb9\u5668 |docker attach |crictl attach |ctr (tasks) attach |\u5bb9\u5668\u5185\u64cd\u4f5c |docker exec |crictl exec |ctr (tasks) exec |\u5bb9\u5668\u65e5\u5fd7 |docker logs |crictl logs |\u5bb9\u5668\u72b6\u6001 |docker stats |crictl stats |\u663e\u793aPOD\u5217\u8868 ||crictl pods |\u67e5\u770bPOD\u8be6\u60c5 ||crictl inspectp |\u8fd0\u884cPOD ||crictl runp |\u505c\u6b62POD ||crictl stopp |\u5220\u9664POD ||crictl rmp |\u8f6c\u53d1\u7aef\u53e3\u5230POD ||crictl port-foward</p> <p>k3s \u5185\u7f6econtainerd</p> <ul> <li>ctr : \u5355\u7eaf\u7684\u5bb9\u5668\u7ba1\u7406</li> <li>crictl : \u4ece Kubernetes\u89c6\u89d2\u51fa\u53d1\uff0c\u5bf9POD\u3001\u5bb9\u5668\u8fdb\u884c\u7ba1\u7406</li> </ul> <p>k3s \u4fee\u6539containerd\u914d\u7f6e \u4fee\u6539<code>/var/lib/rancher/k3s/agent/etc/containerd/config.toml</code>\u540c\u76ee\u5f55\u4e0b<code>config.toml.tmpl</code>\u6587\u4ef6\uff0c\u91cd\u542fk3s</p> <p>contaienrd\u65e5\u5fd7 <code>/var/lib/rancher/k3s/agent/containerd/containerd.log</code></p> <h5 id=\u53c2\u8003\u94fe\u63a5-2>\u53c2\u8003\u94fe\u63a5</h5> <ul> <li><a href=https://zhuanlan.zhihu.com/p/87602649>cri\u7684\u6f14\u8fdb\u53f2</a></li> <li><a href=https://www.infoq.cn/article/docker-standard-container-execution-engine-runc>runC\u7684\u4ecb\u7ecd</a></li> <li><a href=https://mp.weixin.qq.com/s/EJqS7G36f7_srgxSZaCuPw>k3s \u793e\u533a Containerd \u4f7f\u7528\u4ecb\u7ecd</a></li> <li><a href=https://github.com/kubernetes-sigs/cri-tools/blob/master/docs/crictl.md>crictl \u57fa\u672c\u64cd\u4f5c</a></li> <li><a href=https://github.com/containerd/cri/blob/master/docs/config.md>Containerd CNI\u63d2\u4ef6\u914d\u7f6e\u4ecb\u7ecd</a></li> </ul> <h3 id=k3s\u62d3\u5c55\u529f\u80fd\u6982\u89c8>k3s\u62d3\u5c55\u529f\u80fd\u6982\u89c8</h3> <h4 id=helm-controller>Helm Controller</h4> <ul> <li>k3s Helm Controller\u540c\u65f6\u652f\u6301v2\u4e0ev3\u7248\u672c<ul> <li>\u4ecev1.17.0+k3s1 or above\u9ed8\u8ba4\u4f7f\u7528helm_v3</li> </ul> </li> <li>Helm v2 vs Helm v3<ul> <li>\u79fb\u9664\u4e86Tiller(from SA to kubeconfig)</li> <li>\u4e09\u65b9\u4f1a\u8c08 (Three-way Strategic merge patch)</li> <li>\u4f7f\u7528Secret\u4f5c\u4e3a\u9ed8\u8ba4\u5b58\u50a8</li> <li>crd-install hook\u8fc1\u79fb\u5230\u4e86crds/\u8def\u5f84\u7b49...</li> </ul> </li> <li>Helm Controller\u7684\u4f18\u52bf<ul> <li>\u66f4\u65b9\u4fbf\u7684\u7528\u6237\u4f53\u9a8c</li> <li>HelmChart CRD \u53ef\u4ee5\u652f\u6301\u66f4\u4e30\u5bcc\u7684\u62d3\u5c55 </li> </ul> </li> </ul> <p><strong>\u8bbe\u8ba1\u539f\u7406</strong></p> <ol> <li>Helm-controller \u8fd0\u884c\u5728master\u8282\u70b9\u5e76list/watch HelmChart CRD\u5bf9\u8c61</li> <li>CRD onChange\u65f6\u6267\u884cJob\u66f4\u65b0</li> <li>Job Container\u4f7f\u7528rancher/kilipper-helm\u4e3aentrypoint</li> <li>Killper-helm\u5185\u7f6ehelm cli\uff0c\u53ef\u4ee5\u5b89\u88c5/\u5347\u7ea7/\u5220\u9664\u5bf9\u5e94\u7684chart</li> </ol> <pre class=hljs><code class=language-yaml><span class=hljs-attr>apiVersion:</span> <span class=hljs-string>helm.cattle.io/v1</span>\n<span class=hljs-attr>kind:</span> <span class=hljs-string>HelmChart</span>\n<span class=hljs-attr>metadata:</span>\n  <span class=hljs-attr>name:</span> <span class=hljs-string>traefik</span>\n  <span class=hljs-attr>namespace:</span> <span class=hljs-string>kube-system</span>\n<span class=hljs-attr>spec:</span>\n  <span class=hljs-attr>chart:</span> <span class=hljs-string>stable/traefik</span>\n  <span class=hljs-attr>set:</span>\n    <span class=hljs-attr>rbac.enabled:</span> <span class=hljs-string>"true"</span>\n    <span class=hljs-attr>ssl.enabled:</span> <span class=hljs-string>"true"</span></code></pre><ul> <li>K3s\u4f1a\u81ea\u52a8\u90e8\u7f72\u5728/var/lib/rancher/k3s/server/manifests\u8def\u5f84\u4e0b\u7684HelmChart</li> <li>\u901a\u8fc7HelmChart CRD\u90e8\u7f72\u7684chart\u662f\u517c\u5bb9helm v3 CLI\u7684</li> <li>\u5728k3s\u4e2d\u7ba1\u7406\u548c\u90e8\u7f72Helm\u5e94\u7528</li> </ul> <p>\u76f8\u5173\u5de5\u5177\u5305 - rancher/helm-controller - rancher/kilipper-helm</p> <h4 id=traefik-lb>Traefik LB</h4> <p>K3s\u652f\u6301\u6a21\u5757\u5316\u7684\u5f00\u542f\u6216\u5173\u95ed\u76f8\u5173\u7ec4\u4ef6\uff0c\u4f8b\u5982Traefik LB, Scheduler, servicelb\u7b49</p> <ul> <li>curl -sfL <a href=https://get.k3s.io>https://get.k3s.io</a> | sh -s - server --no-deploy=traefik</li> <li>k3s server --no-deploy=traefik --no-deploy=servicelb</li> <li>\u4e5f\u53ef\u901a\u8fc7\u4fee\u6539k3s.service\u914d\u7f6e\u7136\u540e\u91cd\u542f\u751f\u6548</li> </ul> <h5 id=service-lb-controller\u8bbe\u8ba1\u539f\u7406>Service LB Controller\u8bbe\u8ba1\u539f\u7406</h5> <p>Service LB\u662fRancher\u9488\u5bf9k3s\u96c6\u7fa4\u800c\u8bbe\u8ba1\u7684\u4e00\u79cdservice loadbalancer controller\uff0c \u7528\u6237\u53ef\u901a\u8fc7\u5c06Service\u7684type\u7c7b\u4f3c\u914d\u7f6e\u4e3aLoadBalancer\u6765\u4f7f\u7528\u3002</p> <ol> <li>svc-controller watch\u5230service\u7c7b\u578b\u4e3aLoadBalancer\u65f6\uff0c\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a Daemonset;</li> <li>\u9ed8\u8ba4Daemonset\u4f1a\u90e8\u7f72\u5230\u6bcf\u4e2a\u8282\u70b9\uff0c\u5982\u679c\u4efb\u610fNode\u8bbe\u5b9a\u4e86label svccontroller.k3s.cattle.io/enablelb=true, \u5219\u53ea\u5728\u62e5\u6709\u8fd9\u4e2alabel\u7684node\u4e0a \u521b\u5efaDS\u7684pod;</li> <li>\u5bf9\u4e8e\u67d0\u4e2a\u90e8\u7f72\u7684\u8282\u70b9\uff0c\u4e00\u4e2aLB port\u53ea\u4f1a\u5bf9\u5e94\u4e00\u4e2aPOD\uff0c \u7aef\u53e3\u4e0d\u80fd\u91cd\u590d\u4f7f \u7528;</li> <li>\u82e5\u521b\u5efa\u5931\u8d25\u6216\u65e0\u53ef\u7528\u7aef\u53e3\u65f6\uff0cservice\u7684\u72b6\u6001\u4e3aPending</li> </ol> <h5 id=\u672c\u5730\u5b58\u50a8>\u672c\u5730\u5b58\u50a8</h5> <ul> <li><p>K3s\u9ed8\u8ba4\u6dfb\u52a0\u4e86local path provisioner</p> </li> <li><p>Local path provisioner\u662f\u57fa\u4e8eKubernetes Local Persistent Volume\u529f\u80fd\u5b9e\u73b0\u7684\u4e00\u4e2a\u672c\u5730\u52a8\u6001\u5b58\u50a8\u7ba1\u7406\u5668</p> <ul> <li>\u9ed8\u8ba4host path\u8def\u5f84\u4e3a/var/lib/rancher/k3s/storage</li> <li>\u914d\u7f6e\u6587\u4ef6\u5b58\u653e\u5728kube-system\u4e0b\u7684local-path-config configmap</li> <li>\u652f\u6301\u52a8\u6001\u521b\u5efahost path volumes</li> <li>\u4e0d\u652f\u6301capacity limit</li> </ul> </li> </ul> <h3 id=k3s\u4e0egpu\u7ed3\u5408\u4f7f\u7528>k3s\u4e0eGPU\u7ed3\u5408\u4f7f\u7528</h3> <h4 id=\u4eceai\u89c6\u89d2\u770b\u8ba1\u7b97\u7684\u4e09\u4e2a\u5c42\u6b21>\u4eceAI\u89c6\u89d2\u770b\u8ba1\u7b97\u7684\u4e09\u4e2a\u5c42\u6b21</h4> <p>\u4e91\u8ba1\u7b97:</p> <ul> <li>\u6700\u901a\u7528\u7684\u8ba1\u7b97</li> <li>\u7b97\u529b\u8981\u6c42\u9ad8\uff0c\u5b9e\u65f6\u6027\u8981\u6c42\u4f4e</li> <li>\u6267\u884c\u590d\u6742\u7684\u8ba4\u77e5\u8ba1\u7b97\u548c\u6a21\u578b\u8bad\u7ec3 \u901a\u7528\u64cd\u4f5c\u7cfb\u7edf/\u6d77\u91cfGPU\u5361</li> </ul> <p>\u8fb9\u7f18\u8ba1\u7b97</p> <ul> <li>\u8fde\u63a5\u4e91\u548c\u7aef\uff0c\u9488\u5bf9\u7aef\u505a\u7279\u5b9a \u4f18\u5316</li> <li>\u6267\u884c\u63a8\u7406\u548c\u6570\u636e\u878d\u5408\u5904\u7406 \u901a\u7528\u64cd\u4f5c\u7cfb\u7edf/\u6570\u91cf\u6709\u9650\u7684GPU\u5361/\u4e13\u4e1aAI\u82af\u7247</li> </ul> <p>\u7aef\u8ba1\u7b97</p> <ul> <li>\u573a\u666f\u76f8\u5173\u6027\u5f3a</li> <li>\u6781\u81f4\u6548\u7387\uff0c\u5b9e\u65f6\u6027\u8981\u6c42\u9ad8 </li> <li>\u4e3b\u8981\u9762\u5411\u63a8\u7406 \u5b9e\u65f6\u64cd\u4f5c\u7cfb\u7edf/\u4e13\u4e1aAI\u82af\u7247</li> </ul> <h4 id=kuberntes\u6b63\u6210\u4e3a\u673a\u5668\u5b66\u4e60\u7684\u4e3b\u6d41\u57fa\u7840\u8bbe\u65bd\u5e73\u53f0>Kuberntes\u6b63\u6210\u4e3a\u673a\u5668\u5b66\u4e60\u7684\u4e3b\u6d41\u57fa\u7840\u8bbe\u65bd\u5e73\u53f0</h4> <p><img src='+a(g)+" alt=6d49f668d0984291ed581b816a9bf39a.png></p> <p>k3s\u7684\u4f18\u52bf</p> <ul> <li>K3s\u8db3\u591f\u8f7b\u91cf\uff0c\u51cf\u5c0f\u8fb9\u7f18\u57fa\u7840\u8bbe\u65bd\u670d\u52a1\u7684\u8d44\u6e90\u5360\u7528</li> <li>K3s\u90e8\u7f72\u8fd0\u7ef4\u8db3\u591f\u7b80\u5355\uff0c\u7528\u6237\u53ef\u4ee5\u4e13\u6ce8GPU\u548c\u8ba1\u7b97\u6846\u67b6\u7684\u7ba1\u7406</li> </ul> <h4 id=docker\u5bb9\u5668\u4e2d\u7684gpu>Docker\u5bb9\u5668\u4e2d\u7684GPU</h4> <p><img src="+a(k)+' alt=63f55898dd5d0aef168da6dababbec7a.png></p> <h4 id=k3s\u4f7f\u7528gpu\u8bbe\u5907\u7684\u539f\u7406>k3s\u4f7f\u7528GPU\u8bbe\u5907\u7684\u539f\u7406</h4> <ol> <li>\u64cd\u4f5c\u7cfb\u7edf\u5b89\u88c5\u652f\u6301Nvidia Driver</li> <li>\u5b89\u88c5\u5bb9\u5668\u8fd0\u884c\u65f6\uff0c\u5e76\u5207\u6362runtime\u5230nvidia</li> <li>K8s\u901a\u8fc7gpu-device-plugin\u6765\u83b7\u53d6GPU\u8d44\u6e90\u5e76\u8bb0\u5f55\u5728k8s\u4e2d</li> <li>Pod\u901a\u8fc7\u5728k8s\u5185\u7533\u8bf7gpu\u8d44\u6e90\uff0ckubelet\u9a71 \u52a8runtime\u628a\u4e00\u5b9a\u989d\u5ea6\u7684GPU\u5361\u5206\u914d\u7ed9\u5b83</li> </ol> <pre class=hljs><code class=language-yaml><span class=hljs-attr>resources:</span>\n  <span class=hljs-attr>limits:</span>\n    <span class=hljs-attr>nvidia.com/gpu:</span> <span class=hljs-string>"1"</span></code></pre><h5 id=demo\u6f14\u793agpu>Demo\u6f14\u793aGPU</h5> <ul> <li>\u51c6\u5907GPU\u4e3b\u673a\uff0c\u5b89\u88c5cuda-drivers </li> <li>\u5b89\u88c5nvidia-docker2</li> <li>\u5b89\u88c5k3s</li> <li>\u5b89\u88c5gpu-device-plugin</li> <li>\u6d4b\u8bd5GPU workload</li> </ul> <h4 id=\u5f53\u524d\u7684\u95ee\u9898\u548c\u5c55\u671b>\u5f53\u524d\u7684\u95ee\u9898\u548c\u5c55\u671b</h4> <h5 id=\u5bb9\u5668\u4e2d\u5bf9gpu\u7684\u8d44\u6e90\u5206\u914d\u8fd8\u4e0d\u592a\u7075\u6d3b>\u5bb9\u5668\u4e2d\u5bf9GPU\u7684\u8d44\u6e90\u5206\u914d\u8fd8\u4e0d\u592a\u7075\u6d3b</h5> <ul> <li>GPU\u8d44\u6e90\u5206\u914d\u53ea\u80fd\u6574\u6570\u589e\u51cf(\u53ef\u901a\u8fc7Tensorflow\u95f4\u63a5\u7ec6\u5316\u663e\u5b58\u8d44\u6e90\u5206\u914d)</li> <li>NVIDIA docker\u4e0d\u652f\u6301vGPU(kubevirt\u865a\u62df\u5316\u65b9\u5f0f\u53ef\u652f\u6301)</li> </ul> <h5 id=ai\u573a\u666f\u4e91\u8fb9\u6587\u4ef6\u4f20\u8f93\u7684\u75db\u70b9>AI\u573a\u666f:\u4e91\u8fb9\u6587\u4ef6\u4f20\u8f93\u7684\u75db\u70b9</h5> <ul> <li>\u8fb9\u7f18AI\u8bad\u7ec3\u7279\u70b9:\u6d77\u91cf\u5c0f\u6587\u4ef6IO\u6027\u80fd\u8981\u6c42</li> <li>\u4e0e\u4e91\u7aef\u540c\u6b65\u6570\u636e\u7684\u7f51\u7edc\u5e26\u5bbd\u6d88\u8017(\u65ad\u70b9\u7eed\u4f20)</li> </ul> <h3 id=k3s\u7684iot\u573a\u666f\u7ba1\u7406>K3s\u7684IoT\u573a\u666f\u7ba1\u7406</h3> <h4 id=\u4ec0\u4e48\u662f\u8fb9\u7f18\u8ba1\u7b97>\u4ec0\u4e48\u662f\u8fb9\u7f18\u8ba1\u7b97?</h4> <p>\u8fb9\u7f18\u8ba1\u7b97\u662f\u6307\u5728\u9760\u8fd1\u667a\u80fd\u8bbe\u5907\u6216\u6570\u636e\u6e90\u5934\u7684\u4e00\u7aef\uff0c \u63d0\u4f9b<code>\u7f51\u7edc</code>\u3001 <code>\u5b58\u50a8</code>\u3001<code>\u8ba1\u7b97</code>\u3001<code>\u5e94\u7528</code>\u7b49\u80fd\u529b\uff0c \u8fbe\u5230<em>\u66f4\u5feb\u7684\u7f51\u7edc\u670d\u52a1\u54cd\u5e94\uff0c\u66f4\u5b89 \u5168\u7684\u672c\u5730\u6570\u636e\u4f20\u8f93</em>\u3002</p> <h4 id=\u8fb9\u7f18\u573a\u666f\u7684k8s\u7528\u4f8b\u6b63\u5728\u4e0d\u65ad\u6d8c\u73b0>\u8fb9\u7f18\u573a\u666f\u7684k8s\u7528\u4f8b\u6b63\u5728\u4e0d\u65ad\u6d8c\u73b0</h4> <ul> <li>1106\u4e2a\u6709\u6548\u95ee\u5377</li> <li>15%\u7684\u53d7\u8bbf\u8005\u8868\u793a\uff0c\u6b63\u5728\u628aKubernetes\u5e94\u7528\u5728\u8fb9\u7f18\u8ba1\u7b97\u573a\u666f\u4e2d</li> <li>Chick-fil-A <a href=https://medium.com/@cfatechblog/bare-metal-k8s-clustering-at-chick-fil-a-scale-7b0607bd3541>Link</a></li> </ul> <h4 id=\u8fb9\u7f18\u8ba1\u7b97\u7684\u95ee\u9898\u4e0e\u6311\u6218>\u8fb9\u7f18\u8ba1\u7b97\u7684\u95ee\u9898\u4e0e\u6311\u6218</h4> <ul> <li><p>\u8fb9\u7f18\u8bbe\u5907\u79cd\u7c7b\u7e41\u591a</p> </li> <li><p>\u7e41\u7410\u7684\u7248\u672c\u7ba1\u7406</p> </li> <li><p>\u590d\u6742\u7684\u8de8\u57df\u73af\u5883</p> </li> <li><p>\u6210\u767e\u4e0a\u5343\u90e8\u7f72\u5728\u8fb9\u7f18\u4fa7\u7684\u5e94\u7528</p> </li> <li><p>\u7edf\u4e00\u548c\u53ef\u6301\u7eed\u5316\u8fed\u4ee3\u7684\u7ba1\u7406 \u5e73\u53f0</p> </li> <li><p>\u7ee7\u627f\u4e86\u5f3a\u5927\u7684k8s\u793e\u533a\u548c\u751f \u6001</p> </li> <li><p>\u8fb9\u7f18\u8282\u70b9\u72ec\u7acb\u81ea\u5236\uff0c\u4e91\u7aef\u7cfb\u7edf\u7edf\u4e00\u7ba1\u7406</p> </li> </ul> <h4 id=k3s\u4e91\u8fb9\u534f\u4f5c\u6a21\u5f0f>k3s\u4e91\u8fb9\u534f\u4f5c\u6a21\u5f0f</h4> <p><img src='+a(m)+" alt=a4bdfa2ed0fbef25adc5c819ddf132d8.png></p> <p><img src="+a(v)+" alt=25851741f97501c67fef0e0a3c9551b0.png></p> <h4 id=k3s\u6848\u4f8b>k3s\u6848\u4f8b</h4> <p><img src="+a(C)+" alt=c219a97aa1e92f765e8c8c1662362845.png></p> <p><img src="+a(D)+" alt=db52d9567d5d3b9cbf97f98c24c4a0cf.png></p> <h4 id=k3s\u4e0eiot\u8bbe\u5907\u7ba1\u7406>K3s\u4e0eIoT\u8bbe\u5907\u7ba1\u7406</h4> <p><img src="+a(S)+" alt=638a2d821645ae0ccd4071ad63da136c.png></p> <p><img src="+a(K)+" alt=924c981a90322fe42990d2e538e46aa9.png></p> <ol> <li>\u521b\u5efa\u5e76\u7eb3\u7ba1\u8fb9\u7f18k3s\u96c6\u7fa4</li> <li>\u90e8\u7f72MQTT Broker\u5230k3s\u96c6\u7fa4</li> <li>\u521b\u5efa\u3001\u90e8\u7f72IoT\u8bbe\u5907\u76f8\u5173\u7684\u5e94\u7528</li> <li>\u57fa\u4e8eMQTT\u5b9e\u73b0\u8bbe\u5907\u8054\u52a8</li> </ol> <h3 id=k3s\u5468\u8fb9\u4ecb\u7ecd>K3S\u5468\u8fb9\u4ecb\u7ecd</h3> <h4 id=\u5b9e\u4f8b\u5316k3s\u96c6\u7fa4\u7684\u5de5\u5177>\u5b9e\u4f8b\u5316k3s\u96c6\u7fa4\u7684\u5de5\u5177</h4> <ul> <li>K3sup(<a href=https://github.com/alexellis/k3sup>https://github.com/alexellis/k3sup</a>) - VM\u5b9e\u4f8b\u4e2d\u8fd0\u884ck3s<ul> <li>\u5177\u5907\u9694\u79bb\u578b\uff0c\u4f46\u4f9d\u8d56\u516c\u6709\u4e91\u670d\u52a1</li> </ul> </li> <li>K3s-ansible(<a href=https://github.com/itwars/k3s-ansible>https://github.com/itwars/k3s-ansible</a>) <ul> <li>\u4f9d\u8d56\u7528\u6237\u5bf9\u673a\u5668\u73af\u5883\u8bbf\u95ee\u6743\u9650</li> <li>\u4f9d\u8d56ansible</li> </ul> </li> <li>Multipass-k3s<ul> <li>\u4f9d\u6258multipass\u672c\u8eab\u5bf9\u865a\u62df\u673a\u7684\u7ba1\u7406</li> </ul> </li> </ul> <h4 id=k3d---\u4f9d\u6258docker\u7684k3s\u7ba1\u7406\u5de5\u5177>K3d - \u4f9d\u6258Docker\u7684k3s\u7ba1\u7406\u5de5\u5177</h4> <p><a href=https://github.com/rancher/k3d>k3d\u9879\u76ee</a></p> <ul> <li>K3s\u672c\u8eab\u88ab\u7f6e\u4e8e\u5bb9\u5668\u4e2d</li> <li>\u5bb9\u5668\u4e2d\u7c7b\u4f3c\u662fDocker-in-Docker\u539f\u7406(<a href=https://hub.docker.com/_/docker>https://hub.docker.com/_/docker</a>)</li> <li>\u5b9e\u9645\u662fk3s(containerd)-in-Docker</li> <li>K3d\u6574\u5408\u5404\u79cduse cases\uff0c\u65b9\u4fbf\u901a\u8fc7CLI\u521b\u5efak3s\u96c6\u7fa4</li> </ul> <p>K3d\u5e26\u6765\u7684\u597d\u5904</p> <ul> <li>\u7ba1\u7406\u5bb9\u5668\u4e00\u6837\u7ba1\u7406k3s\u96c6\u7fa4</li> <li>\u7ed9\u6bcf\u4e2a\u5f00\u53d1\u8005\u672c\u5730k3s\u73af\u5883\uff0c\u65b9\u4fbf\u8c03\u8bd5\u5e94\u7528</li> <li><a href=https://github.com/rancher/k3d/tree/master/docs>https://github.com/rancher/k3d/tree/master/docs</a></li> </ul> <h4 id=\u4e0d\u53ef\u53d8\u57fa\u7840\u8bbe\u65bd>\u4e0d\u53ef\u53d8\u57fa\u7840\u8bbe\u65bd</h4> <p>Immutable Infrastructure</p> <p><img src="+a(P)+" alt=2229583e9c091f989762212a1eab143a.png></p> <h5 id=vm\u5b9e\u73b0\u4e86\u65e9\u671f\u7684\u6784\u60f3>VM\u5b9e\u73b0\u4e86\u65e9\u671f\u7684\u6784\u60f3</h5> <ul> <li>VM\u955c\u50cf\u8fc7\u4e8e\u7b28\u91cd\uff0c\u4e14\u65e0\u6cd5\u505a\u7248\u672c\u63a7\u5236</li> <li>\u5bf9\u5f02\u6784\u73af\u5883\u4e0d\u53cb\u597d</li> <li>\u7528\u6237\u4e60\u60ef\u65e0\u6cd5\u88ab\u7ea6\u675f\uff0c\u4f9d\u7136\u4f1a\u5728\u7ebf\u8fdb\u884c\u90e8\u5206\u66f4\u65b0\u64cd\u4f5c</li> </ul> <h5 id=\u4e0d\u53ef\u53d8\u57fa\u7840\u8bbe\u65bd10-----\u5bb9\u5668\u6280\u672fdocker>\u4e0d\u53ef\u53d8\u57fa\u7840\u8bbe\u65bd1.0 --- \u5bb9\u5668\u6280\u672f(Docker)</h5> <ul> <li>\u89e3\u51b3\u73af\u5883\u95f4\u5dee\u5f02\u95ee\u9898 </li> <li>\u5feb\u901f\u56de\u6eda\u5230\u8001\u7248\u672c</li> <li>\u66f4\u597d\u7684\u8fdb\u884cCI</li> <li>\u66f4\u597d\u7684\u81ea\u52a8\u5316</li> <li>\u66f4\u5bb9\u6613\u8fdb\u884c\u5927\u89c4\u6a21\u8fd0\u7ef4</li> </ul> <p><img src="+a(w)+" alt=6bdd28c497110a72bd3c98e694c0df9d.png></p> <h5 id=\u4e0d\u53ef\u53d8\u57fa\u7840\u8bbe\u65bd20----immutable-os>\u4e0d\u53ef\u53d8\u57fa\u7840\u8bbe\u65bd2.0 -- Immutable OS</h5> <p>\u786c\u4ef6\u4e4b\u4e0a\u5168\u90e8\u4e3a <strong>\u201c\u4e0d\u53ef\u53d8\u201d</strong></p> <p>\u66f4\u590d\u6742\u66f4\u9ad8\u7ea7\u7684\u4e91\u539f\u751f\u5e94\u7528\u7684\u66f4\u65b0\uff0c\u4e0d\u4ec5\u4ec5\u4f9d\u8d56RootFS\u53d8\u66f4\uff0c\u66f4\u9700\u8981\u5185\u6838\u7684\u540c\u6b65\u66f4\u65b0\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u4e5f\u5e94\u6210\u4e3a\u4e0d\u53ef\u53d8\u57fa\u7840\u8bbe\u65bd\u7684\u4e00\u90e8\u5206\uff0c\u4fdd\u8bc1\u57fa\u7840\u67b6\u6784\u66f4\u9ad8\u7684\u4e00\u81f4\u6027\u548c\u53ef\u9760\u6027\uff0c\u4ee5\u53ca\u66f4\u52a0\u65b9\u4fbf\u8fd0\u7ef4\u7ba1\u7406\u3002</p> <p><img src="+a(I)+" alt=6fa8948e140aa39a937f4a508db479c4.png></p> <h5 id=docker-native\u6b63\u5728\u5411kubernetes-native\u6f14\u53d8>Docker native\u6b63\u5728\u5411Kubernetes native\u6f14\u53d8</h5> <p>Immutable OS\u4e5f\u7d27\u8ddf\u8d8b\u52bf</p> <p>Immutable OS for Docker: </p> <ul> <li>RancherOS</li> <li>Atomic</li> <li>CoreOS</li> <li>Photon OS</li> </ul> <p>Immutable OS for Kubernetes: </p> <ul> <li>K3os</li> <li>Bottlerocket-os</li> <li>Talos</li> </ul> <h5 id=k3os--an-immutable-os-for-app>K3os \u2013 An Immutable OS For App</h5> <p><img src="+a(j)+" alt=0c5994ce907a7689185ec96b8b6d2f10.png></p> <h6 id=system-upgrade-controller>system-upgrade-controller</h6> <ul> <li>\u4f7f\u7528Kubernets\u65b9\u5f0f\u7ba1\u7406OS\u5347\u964d\u7ea7 </li> <li>\u672a\u6765\u4f1a\u96c6\u6210\u5728Rancher2.x\u4e2d</li> </ul> <h4 id=k3c---classic-docker-for-a-kubernetes-world>k3c - Classic Docker for a Kubernetes world</h4> <p>\u4e0eDocker\u6bd4</p> <ol> <li>\u76f8\u4f3c\u7684\u4ea4\u4e92</li> <li>singlebinary</li> <li>\u540c\u6837\u5185\u7f6econtainerd 4. \u66f4\u52a0\u8f7b\u91cf\u5316</li> </ol> <p>\u4e0eCrictl\u6bd4</p> <ol> <li>\u6ee1\u8db3CRI\u89c4\u8303</li> <li>\u652f\u6301image tag/push </li> <li>\u652f\u6301image build</li> </ol> ";l.exports=L},"6648c2400f74d21b732f":function(l,e,i){"use strict";i.r(e),e.default=i.p+"d129679f05a6e94e1af2c91040fcc4f8.png"},"9761f48e785b39fd4bbc":function(l,e,i){"use strict";i.r(e),e.default=i.p+"3846e2c6bddd26b5025425fddb30bb86.png"},b3c7f79f8966b8d94c72:function(l,e,i){"use strict";i.r(e),e.default=i.p+"3c2067cfa1f1e38c68d9321ae10fc2fa.png"},b76b07ea8c7189ac0e8c:function(l,e,i){"use strict";i.r(e),e.default=i.p+"8b5c0beb9fc81d5898826ff85e27ebae.png"},beae2b273ce7d94d24fd:function(l,e,i){"use strict";i.r(e),e.default=i.p+"647cf8bccd9404f5842913a68d8fd92e.png"},c1ac4a4baa1015af129b:function(l,e,i){"use strict";i.r(e),e.default=i.p+"4d6223fffeb7a60d2189308695389b13.png"},d1fb8d66e3d18d560727:function(l,e,i){"use strict";i.r(e),e.default=i.p+"4d917b8abddb0bbc7b31a5906d0f1ff5.png"},dce181ab8ec2fbc18c60:function(l,e,i){"use strict";i.r(e),e.default=i.p+"b485acf3a2455c16b0e8466ce85f76e0.png"},e0267d30eff98a9ea578:function(l,e,i){"use strict";i.r(e),e.default=i.p+"89b7c138db850f9e4c8df2a9ca3cc123.png"},f8619b261daca4e4e633:function(l,e,i){"use strict";i.r(e),e.default=i.p+"8515ec11f0725b2d3e52ac8b4286ee06.png"},f988a40abbd814ab95f8:function(l,e,i){"use strict";i.r(e),e.default=i.p+"abf5ce2c71b436a90db1ef63921c55c2.png"},fc302cb7754df2fa2a92:function(l,e,i){"use strict";i.r(e),e.default=i.p+"72379f0e1d4d28dd405406433c07a611.png"}}]);