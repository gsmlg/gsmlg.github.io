(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[666],{9787:function(e,n,i){"use strict";i.r(n),i.d(n,{default:function(){return _}});var r=i(2809),t=i(7294),o=i(1861),c=i(9008),s=i(558),a=i(6501),l=i(2642),u=i(3749),p=i(7865),f=i(2001),d=i(1365),x=i(4387),h=i(5893);var v=(0,x.G)("Piece",{canDrop:function(e,n){var i=n.getItem(),r=e.x,t=e.y,o=e.pieces;return e.canDrop(i,{x:r,y:t},o)},hover:function(e,n,i){n.isOver({shallow:!0}),n.canDrop()},drop:function(e,n,i){if(!n.didDrop()){var r=n.getItem(),t=e.x,o=e.y;return e.movePiece({item:r,position:{x:t,y:o}}),e.kill(),{moved:!0}}}},(function(e,n){return{connectDropTarget:e.dropTarget(),isOver:n.isOver(),isOverCurrent:n.isOver({shallow:!0}),isDropable:n.canDrop(),itemType:n.getItemType()}}))((function(e){var n=e.x,i=e.y,r=e.isDropable,t=e.connectDropTarget,o=e.piece,c=e.children,s=r?o?"red":"green":"transparent";return t((0,h.jsxs)("div",{style:{width:"100%",height:"100%",backgroundColor:s},children:[(0,h.jsx)("div",{style:{height:"1px",width:[0,8].includes(n)?"50%":"100%",backgroundColor:"black",transform:"translate(".concat(0===n?"30px":0,", 30px)")}}),(0,h.jsx)("div",{style:{height:[0,9].includes(i)||[4,5].includes(i)&&![0,8].includes(n)?"50%":"100%",width:"1px",backgroundColor:"black",transform:"translate(30px, ".concat(0===i||5===i&&![0,8].includes(n)?"30px":0,")")}}),c]}))}));var y,g,m=(0,i(6436).E)("Piece",{canDrag:function(e){return e.item.color===e.turn},isDragging:function(e,n){return n.getItem().id===e.item.id},beginDrag:function(e,n,i){return e.item},endDrag:function(e,n,i){if(n.didDrop())n.getItem(),n.getDropResult()}},(function(e,n){return{connectDragSource:e.dragSource(),isDragging:n.isDragging()}}))((function(e){var n=e.connectDragSource,i=e.item;e.turn;return n((0,h.jsx)("div",{style:{width:"50px",height:"50px",position:"absolute",left:"50%",top:"50%",marginTop:"-25px",marginLeft:"-25px",fontSize:"30px",textAlign:"center",lineHeight:"50px",border:"1px solid black",borderRadius:"50%",backgroundColor:"white",userSelect:"none",color:i.color},children:i.name}))})),b=function(e){for(var n=e.blackPieces,i=e.redPieces,r=e.movePiece,t=e.turn,o=e.kill,c=e.canDrop,s=i.concat(n),a=function(e){var n=e%9,i=Math.floor(e/9),a=s.filter((function(e){return!0===e.live})),l=a.find((function(e){var r=e.position,t=r.x,o=r.y;return t===n&&o===i})),u=null!=l?(0,h.jsx)(m,{item:l,turn:t}):null;return(0,h.jsx)("div",{style:{width:"60px",height:"60px",position:"relative",backgroundColor:"transparent"},children:(0,h.jsx)(v,{piece:l,x:n,y:i,movePiece:r,pieces:a,kill:function(){l&&o(l)},canDrop:c,children:u})},e)},l=[],u=0;u<90;u+=1)l.push(a(u));return(0,h.jsxs)("div",{style:{width:"540px",height:"600px",display:"flex",flexWrap:"wrap",position:"relative"},children:[l,(0,h.jsx)("div",{style:{position:"absolute",top:"50%",left:"25%",marginTop:"-30px",height:"60px",lineHeight:"60px",fontSize:"24px",userSelect:"none"},children:"\u695a \u6cb3"}),(0,h.jsx)("div",{style:{position:"absolute",top:"50%",right:"25%",marginTop:"-30px",height:"60px",lineHeight:"60px",fontSize:"24px",userSelect:"none"},children:"\u6f22 \u754c"})]})},P=function(e,n){var i=n.position;return e.find((function(e){var n=e.position,r=n.x,t=n.y;return(null===i||void 0===i?void 0:i.x)===r&&(null===i||void 0===i?void 0:i.y)===t}))},j=function(e,n,i){var r=e.position.x,t=e.position.y,o=n.x,c=n.y,s=P(i,{position:n});if(s&&s.color===e.color)return!1;var a=function(e){return!P(i,{position:e})},l=P(i,{color:"red",type:0}),u=P(i,{color:"black",type:0});if(!l||!u)return!1;if(0!==e.type&&l.position.x===u.position.x&&r===l.position.x){for(var p=0,f=l.position.y+1;f<u.position.y;f++)a({x:r,y:f})||p++;if(1===p&&o!==r)return!1}switch(e.type){case 0:if(o<3||o>5)return!1;if("red"===e.color&&c>2)return!1;if("black"===e.color&&c<7)return!1;if("red"===e.color){if(o===u.position.x){for(var d=0,x=l.position.y+1;x<u.position.y;x++)a({x:o,y:x})||d++;if(0===d)return!1}}else if(o===l.position.x){for(var h=0,v=l.position.y+1;v<u.position.y;v++)a({x:o,y:v})||h++;if(0===h)return!1}return o===r&&(c===t+1||c===t-1)||c===t&&(o===r+1||o===r-1);case 1:return!(o<3||o>5)&&(!("red"===e.color&&c>2)&&(!("black"===e.color&&c<7)&&(o===r+1&&(c===t+1||c===t-1)||o===r-1&&(c===t+1||c===t-1))));case 2:return!("red"===e.color&&c>4)&&(!("black"===e.color&&c<5)&&(!(!a({x:r-1,y:t-1})||o!==r-2||c!==t-2)||(!(!a({x:r-1,y:t+1})||o!==r-2||c!==t+2)||(!(!a({x:r+1,y:t-1})||o!==r+2||c!==t-2)||!(!a({x:r+1,y:t+1})||o!==r+2||c!==t+2)))));case 3:return!(!a({x:r-1,y:t})||o!==r-2||c!==t+1&&c!==t-1)||(!(!a({x:r+1,y:t})||o!==r+2||c!==t+1&&c!==t-1)||(!(!a({x:r,y:t-1})||c!==t-2||o!==r+1&&o!==r-1)||!(!a({x:r,y:t+1})||c!==t+2||o!==r+1&&o!==r-1)));case 4:if(r===o){var y=0;if(c>t)for(var g=t+1;g<=c;g++)P(i,{position:{x:r,y:g}})&&y++;else for(var m=t-1;m>=c;m--)P(i,{position:{x:r,y:m}})&&y++;return 0===y||1===y&&s}if(t===c){var b=0;if(o>r)for(var j=r+1;j<=o;j++)P(i,{position:{x:j,y:t}})&&b++;else for(var k=r-1;k>=o;k--)P(i,{position:{x:k,y:t}})&&b++;return 0===b||1===b&&s}return!1;case 5:if(r===o){var w=0;if(c>t)for(var D=t+1;D<=c;D++)P(i,{position:{x:r,y:D}})&&w++;else for(var C=t-1;C>=c;C--)P(i,{position:{x:r,y:C}})&&w++;return 0===w||2===w&&s}if(t===c){var O=0;if(o>r)for(var Z=r+1;Z<=o;Z++)P(i,{position:{x:Z,y:t}})&&O++;else for(var S=r-1;S>=o;S--)P(i,{position:{x:S,y:t}})&&O++;return 0===O||2===O&&s}return!1;case 6:return"red"===e.color?e.position.y>4?n.x===e.position.x&&n.y===e.position.y+1||n.x===e.position.x+1&&n.y===e.position.y||n.x===e.position.x-1&&n.y===e.position.y:n.x===e.position.x&&n.y===e.position.y+1:e.position.y<5?n.x===e.position.x&&n.y===e.position.y-1||n.x===e.position.x+1&&n.y===e.position.y||n.x===e.position.x-1&&n.y===e.position.y:n.x===e.position.x&&n.y===e.position.y-1}return!1},k=function(e){var n=(0,t.useState)(!1),i=n[0],r=n[1];(0,t.useEffect)((function(){var e=!1;"ontouchstart"in window.document.documentElement&&(e=!0),window.navigator.pointerEnabled&&(e=!0),r(e)}),[]);var o=e.redPieces,c=e.blackPieces,s=e.kill,a=e.movePiece,l=e.turn;return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(d.W,{backend:i?f.zr:p.PD,children:(0,h.jsx)(b,{redPieces:o,blackPieces:c,kill:s,movePiece:a,canDrop:j,turn:l})})})};!function(e){e.Black="black",e.Red="red"}(y||(y={})),function(e){e[e.General=0]="General",e[e.Advisor=1]="Advisor",e[e.Elephant=2]="Elephant",e[e.Horse=3]="Horse",e[e.Chariot=4]="Chariot",e[e.Cannon=5]="Cannon",e[e.Soldier=6]="Soldier"}(g||(g={}));var w=i(6127);function D(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),i.push.apply(i,r)}return i}function C(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?D(Object(i),!0).forEach((function(n){(0,r.Z)(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):D(Object(i)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))}))}return e}var O=(0,o.ZP)(s.ZP)((function(e){e.theme;return{display:"flex",justifyContent:"center",alignItems:"center"}})),Z=(0,o.ZP)(a.Z)((function(e){e.theme;return{width:"540px",height:"600px"}})),S=(0,o.ZP)(a.Z)((function(e){e.theme;return{width:"320px",height:"600px",display:"flex",justifyContent:"center",flexDirection:"column"}})),E=(0,o.ZP)(l.Z)((function(e){return{margin:e.theme.spacing(1)}}));var _=function(e){var n=(0,w.sV)(),i=(0,w.EM)("room:chess"),o=(0,t.useState)({redPieces:[],blackPieces:[]}),a=o[0],l=o[1],p=(0,t.useState)(y.Red),f=p[0],d=p[1],x=(0,t.useCallback)((function(){null===i||void 0===i||i.push("start")}),[i]),v=(0,t.useCallback)((function(e){null===i||void 0===i||i.push("move_chess",e)}),[i]),g=(0,t.useCallback)((function(e){var n=e.redPieces,i=e.blackPieces;l(C(C({},a),{},{redPieces:n,blackPieces:i}))}),[a]),m=(0,t.useCallback)((function(e,n){var i=e.color===y.Red?y.Black:y.Red,t=e.color===y.Red?"redPieces":"blackPieces",o=Number(e.id.slice(1)),c=a[t].slice();c[o].position=n,l(C(C({},a),{},(0,r.Z)({},t,c))),d(i)}),[a]);return(0,t.useEffect)((function(){if(i)return i.isJoined()||i.join(),console.log(n),console.log(i),i.on("init_pieces",(function(e){var n=e.pieces,i=e.turn;g({redPieces:n.filter((function(e){return e.color===y.Red})),blackPieces:n.filter((function(e){return e.color===y.Black}))}),d(i)})),i.on("move_chess_remote",(function(e){var n=e.item,i=e.position,r=e.pieces;m(n,i),g(r)})),function(){i.off(),i.leave(),n.remove(i)}}),[i]),(0,h.jsxs)(u.Z,{children:[(0,h.jsxs)(c.default,{children:[(0,h.jsx)("title",{children:"Xiangqi"}),(0,h.jsx)("meta",{name:"description",content:"Description of Xiangqi"})]}),(0,h.jsx)(s.ZP,{container:!0,children:(0,h.jsxs)(O,{item:!0,xs:12,sm:12,children:[(0,h.jsx)(Z,{children:(0,h.jsx)(k,{redPieces:a.redPieces,blackPieces:a.blackPieces,turn:f,kill:function(){},movePiece:v})}),(0,h.jsxs)(S,{children:[(0,h.jsxs)(E,{variant:"contained",color:"primary",children:["\u56de\u5408\uff1a ",f]}),(0,h.jsx)(E,{variant:"contained",color:"primary",onClick:x,children:"Start Game"})]})]})})]})}},3749:function(e,n,i){"use strict";var r=i(318),t=i(7294),o=i(1861),c=i(3720),s=i(4386),a=i(2658),l=i(2642),u=i(6867),p=i(326),f=i(1664),d=i(6127),x=i(5893),h=(0,o.ZP)("section")((function(e){e.theme;return{display:"flex",minHeight:"100vh",flexDirection:"column",flex:"1 1 auto"}})),v=(0,o.ZP)("section")((function(e){e.theme;return{display:"flex",flex:"1 1 auto"}})),y=(0,o.ZP)("footer")((function(e){var n=e.theme;return{lineHeight:"2em",textAlign:"center",marginTop:"0.5em",color:n.palette.getContrastText(n.palette.primary.main),backgroundColor:n.palette.primary.main}})),g=(0,o.ZP)("div")((function(e){e.theme;return{display:"inline-block",width:16,height:16,borderRadius:8,margin:"0 8px",backgroundColor:e.status.color}})),m=[{name:"Home",href:"/"},{name:"Blog",href:"/blogs"},{name:"Presentation",href:"/presentations"},{name:"Tool",href:"/tools"},{name:"Game",href:"/games"}],b=function(e,n){var i=e.children,o=(0,d.sV)(),b=t.useState({color:"transperant"}),P=(0,r.Z)(b,2),j=P[0],k=P[1];t.useEffect((function(){if(o){var e=function(){switch(o.connectionState()){case"connecting":k({color:"#ff0"});break;case"open":k({color:"#0f0"});break;case"closing":k({color:"#0ff"});break;default:k({color:"#f00"})}};e();var n=[o.onOpen(e),o.onClose(e),o.onError(e),o.onMessage(e)];return function(){o.off(n)}}}),[o]);var w=t.useCallback((function(){Notification.requestPermission()}),[]);return(0,x.jsxs)(h,{ref:n,children:[(0,x.jsx)(c.Z,{position:"static",children:(0,x.jsxs)(s.Z,{children:[(0,x.jsx)(g,{status:j}),(0,x.jsx)(u.Z,{onClick:w,color:"inherit","aria-label":"Menu",size:"large",children:(0,x.jsx)(p.Z,{})}),(0,x.jsx)(a.Z,{type:"title",color:"inherit",children:m.map((function(e){var n=e.name,i=e.href;return(0,x.jsx)(l.Z,{color:"inherit",children:(0,x.jsx)(f.default,{href:i,children:n})},n)}))})]})}),(0,x.jsx)(v,{children:i}),(0,x.jsx)(y,{style:{marginTop:0},children:(0,x.jsx)("div",{className:"container",children:(0,x.jsx)("span",{children:"Copyright \xa9 2017-2021 GSMLG - Powered by GSMLG Web."})})})]})};n.Z=t.forwardRef(b)},9173:function(e,n,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/games/xiangqi",function(){return i(9787)}])}},function(e){e.O(0,[880,755,774,888,179],(function(){return n=9173,e(e.s=n);var n}));var n=e.O();_N_E=n}]);