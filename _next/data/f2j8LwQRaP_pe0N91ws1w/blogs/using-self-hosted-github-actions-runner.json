{"pageProps":{"slug":"using-self-hosted-github-actions-runner","blog":{"author":"Gao","content":"When creating a rust project, my ci system has encountered a CI problem.\nThe Github Actions can not finisht build, the process had taken too much resources.\n\nTo Fix this, I had to use a Self-Hosted Actions Runner.\nHere is How to do this.\n\n### 1. Create VM\n\nCreate an VM at host machine with 24-cores, 64GiB memory and 200GiB disk space.\n\nSelect OS with Ubuntu 22.04.\n\n### 2. Prepare ENV\n\n**Prepare**\n```bash\nansible-playbook playbooks/ubuntu/update-apt.yml --extra-vars=host=github-runner\n```\n\n**Install**\n```bash\napt install curl\napt install build-essential\napt install git\n```\n\n**Create User**\n```bash\nuseradd -d /opt/actions-runner -M -N actions-runner\n```\n\n### 3. Install Action Runner\n\nGo to page `https://github.com/organizations/gsmlg-dev/settings/actions/runners` and click `New Runner` Button, select new Self-Hosted Runner.\n\nGo in to `/opt` folder and follow the `download` steps.\n\nWrap the config command with `su`\n```bash\nsu actions-runner -c './config.sh --url https://github.com/gsmlg-dev --token <TOKEN>'\n```\n\nFull config options\n```\nCommands:\n ./config.sh         Configures the runner\n ./config.sh remove  Unconfigures the runner\n ./run.sh            Runs the runner interactively. Does not require any options.\n\nOptions:\n --help     Prints the help for each command\n --version  Prints the runner version\n --commit   Prints the runner commit\n --check    Check the runner's network connectivity with GitHub server\n\nConfig Options:\n --unattended           Disable interactive prompts for missing arguments. Defaults will be used for missing options\n --url string           Repository to add the runner to. Required if unattended\n --token string         Registration token. Required if unattended\n --name string          Name of the runner to configure (default github-runner)\n --runnergroup string   Name of the runner group to add this runner to (defaults to the default runner group)\n --labels string        Extra labels in addition to the default: 'self-hosted,Linux,X64'\n --local                Removes the runner config files from your local machine. Used as an option to the remove command\n --work string          Relative runner work directory (default _work)\n --replace              Replace any existing runner with the same name (default false)\n --pat                  GitHub personal access token with repo scope. Used for checking network connectivity when executing `./run.sh --check`\n --disableupdate        Disable self-hosted runner automatic update to the latest released version`\n --ephemeral            Configure the runner to only take one job and then let the service un-configure the runner after the job finishes (default false)\n\nExamples:\n Check GitHub server network connectivity:\n  ./run.sh --check --url <url> --pat <pat>\n Configure a runner non-interactively:\n  ./config.sh --unattended --url <url> --token <token>\n Configure a runner non-interactively, replacing any existing runner with the same name:\n  ./config.sh --unattended --url <url> --token <token> --replace [--name <name>]\n Configure a runner non-interactively with three extra labels:\n  ./config.sh --unattended --url <url> --token <token> --labels L1,L2,L3\n```\n\n\nTest actions-runner is configured success.\n```\nsu actions-runner -c ./run.sh\n```\n\n### 4. Create Service\n\n```bash\n# Install\n./svc.sh install actions-runner \n# start\n./svc.sh start\n# check status\n./svc.sh status\n```\n\n### 5. Use Runner in Actions\n\nConfig in yaml\n```yaml\nruns-on: [self-hosted, linux, x64, hpc]\n```\n\n### 6. Add Envirionment to Runner\n\nEdit file `/etc/systemd/system/multi-user.target.wants/actions.runner.<group>.<name>.service`, Add \n\n```systemd\nEnvironment=http_proxy=http://proxy-server:8080\nEnvironment=https_proxy=http://proxy-server:8080\nEnvironment=no_proxy=localhost,localnet\n```\n\n\n\n","date":"2023-01-28","id":85,"slug":"using-self-hosted-github-actions-runner","title":"Using Self-Hosted Github Actions Runner"},"lightCss":"pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-built_in,.hljs-class .hljs-title,.hljs-title.class_{color:#c18401}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}","darkCss":"pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-built_in,.hljs-class .hljs-title,.hljs-title.class_{color:#e6c07b}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}"},"__N_SSG":true}