{"pageProps":{"slug":"vpn-setup-macos","blog":{"id":19,"slug":"vpn-setup-macos","title":"在macOS中配置VPN","date":"2018-06-22","author":"Gao","content":"## 为 macOS 配置 VPN\n\n### 配置 VPN 服务器\n\n搭建 vpn 服务\n\n从系统仓库安装`ipsec` 安装`xl2tpd`\n\n在服务器上启动服务\n\n配置好服务账户\n\n```\nsystemctl restart ipsec\nsystemctl restart xl2tpd\n```\n\n### 配置 VPN Client\n\n从`Mac App Store`安装`Apple Configurator 2`\n\n创建 VPN 描述文件\n\n选择`l2tp`协议配置*服务器地址、用户名、密码和共享密钥*\n\n把描述文件安装到`macOS`的系统配置，`iOS`通过`airDrop`安装\n\n安装完成即可连接 vpn\n\n### 配置 macOS 在 VPN 连接时的路由表\n\n使用`[static-routes][https://github.com/gsmlg/static-routes]`的配置\n\n路由表数据时使用 maxmine 公开的 geoip 数据库来进行配置\n\n在`/etc/ppp/`目录配置`ip-up`,`ip-down`对应在 VPN 启动和停止时执行对应脚本\n\n脚本中可以使用变量说明\n\n```\n$1 interface etc: ppp0\n$2 none?\n$3 ? 0\n$4 client ip\n$5 remote ip\n$6 local gateway\n```\n\n### 命令行中控制 VPN\n\n```\nVPN connections\n\nUsage: scutil --nc [command]\n\n\tlist\n\t\tList available network connection services in the current set\n\n\tstatus <service>\n\t\tIndicate whether a given service is connected, as well as extended status information for the service\n\n\tshow <service>\n\t\tDisplay configuration information for a given service\n\n\tstatistics <service>\n\t\tProvide statistics on bytes, packets, and errors for a given service\n\n\tselect <service>\n\t\tMake the given service active in the current set. This allows it to be started\n\n\tstart <service> [--user user] [--password password] [--secret secret]\n\t\tStart a given service. Can take optional arguments for user, password, and secret\n\n\tstop <service>\n\t\tStop a given service\n\n\tsuspend <service>\n\t\tSuspend a given service (PPP, Modem on Hold)\n\n\tresume <service>\n\t\tResume a given service (PPP, Modem on Hold)\n\n\tondemand [-W] [hostname]\n\tondemand -- --refresh\n\t\tDisplay VPN on-demand information\n\n\ttrigger <hostname> [background] [port]\n\t\tTrigger VPN on-demand with specified hostname, and optional port and background flag\n\n\tenablevpn <service or vpn type> [path]\n\t\tEnables the given VPN application type. Takes either a service or VPN type. Pass a path to set ApplicationURL\n\n\tdisablevpn <service or vpn type>\n\t\tDisables the given VPN application type. Takes either a service or VPN type\n\n\thelp\n\t\tDisplay available commands for --nc\n\n```\n"},"lightCss":"pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-built_in,.hljs-class .hljs-title,.hljs-title.class_{color:#c18401}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}","darkCss":"pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-built_in,.hljs-class .hljs-title,.hljs-title.class_{color:#e6c07b}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}"},"__N_SSG":true}