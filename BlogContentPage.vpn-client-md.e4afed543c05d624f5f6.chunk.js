(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{"./app/data/blogs/vpn-client.md":function(s,n){s.exports='<h1 id=-linux-vpn-client>在Linux系统中配置VPN Client</h1> <p>在没有X的linux系统中安装启用VPN</p> <h2 id=->安装</h2> <pre class=hljs><code class=language-shell><span class=hljs-meta>#</span><span class=bash> Ubuntu &amp; Debian</span>\napt-get update\napt-get -y install strongswan xl2tpd\n<span class=hljs-meta>\n#</span><span class=bash> CentOS &amp; RHEL</span>\nyum -y install epel-release\nyum --enablerepo=epel -y install strongswan xl2tpd\n<span class=hljs-meta>\n#</span><span class=bash> Fedora</span>\nyum -y install strongswan xl2tpd</code></pre><h3 id=-vpn->配置VPN账户</h3> <pre class=hljs><code class=language-shell>VPN_SERVER_IP=\'你的VPN服务器IP\'\nVPN_IPSEC_PSK=\'你的IPsec预共享密钥\'\nVPN_USER=\'你的VPN用户名\'\nVPN_PASSWORD=\'你的VPN密码\'</code></pre><h3 id=-strongswan>配置Strongswan</h3> <pre class=hljs><code class=language-shell>cat &gt; /etc/ipsec.conf &lt;&lt;EOF\n<span class=hljs-meta>#</span><span class=bash> ipsec.conf - strongSwan IPsec configuration file</span>\n<span class=hljs-meta>\n#</span><span class=bash> basic configuration</span>\n\nconfig setup\n<span class=hljs-meta>  #</span><span class=bash> strictcrlpolicy=yes</span>\n<span class=hljs-meta>  #</span><span class=bash> uniqueids = no</span>\n<span class=hljs-meta>\n#</span><span class=bash> Add connections here.</span>\n<span class=hljs-meta>\n#</span><span class=bash> Sample VPN connections</span>\n\nconn %default\n  ikelifetime=60m\n  keylife=20m\n  rekeymargin=3m\n  keyingtries=1\n  keyexchange=ikev1\n  authby=secret\n  ike=aes128-sha1-modp1024,3des-sha1-modp1024!\n  esp=aes128-sha1-modp1024,3des-sha1-modp1024!\n\nconn myvpn\n  keyexchange=ikev1\n  left=%defaultroute\n  auto=add\n  authby=secret\n  type=transport\n  leftprotoport=17/1701\n  rightprotoport=17/1701\n  right=$VPN_SERVER_IP\nEOF\n\ncat &gt; /etc/ipsec.secrets &lt;&lt;EOF\n: PSK "$VPN_IPSEC_PSK"\nEOF\n\nchmod 600 /etc/ipsec.secrets\n<span class=hljs-meta>\n#</span><span class=bash> For CentOS/RHEL &amp; Fedora ONLY</span>\nmv /etc/strongswan/ipsec.conf /etc/strongswan/ipsec.conf.old 2&gt;/dev/null\nmv /etc/strongswan/ipsec.secrets /etc/strongswan/ipsec.secrets.old 2&gt;/dev/null\nln -s /etc/ipsec.conf /etc/strongswan/ipsec.conf\nln -s /etc/ipsec.secrets /etc/strongswan/ipsec.secrets</code></pre><h3 id=-xl2tpd>配置 xl2tpd</h3> <pre class=hljs><code class=language-shell>cat &gt; /etc/xl2tpd/xl2tpd.conf &lt;&lt;EOF\n[lac myvpn]\nlns = $VPN_SERVER_IP\nppp debug = yes\npppoptfile = /etc/ppp/options.l2tpd.client\nlength bit = yes\nEOF\n\ncat &gt; /etc/ppp/options.l2tpd.client &lt;&lt;EOF\nipcp-accept-local\nipcp-accept-remote\nrefuse-eap\nrequire-chap\nnoccp\nnoauth\nmtu 1280\nmru 1280\nnoipdefault\ndefaultroute\nusepeerdns\nconnect-delay 5000\nname $VPN_USER\npassword $VPN_PASSWORD\nEOF\n\nchmod 600 /etc/ppp/options.l2tpd.client</code></pre><ul> <li>至此 VPN 客户端配置已完成</li> </ul> <h2 id=->配置连接</h2> <h3 id=-xl2tpd->创建 xl2tpd 控制文件：</h3> <pre class=hljs><code class=language-shell>mkdir -p /var/run/xl2tpd\ntouch /var/run/xl2tpd/l2tp-control</code></pre><h3 id=->重启服务：</h3> <pre class=hljs><code class=language-auto>service strongswan restart<span class=hljs-built_in>\nservice </span>xl2tpd restart</code></pre><h3 id=-ipsec->开始 IPsec 连接：</h3> <pre class=hljs><code class=language-shell><span class=hljs-meta>#</span><span class=bash> Ubuntu &amp; Debian</span>\nipsec up myvpn\n<span class=hljs-meta>\n#</span><span class=bash> CentOS/RHEL &amp; Fedora</span>\nstrongswan up myvpn</code></pre><h3 id=-l2tp->开始 L2TP 连接：</h3> <pre class=hljs><code class=language-shell>echo "c myvpn" &gt; /var/run/xl2tpd/l2tp-control</code></pre><h2 id=->配置路由</h2> <p>查看路由</p> <pre class=hljs><code class=language-shell>ip route</code></pre><p>创建路由表</p> <pre class=hljs><code class="language-undefined">git clone https://github.com/gsmlg/static-routes.git\ncd static-routes\nmake linux\n# mode <span class=hljs-number>1</span> 不需要修改 <span class=hljs-meta>default</span> route\n\\cp mode1/<span class=hljs-built_in>ip</span>-<span class=hljs-meta>up</span> /etc/ppp/<span class=hljs-built_in>ip</span>-<span class=hljs-meta>up</span>.local\n# mode <span class=hljs-number>2</span> 需要配置 <span class=hljs-meta>default</span> route 到VPN的<span class=hljs-built_in>IP</span>\n\\cp mode1/<span class=hljs-built_in>ip</span>-<span class=hljs-meta>up</span> /etc/ppp/<span class=hljs-built_in>ip</span>-<span class=hljs-meta>up</span>.local\n\\cp mode1/<span class=hljs-built_in>ip</span>-<span class=hljs-meta>down</span> /etc/ppp/<span class=hljs-built_in>ip</span>-<span class=hljs-meta>down</span>\n</code></pre><h2 id=->断开连接</h2> <pre class=hljs><code class="language-undefined"><span class=hljs-comment># Ubuntu &amp; Debian</span>\necho <span class=hljs-string>"d myvpn"</span> &gt; /var/run/xl2tpd/l2tp-control<span class=hljs-built_in>\nipsec </span>down myvpn\n\n<span class=hljs-comment># CentOS/RHEL &amp; Fedora</span>\necho <span class=hljs-string>"d myvpn"</span> &gt; /var/run/xl2tpd/l2tp-control\nstrongswan down myvpn</code></pre>'}}]);