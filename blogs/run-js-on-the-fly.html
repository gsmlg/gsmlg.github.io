<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="minimum-scale=1, initial-scale=1, width=device-width"/><meta name="theme-color" content="#1976d2"/><title>Run your javascript code on the fly</title><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="5"/><meta name="theme-color" content="#1976d2"/><link rel="preload" href="/_next/static/css/b192415249a5ea5e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b192415249a5ea5e.css" data-n-g=""/><link rel="preload" href="/_next/static/css/c2a527101433f11d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c2a527101433f11d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-9cf237ad0f2edb49.js" defer=""></script><script src="/_next/static/chunks/framework-52a6e827f70268e5.js" defer=""></script><script src="/_next/static/chunks/main-98ce47626994c4a7.js" defer=""></script><script src="/_next/static/chunks/pages/_app-a7fc8e6dbc5c9b8d.js" defer=""></script><script src="/_next/static/chunks/0927b6a9-6a3ecb87fe44725a.js" defer=""></script><script src="/_next/static/chunks/483-e48f82f26682be7c.js" defer=""></script><script src="/_next/static/chunks/282-4254ded5914098f0.js" defer=""></script><script src="/_next/static/chunks/pages/blogs/%5Bslug%5D-ac4ee5be8c888e68.js" defer=""></script><script src="/_next/static/f75_Rw2w52-FgBKiBt-vM/_buildManifest.js" defer=""></script><script src="/_next/static/f75_Rw2w52-FgBKiBt-vM/_ssgManifest.js" defer=""></script><style data-emotion="css "></style></head><body><div id="__next"><style data-emotion="css-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><section class="css-1vqbnt3"><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation4 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionStatic css-1x7skt0"><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular css-i6s8oy"><div class="css-ad3hhb"></div><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorInherit MuiIconButton-sizeLarge css-1l1167e" tabindex="0" type="button" aria-label="Menu"><span class="MuiBadge-root MuiBadge-root css-1rzb3uu"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="MenuIcon"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg><span class="MuiBadge-badge MuiBadge-standard MuiBadge-invisible MuiBadge-anchorOriginTopRight MuiBadge-anchorOriginTopRightRectangular MuiBadge-overlapRectangular MuiBadge-badge MuiBadge-invisible css-1mcnwcn"></span></span></button><p class="MuiTypography-root MuiTypography-body1 css-1ikde92" type="title"><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit css-b7766g" tabindex="0" type="button"><a href="/">Home</a></button><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit css-b7766g" tabindex="0" type="button"><a href="/blogs">Blog</a></button><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit css-b7766g" tabindex="0" type="button"><a href="/presentations">Presentation</a></button><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit css-b7766g" tabindex="0" type="button"><a href="/tools">Tool</a></button></p></div></header><section class="css-xxwux"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation4 css-gnirli"><header><h1 class="MuiTypography-root MuiTypography-body1 css-9l3uo3">Run your javascript code on the fly</h1><div class="MuiTypography-root MuiTypography-body1 css-9l3uo3">Author:<!-- -->Gao</div><div class="MuiTypography-root MuiTypography-body1 css-9l3uo3">Created At:<!-- -->2022-10-01</div></header><hr class="MuiDivider-root MuiDivider-fullWidth css-39bbo6"/><section class="MuiTypography-root MuiTypography-body1 blog-content css-9l3uo3"><div class="css-1xqzmcn"><h2>Summary</h2>
<p>It has been eight years since es2015 modules were released.
After so many years, with the advancement of technology, each operating environment can already support running es module directly.</p>
<p>Here is the ways</p>
<h2>Server side node.js</h2>
<p><code>deno.land</code> support es modules since it&#x27;s first release.</p>
<p><code>node.js</code> support es modules since <code>16 LTS</code></p>
<p>Add <code>type: module</code> in <code>package.json</code></p>
<pre><code class="hljs language-json"><span class="hljs-comment">// ./node_modules/pkg/package.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;module&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;exports&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;import&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./wrapper.mjs&quot;</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">&quot;require&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./index.cjs&quot;</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2>In browser</h2>
<p>All modern browsers already support es modules.</p>
<p>Just add <code>type=module</code> on script tag.</p>
<pre><code class="hljs language-html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;./index.js&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">module</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>Using CDN to import script in browser.</p>
<h2><code>esm.sh</code></h2>
<p><code>esm.sh</code> transforms any npm modules automatically into ES Modules.
So you can try any npm module with the url like <code>https://esm.sh/&lt;npm-module-name&gt;</code> e.g. <code>https://esm.sh/react</code>.
It also serves type declaration through <code>X-TypeScript-Types</code> header.
So you can even type check the exported APIs when the CDN find types.</p>
<p><code>esm.sh</code> also provides the Node.js polyfill for Deno if the user agent is Deno.</p>
<p>You can load modules like React, React Router, styled-components, twind, etc.</p>
<pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;https://esm.sh/react&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;https://esm.sh/react-dom&quot;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BrowserRouter</span>, <span class="hljs-title class_">Link</span>, <span class="hljs-title class_">Route</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;https://esm.sh/react-router&quot;</span>;
<span class="hljs-keyword">import</span> styled <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;https://esm.sh/styled-components&quot;</span>;
<span class="hljs-keyword">import</span> { tw } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;https://esm.sh/twind&quot;</span>;
</code></pre>
<h2>Skypack</h2>
<p>Skypack is very similar to esm.sh. It automatically converts npm modules into ES Modules.
It provides types via <code>X-TypeScript-Types</code>.
So you can type check the exported APIs.
Skypack also provides Node.js native API polyfills for Deno.</p>
<pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;https://cdn.skypack.dev/react&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;https://cdn.skypack.dev/react-dom&quot;</span>;
<span class="hljs-keyword">import</span> styled <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;https://cdn.skypack.dev/styled-components&quot;</span>;
<span class="hljs-keyword">import</span> { tw } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;https://cdn.skypack.dev/twind&quot;</span>;
</code></pre>
<h2><code>unpkg.com</code></h2>
<p><code>unpkg.com</code> provides the npm modules as is.
Many npm modules often provides <a href="https://github.com/umdjs/umd">UMD (Universal Module Definition)</a> format of the module,
or ES Module version of the module, like d3.js and threejs.</p>
<h2>In Browsers alias</h2>
<p>There is no standard for this yet, but <a href="https://wicg.github.io/import-maps/">one is under way</a> (Github repo <a href="https://github.com/WICG/import-maps">here</a>.) With that proposal,
you&#x27;d have a script with <code>type=&quot;importmap&quot;</code> that listed the aliases, like this:</p>
<pre><code class="hljs language-type=html">&lt;script type=&quot;importmap&quot;&gt;
{
  &quot;imports&quot;: {
    &quot;react&quot;: &quot;../vendors.react.js&quot;,
    &quot;react-dom&quot;: &quot;https://some.cdn/react-dom.min.js&quot;
  }
}
&lt;/script&gt;
</code></pre>
<p>Note that relative paths are relative to the document in which this script appears, not the module where you use the alias.</p>
<p>Chrome trialed this starting in v74, it&#x27;s behind a flag you have to enable: chrome://flags/#enable-experimental-productivity-features.
The Chrome platform status page for it lists &quot;no public signals&quot; from other vendors (so far).</p>
<h2>At last</h2>
<p>By the way, if you import from cdn, it will break the CSP rules purpose.</p></div></section></div></section><footer style="margin-top:0" class="css-6haedj"><div class="container"><span id="icp-info" class="css-sfxrzk">京ICP备20014476号-2</span><span>Copyright © 2017-2022 GSMLG - Powered by GSMLG Web.</span></div></footer></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"run-js-on-the-fly","blog":{"id":78,"slug":"run-js-on-the-fly","title":"Run your javascript code on the fly","date":"2022-10-01","author":"Gao","content":"## Summary\n\nIt has been eight years since es2015 modules were released.\nAfter so many years, with the advancement of technology, each operating environment can already support running es module directly.\n\nHere is the ways\n\n## Server side node.js\n\n`deno.land` support es modules since it's first release.\n\n`node.js` support es modules since `16 LTS`\n\nAdd `type: module` in `package.json`\n\n```json\n// ./node_modules/pkg/package.json\n{\n  \"type\": \"module\",\n  \"exports\": {\n    \"import\": \"./wrapper.mjs\",\n    \"require\": \"./index.cjs\"\n  }\n}\n```\n\n## In browser\n\nAll modern browsers already support es modules.\n\nJust add `type=module` on script tag.\n\n```html\n\u003cscript src=\"./index.js\" type=module\u003e\u003c/script\u003e\n```\n\nUsing CDN to import script in browser.\n\n## `esm.sh`\n\n`esm.sh` transforms any npm modules automatically into ES Modules. \nSo you can try any npm module with the url like `https://esm.sh/\u003cnpm-module-name\u003e` e.g. `https://esm.sh/react`. \nIt also serves type declaration through `X-TypeScript-Types` header. \nSo you can even type check the exported APIs when the CDN find types.\n\n`esm.sh` also provides the Node.js polyfill for Deno if the user agent is Deno.\n\nYou can load modules like React, React Router, styled-components, twind, etc.\n\n```ts\nimport React from \"https://esm.sh/react\";\nimport ReactDOM from \"https://esm.sh/react-dom\";\nimport { BrowserRouter, Link, Route } from \"https://esm.sh/react-router\";\nimport styled from \"https://esm.sh/styled-components\";\nimport { tw } from \"https://esm.sh/twind\";\n```\n\n## Skypack\n\nSkypack is very similar to esm.sh. It automatically converts npm modules into ES Modules. \nIt provides types via `X-TypeScript-Types`. \nSo you can type check the exported APIs. \nSkypack also provides Node.js native API polyfills for Deno.\n\n```ts\nimport React from \"https://cdn.skypack.dev/react\";\nimport ReactDOM from \"https://cdn.skypack.dev/react-dom\";\nimport styled from \"https://cdn.skypack.dev/styled-components\";\nimport { tw } from \"https://cdn.skypack.dev/twind\";\n```\n\n## `unpkg.com`\n\n`unpkg.com` provides the npm modules as is. \nMany npm modules often provides [UMD (Universal Module Definition)](https://github.com/umdjs/umd) format of the module, \nor ES Module version of the module, like d3.js and threejs.\n\n## In Browsers alias\n\nThere is no standard for this yet, but [one is under way](https://wicg.github.io/import-maps/) (Github repo [here](https://github.com/WICG/import-maps).) With that proposal, \nyou'd have a script with `type=\"importmap\"` that listed the aliases, like this:\n```type=html\n\u003cscript type=\"importmap\"\u003e\n{\n  \"imports\": {\n    \"react\": \"../vendors.react.js\",\n    \"react-dom\": \"https://some.cdn/react-dom.min.js\"\n  }\n}\n\u003c/script\u003e\n```\n\nNote that relative paths are relative to the document in which this script appears, not the module where you use the alias.\n\nChrome trialed this starting in v74, it's behind a flag you have to enable: chrome://flags/#enable-experimental-productivity-features. \nThe Chrome platform status page for it lists \"no public signals\" from other vendors (so far).\n\n## At last\n\nBy the way, if you import from cdn, it will break the CSP rules purpose.\n\n\n\n\n\n\n\n\n\n\n\n"},"lightCss":"pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-built_in,.hljs-class .hljs-title,.hljs-title.class_{color:#c18401}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}","darkCss":"pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-built_in,.hljs-class .hljs-title,.hljs-title.class_{color:#e6c07b}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}"},"__N_SSG":true},"page":"/blogs/[slug]","query":{"slug":"run-js-on-the-fly"},"buildId":"f75_Rw2w52-FgBKiBt-vM","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>