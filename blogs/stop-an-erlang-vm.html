<!DOCTYPE html><html lang="en"><head><meta name="theme-color" content="#1976d2"/><meta charSet="utf-8"/><meta name="viewport" content="minimum-scale=1, initial-scale=1, width=device-width"/><meta name="theme-color" content="#1976d2"/><title>终止erlang VM的10种方式</title><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/e48649c78aa55d60.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e48649c78aa55d60.css" data-n-g=""/><link rel="preload" href="/_next/static/css/c2a527101433f11d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c2a527101433f11d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-1fec710eb11e1257.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-b2070e873ca4314c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5c92ba9c94c6518f.js" defer=""></script><script src="/_next/static/chunks/eb1842f2-db13b08fd88037dd.js" defer=""></script><script src="/_next/static/chunks/947-80ad608d6161013a.js" defer=""></script><script src="/_next/static/chunks/323-045631e3e236dbf8.js" defer=""></script><script src="/_next/static/chunks/pages/blogs/%5Bslug%5D-62a56e6ae9e142ea.js" defer=""></script><script src="/_next/static/QNybktfW459stvqkf64RS/_buildManifest.js" defer=""></script><script src="/_next/static/QNybktfW459stvqkf64RS/_ssgManifest.js" defer=""></script><script src="/_next/static/QNybktfW459stvqkf64RS/_middlewareManifest.js" defer=""></script><style data-emotion="css "></style></head><body><div id="__next" data-reactroot=""><style data-emotion="css-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><section class="css-1vqbnt3"><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation4 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionStatic css-1x7skt0"><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular css-191lty2"><div status="[object Object]" class="css-ad3hhb"></div><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorInherit MuiIconButton-sizeLarge css-1l1167e" tabindex="0" type="button" aria-label="Menu"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" viewBox="0 0 24 24" aria-hidden="true" data-testid="MenuIcon"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></button><p class="MuiTypography-root MuiTypography-body1 css-1ikde92" type="title"><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/">Home</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/blogs">Blog</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/presentations">Presentation</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/tools">Tool</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/games">Game</a></button></p></div></header><section class="css-xxwux"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation4 css-gnirli"><header><h1 class="MuiTypography-root MuiTypography-body1 css-9l3uo3">终止erlang VM的10种方式</h1><div class="MuiTypography-root MuiTypography-body1 css-9l3uo3">Author:<!-- -->Gao</div><div class="MuiTypography-root MuiTypography-body1 css-9l3uo3">Created At:<!-- -->2020-04-07</div></header><hr class="MuiDivider-root MuiDivider-fullWidth css-39bbo6"/><section class="MuiTypography-root MuiTypography-body1 blog-content css-9l3uo3"><div class="css-1xqzmcn"><h2>如何停止 erlang VM</h2>
<p>当你需要停止一个 Erlang VM 的时候，如果你不知道怎么做？这里有 10 种方式介绍如何
停止</p>
<h3>比较好的方式</h3>
<ol>
<li>q/0, c:q/0, init:stop/0</li>
</ol>
<p>最简单和直接的方式是使用<code>q/0</code>或者<code>c:q/0</code>（实际相同），就像文档种的一样</p>
<pre><code class="hljs language-vbnet">This <span class="hljs-keyword">function</span> <span class="hljs-built_in">is</span> shorthand <span class="hljs-keyword">for</span> init:<span class="hljs-keyword">stop</span>(), that <span class="hljs-built_in">is</span>, it causes the node <span class="hljs-keyword">to</span> <span class="hljs-keyword">stop</span> <span class="hljs-keyword">in</span> a controlled fashion.
</code></pre>
<p><code>init:stop/0</code> :</p>
<pre><code class="hljs language-scss">The same as <span class="hljs-built_in">stop</span>(<span class="hljs-number">0</span>).
</code></pre>
<p>所以，最直接的方式就是运行<code>init:stop(0)</code>。要明白这个指令如何运行，我们可以检查文
档：</p>
<pre><code class="hljs language-pgsql"><span class="hljs-keyword">All</span> applications are taken down smoothly, <span class="hljs-keyword">all</span> code <span class="hljs-keyword">is</span> unloaded,
<span class="hljs-keyword">and</span> <span class="hljs-keyword">all</span> ports are closed <span class="hljs-keyword">before</span> the <span class="hljs-keyword">system</span> terminates <span class="hljs-keyword">by</span> calling halt(Status).
<span class="hljs-keyword">If</span> command-<span class="hljs-type">line</span> flag -heart was specified, the heartprogram <span class="hljs-keyword">is</span> terminated <span class="hljs-keyword">before</span> the Erlang node terminates.
<span class="hljs-keyword">For</span> more information, see heart(<span class="hljs-number">3</span>).

<span class="hljs-keyword">To</span> <span class="hljs-keyword">limit</span> the shutdown <span class="hljs-type">time</span>, the <span class="hljs-type">time</span> init <span class="hljs-keyword">is</span> allowed <span class="hljs-keyword">to</span> spend taking down applications,
command-<span class="hljs-type">line</span> flag -shutdown_time <span class="hljs-keyword">is</span> <span class="hljs-keyword">to</span> be used.
</code></pre>
<p>所以这种方式是最直接的终止方式。</p>
<ol start="2">
<li>erlang:halt/0</li>
</ol>
<p>向上边的文档中提到的一样，<code>erlang:halt()</code>和<code>erlang:halt(0,[])</code>。更多的内容可以看
下边的<code>erlang:halt/1,2</code>，但是现在，<code>erlang:halt()</code> 只停止关闭 VM，不处理应用的终
止和任何的端口关闭</p>
<ol start="3">
<li>JCL mode</li>
</ol>
<p>先前的方式需要你能够链接到 erlang shell 才可以执行。如果你做不到，或者是 shell
被阻止了该如何操作？如果你进入了 shell，但是无法输入，你可以指键
入<code>Ctrl-g</code>(<a href="http://erlang.org/doc/man/shell.html#jcl-mode">JCL mode</a>)</p>
<p>这样操作的效果和<code>erlang:halt(0)</code>相同</p>
<ol start="4">
<li>BREAK mode</li>
</ol>
<p>除了<code>Ctrl-g</code>，还可以使用<code>Ctrl-c</code>。这样会进入<code>*BREAK mode*</code>,样式如下：</p>
<pre><code class="hljs language-clojure">BREAK: (<span class="hljs-name">a</span>)bort (<span class="hljs-name">c</span>)ontinue (<span class="hljs-name">p</span>)roc info (<span class="hljs-name">i</span>)nfo (<span class="hljs-name">l</span>)oaded
       (<span class="hljs-name">v</span>)ersion (<span class="hljs-name">k</span>)ill (<span class="hljs-name">D</span>)b-tables (<span class="hljs-name">d</span>)istribution
</code></pre>
<p>可以用两种方式关闭 erlang 节点：</p>
<ul>
<li>Press <strong>Ctrl-c</strong> again</li>
<li>Press <strong>a</strong> and then return</li>
</ul>
<p>效果都和<code>erlang:halt(0)</code>一样</p>
<h3>不好的方式</h3>
<p>如果想要用一些不太好的方式来退出，并生成某些错误报告。那么，这些是可以做的选择……</p>
<ol start="5">
<li>erlang:halt/1,2</li>
</ol>
<p>正如你看到
的<a href="https://erldocs.com/current/erts/erlang.html?i=0&amp;search=erlang:ha#halt/1">这些文档</a>，
<code>erlang:halt/1,2</code>可以提交一些选项并输出处理错误。可以看一下文档中的这些选项：</p>
<ul>
<li>如果你想要一个干净的关闭并且有一个合适的退出状态，使用整数比较好</li>
<li>如果需要生成<code>erl_crash.dump</code>，使用一个<code>string</code></li>
<li>如果需要生成<code>core dump</code>，可以使用<code>atom</code> <code>abort</code></li>
</ul>
<p>当然，无论选择什么，都不会终止任何 application 和官彬任何 ports，etc.</p>
<ol start="6">
<li>Just kill it</li>
</ol>
<p>Erlang VM 只是一个操作系统进程，在类 Unix 系统可以使用关闭进程的信号来关闭进程。
不同的信号会给 Erlang VM 不同的处理。通常的信号：<code>kill -SIGTERM</code>的行为会
和<code>init:stop()</code>一样。而<code>kill -SIGKILL</code>会和<code>erlang:halt(137)</code>一样</p>
<p>还有一些其他的信号，生成<code>erl_crash.dump</code>: <code>kill -SIGUSR1</code>。</p>
<h3>最恶的方式</h3>
<p>关闭虚拟机的乐趣何在？让他们燃烧吧……</p>
<ol start="7">
<li>Don&#x27;t event let it start</li>
</ol>
<pre><code class="hljs language-inform7">$ erl -s something_that_doesnt_exist
Erlang/OTP 20 <span class="hljs-comment">[erts-9.0]</span> <span class="hljs-comment">[source]</span> <span class="hljs-comment">[64-bit]</span> <span class="hljs-comment">[smp:8:8]</span> <span class="hljs-comment">[ds:8:8:10]</span> <span class="hljs-comment">[async-threads:10]</span> <span class="hljs-comment">[kernel-poll:false]</span>
…
init terminating in do_boot ({undef,<span class="hljs-comment">[{something_that_doesnt_exist,start,<span class="hljs-comment">[]</span>,<span class="hljs-comment">[]</span>},{init,start_em,1,<span class="hljs-comment">[]</span>},{init,do_boot,3,<span class="hljs-comment">[]</span>}]</span>})
Crash dump <span class="hljs-keyword">is</span> being written to: erl_crash.dump...done
</code></pre>
<ol start="8">
<li>Kill the Kernel</li>
</ol>
<pre><code class="hljs language-properties"><span class="hljs-attr">$</span> <span class="hljs-string">erl</span>
<span class="hljs-attr">Erlang/OTP</span> <span class="hljs-string">20 [erts-9.0] [source] [64-bit] [smp:8:8] [ds:8:8:10] [async-threads:10] [kernel-poll:false]</span>
<span class="hljs-attr">…</span>
<span class="hljs-attr">1&gt;</span> <span class="hljs-string">exit(whereis(application_controller), kill).</span>
<span class="hljs-attr">true</span>
<span class="hljs-attr">***</span> <span class="hljs-string">ERROR: Shell process terminated! ***</span>
<span class="hljs-attr">***</span> <span class="hljs-string">ERROR: Shell process terminated! ***</span>
<span class="hljs-attr">***</span> <span class="hljs-string">ERROR: Shell process terminated! ***</span>
<span class="hljs-attr">***</span> <span class="hljs-string">ERROR: Shell process terminated! ***</span>
<span class="hljs-attr">***</span> <span class="hljs-string">ERROR: Shell process terminated! ***</span>
<span class="hljs-attr">***</span> <span class="hljs-string">ERROR: Shell process terminated! ***</span>
<span class="hljs-attr">***</span> <span class="hljs-string">ERROR: Shell process terminated! ***</span>
<span class="hljs-attr">***</span> <span class="hljs-string">ERROR: Shell process terminated! ***</span>
<span class="hljs-attr">***</span> <span class="hljs-string">ERROR: Shell process terminated! ***</span>
<span class="hljs-attr">***</span> <span class="hljs-string">ERROR: Shell process terminated! ***</span>
<span class="hljs-attr">{&quot;Kernel</span> <span class="hljs-string">pid terminated&quot;,application_controller,killed}</span>
<span class="hljs-attr">Kernel</span> <span class="hljs-string">pid terminated (application_controller) (killed)</span>
<span class="hljs-attr">Crash</span> <span class="hljs-string">dump is being written to: erl_crash.dump...done</span>
</code></pre>
<ol start="9">
<li>Exhaust the Atom Table</li>
</ol>
<pre><code class="hljs language-scheme">$ erl
Erlang/OTP <span class="hljs-number">20</span> [<span class="hljs-name">erts-9.0</span>] [<span class="hljs-name">source</span>] [<span class="hljs-name">64-bit</span>] [<span class="hljs-name">smp:8:8</span>] [<span class="hljs-name">ds:8:8:10</span>] [<span class="hljs-name">async-threads:10</span>] [<span class="hljs-name">kernel-poll:false</span>]
…
<span class="hljs-number">1</span>&gt; [<span class="hljs-name">list_to_atom</span>(<span class="hljs-name">integer_to_list</span>(<span class="hljs-name">I</span>)) || I &lt;- lists:seq(<span class="hljs-name">erlang:system_info</span>(<span class="hljs-name">atom_count</span>), erlang:system_info(<span class="hljs-name">atom_limit</span>))].
no more index entries in atom_tab (<span class="hljs-name">max=1048576</span>)
Crash dump is being written to: erl_crash.dump...done
</code></pre>
<ol start="10">
<li>Turn off your Computer</li>
</ol>
<p><img src="stop-an-erlang-vm/evil-laugh.jpg" alt="laugh"/></p></div></section></div></section><footer style="margin-top:0" class="css-6haedj"><div class="container"><span id="icp-info" class="css-z2a085">京ICP备20014476号-2</span><span>Copyright © 2017-2021 GSMLG - Powered by GSMLG Web.</span></div></footer></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"stop-an-erlang-vm","blog":{"author":"Gao","content":"## 如何停止 erlang VM\n\n当你需要停止一个 Erlang VM 的时候，如果你不知道怎么做？这里有 10 种方式介绍如何\n停止\n\n### 比较好的方式\n\n1. q/0, c:q/0, init:stop/0\n\n最简单和直接的方式是使用`q/0`或者`c:q/0`（实际相同），就像文档种的一样\n\n```\nThis function is shorthand for init:stop(), that is, it causes the node to stop in a controlled fashion.\n```\n\n`init:stop/0` :\n\n```\nThe same as stop(0).\n```\n\n所以，最直接的方式就是运行`init:stop(0)`。要明白这个指令如何运行，我们可以检查文\n档：\n\n```\nAll applications are taken down smoothly, all code is unloaded,\nand all ports are closed before the system terminates by calling halt(Status).\nIf command-line flag -heart was specified, the heartprogram is terminated before the Erlang node terminates.\nFor more information, see heart(3).\n\nTo limit the shutdown time, the time init is allowed to spend taking down applications,\ncommand-line flag -shutdown_time is to be used.\n```\n\n所以这种方式是最直接的终止方式。\n\n2. erlang:halt/0\n\n向上边的文档中提到的一样，`erlang:halt()`和`erlang:halt(0,[])`。更多的内容可以看\n下边的`erlang:halt/1,2`，但是现在，`erlang:halt()` 只停止关闭 VM，不处理应用的终\n止和任何的端口关闭\n\n3. JCL mode\n\n先前的方式需要你能够链接到 erlang shell 才可以执行。如果你做不到，或者是 shell\n被阻止了该如何操作？如果你进入了 shell，但是无法输入，你可以指键\n入`Ctrl-g`([JCL mode](http://erlang.org/doc/man/shell.html#jcl-mode))\n\n这样操作的效果和`erlang:halt(0)`相同\n\n4. BREAK mode\n\n除了`Ctrl-g`，还可以使用`Ctrl-c`。这样会进入`*BREAK mode*`,样式如下：\n\n```\nBREAK: (a)bort (c)ontinue (p)roc info (i)nfo (l)oaded\n       (v)ersion (k)ill (D)b-tables (d)istribution\n```\n\n可以用两种方式关闭 erlang 节点：\n\n- Press **Ctrl-c** again\n- Press **a** and then return\n\n效果都和`erlang:halt(0)`一样\n\n### 不好的方式\n\n如果想要用一些不太好的方式来退出，并生成某些错误报告。那么，这些是可以做的选择……\n\n5. erlang:halt/1,2\n\n正如你看到\n的[这些文档](https://erldocs.com/current/erts/erlang.html?i=0\u0026search=erlang:ha#halt/1)，\n`erlang:halt/1,2`可以提交一些选项并输出处理错误。可以看一下文档中的这些选项：\n\n- 如果你想要一个干净的关闭并且有一个合适的退出状态，使用整数比较好\n- 如果需要生成`erl_crash.dump`，使用一个`string`\n- 如果需要生成`core dump`，可以使用`atom` `abort`\n\n当然，无论选择什么，都不会终止任何 application 和官彬任何 ports，etc.\n\n6. Just kill it\n\nErlang VM 只是一个操作系统进程，在类 Unix 系统可以使用关闭进程的信号来关闭进程。\n不同的信号会给 Erlang VM 不同的处理。通常的信号：`kill -SIGTERM`的行为会\n和`init:stop()`一样。而`kill -SIGKILL`会和`erlang:halt(137)`一样\n\n还有一些其他的信号，生成`erl_crash.dump`: `kill -SIGUSR1`。\n\n### 最恶的方式\n\n关闭虚拟机的乐趣何在？让他们燃烧吧……\n\n7. Don't event let it start\n\n```\n$ erl -s something_that_doesnt_exist\nErlang/OTP 20 [erts-9.0] [source] [64-bit] [smp:8:8] [ds:8:8:10] [async-threads:10] [kernel-poll:false]\n…\ninit terminating in do_boot ({undef,[{something_that_doesnt_exist,start,[],[]},{init,start_em,1,[]},{init,do_boot,3,[]}]})\nCrash dump is being written to: erl_crash.dump...done\n```\n\n8. Kill the Kernel\n\n```\n$ erl\nErlang/OTP 20 [erts-9.0] [source] [64-bit] [smp:8:8] [ds:8:8:10] [async-threads:10] [kernel-poll:false]\n…\n1\u003e exit(whereis(application_controller), kill).\ntrue\n*** ERROR: Shell process terminated! ***\n*** ERROR: Shell process terminated! ***\n*** ERROR: Shell process terminated! ***\n*** ERROR: Shell process terminated! ***\n*** ERROR: Shell process terminated! ***\n*** ERROR: Shell process terminated! ***\n*** ERROR: Shell process terminated! ***\n*** ERROR: Shell process terminated! ***\n*** ERROR: Shell process terminated! ***\n*** ERROR: Shell process terminated! ***\n{\"Kernel pid terminated\",application_controller,killed}\nKernel pid terminated (application_controller) (killed)\nCrash dump is being written to: erl_crash.dump...done\n```\n\n9. Exhaust the Atom Table\n\n```\n$ erl\nErlang/OTP 20 [erts-9.0] [source] [64-bit] [smp:8:8] [ds:8:8:10] [async-threads:10] [kernel-poll:false]\n…\n1\u003e [list_to_atom(integer_to_list(I)) || I \u003c- lists:seq(erlang:system_info(atom_count), erlang:system_info(atom_limit))].\nno more index entries in atom_tab (max=1048576)\nCrash dump is being written to: erl_crash.dump...done\n```\n\n10. Turn off your Computer\n\n![laugh](stop-an-erlang-vm/evil-laugh.jpg)\n","date":"2020-04-07","id":34,"slug":"stop-an-erlang-vm","title":"终止erlang VM的10种方式"},"lightCss":"pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-built_in,.hljs-class .hljs-title,.hljs-title.class_{color:#c18401}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}","darkCss":"pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-built_in,.hljs-class .hljs-title,.hljs-title.class_{color:#e6c07b}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}"},"__N_SSG":true},"page":"/blogs/[slug]","query":{"slug":"stop-an-erlang-vm"},"buildId":"QNybktfW459stvqkf64RS","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>