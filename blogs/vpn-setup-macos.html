<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="minimum-scale=1, initial-scale=1, width=device-width"/><meta name="theme-color" content="#1976d2"/><title>在macOS中配置VPN</title><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="5"/><meta name="theme-color" content="#1976d2"/><link rel="preload" href="/_next/static/css/b192415249a5ea5e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b192415249a5ea5e.css" data-n-g=""/><link rel="preload" href="/_next/static/css/c2a527101433f11d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c2a527101433f11d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-a287909b40ce69d4.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-01df828e572375b9.js" defer=""></script><script src="/_next/static/chunks/pages/_app-fa1c54dc84ff2f16.js" defer=""></script><script src="/_next/static/chunks/eb1842f2-20fe0ca1aebd61de.js" defer=""></script><script src="/_next/static/chunks/912-6f01d34643494dca.js" defer=""></script><script src="/_next/static/chunks/769-5e2fcbf78701438b.js" defer=""></script><script src="/_next/static/chunks/pages/blogs/%5Bslug%5D-2a43c0343f5063f0.js" defer=""></script><script src="/_next/static/PcNJAqFZRVu-lhFPOltyc/_buildManifest.js" defer=""></script><script src="/_next/static/PcNJAqFZRVu-lhFPOltyc/_ssgManifest.js" defer=""></script><script src="/_next/static/PcNJAqFZRVu-lhFPOltyc/_middlewareManifest.js" defer=""></script><style data-emotion="css "></style></head><body><div id="__next" data-reactroot=""><style data-emotion="css-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><section class="css-1vqbnt3"><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation4 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionStatic css-1x7skt0"><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular css-191lty2"><div status="[object Object]" class="css-ad3hhb"></div><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorInherit MuiIconButton-sizeLarge css-1l1167e" tabindex="0" type="button" aria-label="Menu"><span class="BaseBadge-root root css-1rzb3uu"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="MenuIcon"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg><span class="BaseBadge-badge BaseBadge-invisible MuiBadge-badge MuiBadge-standard anchorOriginTopRight MuiBadge-anchorOriginTopRightRectangular MuiBadge-overlapRectangular MuiBadge-invisible css-1mcnwcn"></span></span></button><p class="MuiTypography-root MuiTypography-body1 css-1ikde92" type="title"><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/">Home</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/blogs">Blog</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/presentations">Presentation</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/tools">Tool</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/games">Game</a></button></p></div></header><section class="css-xxwux"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation4 css-gnirli"><header><h1 class="MuiTypography-root MuiTypography-body1 css-9l3uo3">在macOS中配置VPN</h1><div class="MuiTypography-root MuiTypography-body1 css-9l3uo3">Author:<!-- -->Gao</div><div class="MuiTypography-root MuiTypography-body1 css-9l3uo3">Created At:<!-- -->2018-06-22</div></header><hr class="MuiDivider-root MuiDivider-fullWidth css-39bbo6"/><section class="MuiTypography-root MuiTypography-body1 blog-content css-9l3uo3"><div class="css-1xqzmcn"><h2>为 macOS 配置 VPN</h2>
<h3>配置 VPN 服务器</h3>
<p>搭建 vpn 服务</p>
<p>从系统仓库安装<code>ipsec</code> 安装<code>xl2tpd</code></p>
<p>在服务器上启动服务</p>
<p>配置好服务账户</p>
<pre><code class="hljs language-properties"><span class="hljs-attr">systemctl</span> <span class="hljs-string">restart ipsec</span>
<span class="hljs-attr">systemctl</span> <span class="hljs-string">restart xl2tpd</span>
</code></pre>
<h3>配置 VPN Client</h3>
<p>从<code>Mac App Store</code>安装<code>Apple Configurator 2</code></p>
<p>创建 VPN 描述文件</p>
<p>选择<code>l2tp</code>协议配置<em>服务器地址、用户名、密码和共享密钥</em></p>
<p>把描述文件安装到<code>macOS</code>的系统配置，<code>iOS</code>通过<code>airDrop</code>安装</p>
<p>安装完成即可连接 vpn</p>
<h3>配置 macOS 在 VPN 连接时的路由表</h3>
<p>使用<code>[static-routes][https://github.com/gsmlg/static-routes]</code>的配置</p>
<p>路由表数据时使用 maxmine 公开的 geoip 数据库来进行配置</p>
<p>在<code>/etc/ppp/</code>目录配置<code>ip-up</code>,<code>ip-down</code>对应在 VPN 启动和停止时执行对应脚本</p>
<p>脚本中可以使用变量说明</p>
<pre><code class="hljs language-angelscript">$<span class="hljs-number">1</span> <span class="hljs-keyword">interface</span> <span class="hljs-symbol">etc</span>: <span class="hljs-symbol">ppp0</span>
$<span class="hljs-symbol">2</span> <span class="hljs-symbol">none</span>?
$<span class="hljs-symbol">3</span> ? <span class="hljs-symbol">0</span>
$<span class="hljs-symbol">4</span> <span class="hljs-symbol">client</span> <span class="hljs-symbol">ip</span>
$<span class="hljs-symbol">5</span> <span class="hljs-symbol">remote</span> <span class="hljs-symbol">ip</span>
$<span class="hljs-symbol">6</span> <span class="hljs-symbol">local</span> <span class="hljs-symbol">gateway</span>
</code></pre>
<h3>命令行中控制 VPN</h3>
<pre><code class="hljs language-properties"><span class="hljs-attr">VPN</span> <span class="hljs-string">connections</span>

<span class="hljs-attr">Usage</span>: <span class="hljs-string">scutil --nc [command]</span>

	<span class="hljs-attr">list</span>
		<span class="hljs-attr">List</span> <span class="hljs-string">available network connection services in the current set</span>

	<span class="hljs-attr">status</span> <span class="hljs-string">&lt;service&gt;</span>
		<span class="hljs-attr">Indicate</span> <span class="hljs-string">whether a given service is connected, as well as extended status information for the service</span>

	<span class="hljs-attr">show</span> <span class="hljs-string">&lt;service&gt;</span>
		<span class="hljs-attr">Display</span> <span class="hljs-string">configuration information for a given service</span>

	<span class="hljs-attr">statistics</span> <span class="hljs-string">&lt;service&gt;</span>
		<span class="hljs-attr">Provide</span> <span class="hljs-string">statistics on bytes, packets, and errors for a given service</span>

	<span class="hljs-attr">select</span> <span class="hljs-string">&lt;service&gt;</span>
		<span class="hljs-attr">Make</span> <span class="hljs-string">the given service active in the current set. This allows it to be started</span>

	<span class="hljs-attr">start</span> <span class="hljs-string">&lt;service&gt; [--user user] [--password password] [--secret secret]</span>
		<span class="hljs-attr">Start</span> <span class="hljs-string">a given service. Can take optional arguments for user, password, and secret</span>

	<span class="hljs-attr">stop</span> <span class="hljs-string">&lt;service&gt;</span>
		<span class="hljs-attr">Stop</span> <span class="hljs-string">a given service</span>

	<span class="hljs-attr">suspend</span> <span class="hljs-string">&lt;service&gt;</span>
		<span class="hljs-attr">Suspend</span> <span class="hljs-string">a given service (PPP, Modem on Hold)</span>

	<span class="hljs-attr">resume</span> <span class="hljs-string">&lt;service&gt;</span>
		<span class="hljs-attr">Resume</span> <span class="hljs-string">a given service (PPP, Modem on Hold)</span>

	<span class="hljs-attr">ondemand</span> <span class="hljs-string">[-W] [hostname]</span>
	<span class="hljs-attr">ondemand</span> <span class="hljs-string">-- --refresh</span>
		<span class="hljs-attr">Display</span> <span class="hljs-string">VPN on-demand information</span>

	<span class="hljs-attr">trigger</span> <span class="hljs-string">&lt;hostname&gt; [background] [port]</span>
		<span class="hljs-attr">Trigger</span> <span class="hljs-string">VPN on-demand with specified hostname, and optional port and background flag</span>

	<span class="hljs-attr">enablevpn</span> <span class="hljs-string">&lt;service or vpn type&gt; [path]</span>
		<span class="hljs-attr">Enables</span> <span class="hljs-string">the given VPN application type. Takes either a service or VPN type. Pass a path to set ApplicationURL</span>

	<span class="hljs-attr">disablevpn</span> <span class="hljs-string">&lt;service or vpn type&gt;</span>
		<span class="hljs-attr">Disables</span> <span class="hljs-string">the given VPN application type. Takes either a service or VPN type</span>

	<span class="hljs-attr">help</span>
		<span class="hljs-attr">Display</span> <span class="hljs-string">available commands for --nc</span>

</code></pre></div></section></div></section><footer style="margin-top:0" class="css-6haedj"><div class="container"><span id="icp-info" class="css-z2a085">京ICP备20014476号-2</span><span>Copyright © 2017-2022 GSMLG - Powered by GSMLG Web.</span></div></footer></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"vpn-setup-macos","blog":{"author":"Gao","content":"## 为 macOS 配置 VPN\n\n### 配置 VPN 服务器\n\n搭建 vpn 服务\n\n从系统仓库安装`ipsec` 安装`xl2tpd`\n\n在服务器上启动服务\n\n配置好服务账户\n\n```\nsystemctl restart ipsec\nsystemctl restart xl2tpd\n```\n\n### 配置 VPN Client\n\n从`Mac App Store`安装`Apple Configurator 2`\n\n创建 VPN 描述文件\n\n选择`l2tp`协议配置*服务器地址、用户名、密码和共享密钥*\n\n把描述文件安装到`macOS`的系统配置，`iOS`通过`airDrop`安装\n\n安装完成即可连接 vpn\n\n### 配置 macOS 在 VPN 连接时的路由表\n\n使用`[static-routes][https://github.com/gsmlg/static-routes]`的配置\n\n路由表数据时使用 maxmine 公开的 geoip 数据库来进行配置\n\n在`/etc/ppp/`目录配置`ip-up`,`ip-down`对应在 VPN 启动和停止时执行对应脚本\n\n脚本中可以使用变量说明\n\n```\n$1 interface etc: ppp0\n$2 none?\n$3 ? 0\n$4 client ip\n$5 remote ip\n$6 local gateway\n```\n\n### 命令行中控制 VPN\n\n```\nVPN connections\n\nUsage: scutil --nc [command]\n\n\tlist\n\t\tList available network connection services in the current set\n\n\tstatus \u003cservice\u003e\n\t\tIndicate whether a given service is connected, as well as extended status information for the service\n\n\tshow \u003cservice\u003e\n\t\tDisplay configuration information for a given service\n\n\tstatistics \u003cservice\u003e\n\t\tProvide statistics on bytes, packets, and errors for a given service\n\n\tselect \u003cservice\u003e\n\t\tMake the given service active in the current set. This allows it to be started\n\n\tstart \u003cservice\u003e [--user user] [--password password] [--secret secret]\n\t\tStart a given service. Can take optional arguments for user, password, and secret\n\n\tstop \u003cservice\u003e\n\t\tStop a given service\n\n\tsuspend \u003cservice\u003e\n\t\tSuspend a given service (PPP, Modem on Hold)\n\n\tresume \u003cservice\u003e\n\t\tResume a given service (PPP, Modem on Hold)\n\n\tondemand [-W] [hostname]\n\tondemand -- --refresh\n\t\tDisplay VPN on-demand information\n\n\ttrigger \u003chostname\u003e [background] [port]\n\t\tTrigger VPN on-demand with specified hostname, and optional port and background flag\n\n\tenablevpn \u003cservice or vpn type\u003e [path]\n\t\tEnables the given VPN application type. Takes either a service or VPN type. Pass a path to set ApplicationURL\n\n\tdisablevpn \u003cservice or vpn type\u003e\n\t\tDisables the given VPN application type. Takes either a service or VPN type\n\n\thelp\n\t\tDisplay available commands for --nc\n\n```\n","date":"2018-06-22","id":19,"slug":"vpn-setup-macos","title":"在macOS中配置VPN"},"lightCss":"pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-built_in,.hljs-class .hljs-title,.hljs-title.class_{color:#c18401}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}","darkCss":"pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-built_in,.hljs-class .hljs-title,.hljs-title.class_{color:#e6c07b}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}"},"__N_SSG":true},"page":"/blogs/[slug]","query":{"slug":"vpn-setup-macos"},"buildId":"PcNJAqFZRVu-lhFPOltyc","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>