<!DOCTYPE html><html lang="en"><head><meta name="theme-color" content="#1976d2"/><meta charSet="utf-8"/><meta name="viewport" content="minimum-scale=1, initial-scale=1, width=device-width"/><title>在macOS中配置VPN</title><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/f6fff7f38d0ed3d106d5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f6fff7f38d0ed3d106d5.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-4de7bd85a1856dba1c5b.js" defer=""></script><script src="/_next/static/chunks/framework-2191d16384373197bc0a.js" defer=""></script><script src="/_next/static/chunks/main-1f2c591c5d3bfcfc95e6.js" defer=""></script><script src="/_next/static/chunks/pages/_app-3edb49d0ad3e50a49500.js" defer=""></script><script src="/_next/static/chunks/880-b1dcf442dba6545440b2.js" defer=""></script><script src="/_next/static/chunks/962-fcac8798079d27a1cc07.js" defer=""></script><script src="/_next/static/chunks/pages/blogs/%5Bslug%5D-4f9360f6dfa8e4fe5942.js" defer=""></script><script src="/_next/static/Y2Uz9HttYaTX2sp7goceR/_buildManifest.js" defer=""></script><script src="/_next/static/Y2Uz9HttYaTX2sp7goceR/_ssgManifest.js" defer=""></script><style data-emotion="css "></style></head><body><div id="__next"><style data-emotion="css-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><section class="css-1vqbnt3"><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation4 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionStatic css-1x7skt0"><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular css-191lty2"><div status="[object Object]" class="css-ad3hhb"></div><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorInherit MuiIconButton-sizeLarge css-1l1167e" tabindex="0" type="button" aria-label="Menu"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" viewBox="0 0 24 24" aria-hidden="true" data-testid="MenuIcon"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></button><p class="MuiTypography-root MuiTypography-body1 css-1ikde92" type="title"><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root css-b7766g" tabindex="0" type="button"><a href="/">Home</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root css-b7766g" tabindex="0" type="button"><a href="/blogs">Blog</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root css-b7766g" tabindex="0" type="button"><a href="/presentations">Presentation</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root css-b7766g" tabindex="0" type="button"><a href="/tools">Tool</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root css-b7766g" tabindex="0" type="button"><a href="/games">Game</a></button></p></div></header><section class="css-xxwux"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation4 css-gnirli"><header><h1 class="MuiTypography-root MuiTypography-body1 css-9l3uo3">在macOS中配置VPN</h1><div class="MuiTypography-root MuiTypography-body1 css-9l3uo3">Author:<!-- -->Gao</div><div class="MuiTypography-root MuiTypography-body1 css-9l3uo3">Created At:<!-- -->2018-06-22</div></header><hr class="MuiDivider-root MuiDivider-fullWidth css-39bbo6"/><section class="MuiTypography-root MuiTypography-body1 blog-content css-9l3uo3"><h2>为 macOS 配置 VPN</h2>
<h3>配置 VPN 服务器</h3>
<p>搭建 vpn 服务</p>
<p>从系统仓库安装<code>ipsec</code> 安装<code>xl2tpd</code></p>
<p>在服务器上启动服务</p>
<p>配置好服务账户</p>
<pre><code>systemctl restart ipsec
systemctl restart xl2tpd
</code></pre>
<h3>配置 VPN Client</h3>
<p>从<code>Mac App Store</code>安装<code>Apple Configurator 2</code></p>
<p>创建 VPN 描述文件</p>
<p>选择<code>l2tp</code>协议配置<em>服务器地址、用户名、密码和共享密钥</em></p>
<p>把描述文件安装到<code>macOS</code>的系统配置，<code>iOS</code>通过<code>airDrop</code>安装</p>
<p>安装完成即可连接 vpn</p>
<h3>配置 macOS 在 VPN 连接时的路由表</h3>
<p>使用<code>[static-routes][https://github.com/gsmlg/static-routes]</code>的配置</p>
<p>路由表数据时使用 maxmine 公开的 geoip 数据库来进行配置</p>
<p>在<code>/etc/ppp/</code>目录配置<code>ip-up</code>,<code>ip-down</code>对应在 VPN 启动和停止时执行对应脚本</p>
<p>脚本中可以使用变量说明</p>
<pre><code>$1 interface etc: ppp0
$2 none?
$3 ? 0
$4 client ip
$5 remote ip
$6 local gateway
</code></pre>
<h3>命令行中控制 VPN</h3>
<pre><code>VPN connections

Usage: scutil --nc [command]

	list
		List available network connection services in the current set

	status &lt;service&gt;
		Indicate whether a given service is connected, as well as extended status information for the service

	show &lt;service&gt;
		Display configuration information for a given service

	statistics &lt;service&gt;
		Provide statistics on bytes, packets, and errors for a given service

	select &lt;service&gt;
		Make the given service active in the current set. This allows it to be started

	start &lt;service&gt; [--user user] [--password password] [--secret secret]
		Start a given service. Can take optional arguments for user, password, and secret

	stop &lt;service&gt;
		Stop a given service

	suspend &lt;service&gt;
		Suspend a given service (PPP, Modem on Hold)

	resume &lt;service&gt;
		Resume a given service (PPP, Modem on Hold)

	ondemand [-W] [hostname]
	ondemand -- --refresh
		Display VPN on-demand information

	trigger &lt;hostname&gt; [background] [port]
		Trigger VPN on-demand with specified hostname, and optional port and background flag

	enablevpn &lt;service or vpn type&gt; [path]
		Enables the given VPN application type. Takes either a service or VPN type. Pass a path to set ApplicationURL

	disablevpn &lt;service or vpn type&gt;
		Disables the given VPN application type. Takes either a service or VPN type

	help
		Display available commands for --nc

</code></pre></section></div></section><footer class="css-6haedj"><div class="container"><span>Copyright © 2017-2021 GSMLG - Powered by GSMLG Web.</span></div></footer></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"vpn-setup-macos","blog":{"id":19,"name":"vpn-setup-macos","title":"在macOS中配置VPN","date":"2018-06-22","author":"Gao","content":"## 为 macOS 配置 VPN\n\n### 配置 VPN 服务器\n\n搭建 vpn 服务\n\n从系统仓库安装`ipsec` 安装`xl2tpd`\n\n在服务器上启动服务\n\n配置好服务账户\n\n```\nsystemctl restart ipsec\nsystemctl restart xl2tpd\n```\n\n### 配置 VPN Client\n\n从`Mac App Store`安装`Apple Configurator 2`\n\n创建 VPN 描述文件\n\n选择`l2tp`协议配置*服务器地址、用户名、密码和共享密钥*\n\n把描述文件安装到`macOS`的系统配置，`iOS`通过`airDrop`安装\n\n安装完成即可连接 vpn\n\n### 配置 macOS 在 VPN 连接时的路由表\n\n使用`[static-routes][https://github.com/gsmlg/static-routes]`的配置\n\n路由表数据时使用 maxmine 公开的 geoip 数据库来进行配置\n\n在`/etc/ppp/`目录配置`ip-up`,`ip-down`对应在 VPN 启动和停止时执行对应脚本\n\n脚本中可以使用变量说明\n\n```\n$1 interface etc: ppp0\n$2 none?\n$3 ? 0\n$4 client ip\n$5 remote ip\n$6 local gateway\n```\n\n### 命令行中控制 VPN\n\n```\nVPN connections\n\nUsage: scutil --nc [command]\n\n\tlist\n\t\tList available network connection services in the current set\n\n\tstatus \u003cservice\u003e\n\t\tIndicate whether a given service is connected, as well as extended status information for the service\n\n\tshow \u003cservice\u003e\n\t\tDisplay configuration information for a given service\n\n\tstatistics \u003cservice\u003e\n\t\tProvide statistics on bytes, packets, and errors for a given service\n\n\tselect \u003cservice\u003e\n\t\tMake the given service active in the current set. This allows it to be started\n\n\tstart \u003cservice\u003e [--user user] [--password password] [--secret secret]\n\t\tStart a given service. Can take optional arguments for user, password, and secret\n\n\tstop \u003cservice\u003e\n\t\tStop a given service\n\n\tsuspend \u003cservice\u003e\n\t\tSuspend a given service (PPP, Modem on Hold)\n\n\tresume \u003cservice\u003e\n\t\tResume a given service (PPP, Modem on Hold)\n\n\tondemand [-W] [hostname]\n\tondemand -- --refresh\n\t\tDisplay VPN on-demand information\n\n\ttrigger \u003chostname\u003e [background] [port]\n\t\tTrigger VPN on-demand with specified hostname, and optional port and background flag\n\n\tenablevpn \u003cservice or vpn type\u003e [path]\n\t\tEnables the given VPN application type. Takes either a service or VPN type. Pass a path to set ApplicationURL\n\n\tdisablevpn \u003cservice or vpn type\u003e\n\t\tDisables the given VPN application type. Takes either a service or VPN type\n\n\thelp\n\t\tDisplay available commands for --nc\n\n```\n"}},"__N_SSG":true},"page":"/blogs/[slug]","query":{"slug":"vpn-setup-macos"},"buildId":"Y2Uz9HttYaTX2sp7goceR","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>