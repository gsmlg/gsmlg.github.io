<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="minimum-scale=1, initial-scale=1, width=device-width"/><meta name="theme-color" content="#1976d2"/><title>使用 s2i Build镜像</title><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="5"/><meta name="theme-color" content="#1976d2"/><link rel="preload" href="/_next/static/css/b192415249a5ea5e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b192415249a5ea5e.css" data-n-g=""/><link rel="preload" href="/_next/static/css/c2a527101433f11d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c2a527101433f11d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-5779213016bbe4f4.js" defer=""></script><script src="/_next/static/chunks/framework-9812cfa34974cf92.js" defer=""></script><script src="/_next/static/chunks/main-8026441b09170fba.js" defer=""></script><script src="/_next/static/chunks/pages/_app-4069f0536870c530.js" defer=""></script><script src="/_next/static/chunks/9187-56becaf578fab1b0.js" defer=""></script><script src="/_next/static/chunks/6215-c6e71e709c16d6ac.js" defer=""></script><script src="/_next/static/chunks/pages/blogs/%5Bslug%5D-dfacc8e40876f3e9.js" defer=""></script><script src="/_next/static/_8HBxX34UB3LF24lu6poG/_buildManifest.js" defer=""></script><script src="/_next/static/_8HBxX34UB3LF24lu6poG/_ssgManifest.js" defer=""></script><style data-emotion="css-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><style data-emotion="css 1938ga5 1x7skt0 i6s8oy 1xeyas3 1l1167e 1rzb3uu vubbuv 1mcnwcn 1ikde92 b7766g f2of98 gnirli 9l3uo3 39bbo6 1xqzmcn 6haedj">.css-1938ga5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;min-height:100vh;width:100%;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-1x7skt0{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;box-shadow:0px 2px 4px -1px rgba(0,0,0,0.2),0px 4px 5px 0px rgba(0,0,0,0.14),0px 1px 10px 0px rgba(0,0,0,0.12);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:static;background-color:#1976d2;color:#fff;}.css-i6s8oy{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-left:16px;padding-right:16px;min-height:56px;}@media (min-width:600px){.css-i6s8oy{padding-left:24px;padding-right:24px;}}@media (min-width:0px){@media (orientation: landscape){.css-i6s8oy{min-height:48px;}}}@media (min-width:600px){.css-i6s8oy{min-height:64px;}}.css-1xeyas3{display:inline-block;width:16px;height:16px;borderradius:8px;margin:0 8px;-webkit-backgroundcolor:transperant;backgroundcolor:transperant;}.css-1l1167e{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:inherit;padding:12px;font-size:1.75rem;}.css-1l1167e::-moz-focus-inner{border-style:none;}.css-1l1167e.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1l1167e{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1l1167e:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.css-1l1167e:hover{background-color:transparent;}}.css-1l1167e.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}.css-1rzb3uu{position:relative;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;vertical-align:middle;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}.css-vubbuv{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;}.css-1mcnwcn{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-content:center;-ms-flex-line-pack:center;align-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:absolute;box-sizing:border-box;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.75rem;min-width:20px;line-height:1;padding:0 6px;height:20px;border-radius:10px;z-index:1;-webkit-transition:-webkit-transform 195ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:transform 195ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;top:0;right:0;-webkit-transform:scale(1) translate(50%, -50%);-moz-transform:scale(1) translate(50%, -50%);-ms-transform:scale(1) translate(50%, -50%);transform:scale(1) translate(50%, -50%);transform-origin:100% 0%;}.css-1mcnwcn.MuiBadge-invisible{-webkit-transform:scale(0) translate(50%, -50%);-moz-transform:scale(0) translate(50%, -50%);-ms-transform:scale(0) translate(50%, -50%);transform:scale(0) translate(50%, -50%);}.css-1ikde92{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;color:inherit;}.css-b7766g{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:inherit;border-color:currentColor;}.css-b7766g::-moz-focus-inner{border-style:none;}.css-b7766g.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-b7766g{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-b7766g:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.css-b7766g:hover{background-color:transparent;}}.css-b7766g.Mui-disabled{color:rgba(0, 0, 0, 0.26);}.css-f2of98{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;}.css-gnirli{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;border-radius:4px;box-shadow:0px 2px 4px -1px rgba(0,0,0,0.2),0px 4px 5px 0px rgba(0,0,0,0.14),0px 1px 10px 0px rgba(0,0,0,0.12);-webkit-flex:1;-ms-flex:1;flex:1;padding:24px;margin:24px;}.css-9l3uo3{margin:0;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;}.css-39bbo6{margin:0;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;border-width:0;border-style:solid;border-color:rgba(0, 0, 0, 0.12);border-bottom-width:thin;}.css-1xqzmcn pre code.hljs{display:block;overflow-x:auto;padding:1em;}.css-1xqzmcn code.hljs{padding:3px 5px;}.css-1xqzmcn .hljs{color:#383a42;background:#fafafa;}.css-1xqzmcn .hljs-comment,.css-1xqzmcn .hljs-quote{color:#a0a1a7;font-style:italic;}.css-1xqzmcn .hljs-doctag,.css-1xqzmcn .hljs-formula,.css-1xqzmcn .hljs-keyword{color:#a626a4;}.css-1xqzmcn .hljs-deletion,.css-1xqzmcn .hljs-name,.css-1xqzmcn .hljs-section,.css-1xqzmcn .hljs-selector-tag,.css-1xqzmcn .hljs-subst{color:#e45649;}.css-1xqzmcn .hljs-literal{color:#0184bb;}.css-1xqzmcn .hljs-addition,.css-1xqzmcn .hljs-attribute,.css-1xqzmcn .hljs-meta .hljs-string,.css-1xqzmcn .hljs-regexp,.css-1xqzmcn .hljs-string{color:#50a14f;}.css-1xqzmcn .hljs-attr,.css-1xqzmcn .hljs-number,.css-1xqzmcn .hljs-selector-attr,.css-1xqzmcn .hljs-selector-class,.css-1xqzmcn .hljs-selector-pseudo,.css-1xqzmcn .hljs-template-variable,.css-1xqzmcn .hljs-type,.css-1xqzmcn .hljs-variable{color:#986801;}.css-1xqzmcn .hljs-bullet,.css-1xqzmcn .hljs-link,.css-1xqzmcn .hljs-meta,.css-1xqzmcn .hljs-selector-id,.css-1xqzmcn .hljs-symbol,.css-1xqzmcn .hljs-title{color:#4078f2;}.css-1xqzmcn .hljs-built_in,.css-1xqzmcn .hljs-class .hljs-title,.css-1xqzmcn .hljs-title.class_{color:#c18401;}.css-1xqzmcn .hljs-emphasis{font-style:italic;}.css-1xqzmcn .hljs-strong{font-weight:700;}.css-1xqzmcn .hljs-link{-webkit-text-decoration:underline;text-decoration:underline;}.css-6haedj{line-height:2em;text-align:center;margin-top:0.5em;color:#fff;background-color:#1976d2;}</style></head><body><div id="__next"><main class="css-1938ga5"><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation4 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionStatic css-1x7skt0"><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular css-i6s8oy"><div class="css-1xeyas3"></div><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorInherit MuiIconButton-sizeLarge css-1l1167e" tabindex="0" type="button" aria-label="Menu"><span class="MuiBadge-root css-1rzb3uu"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="MenuIcon"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg><span class="MuiBadge-badge MuiBadge-standard MuiBadge-invisible MuiBadge-anchorOriginTopRight MuiBadge-anchorOriginTopRightRectangular MuiBadge-overlapRectangular css-1mcnwcn"></span></span></button><p class="MuiTypography-root MuiTypography-body1 css-1ikde92" type="title"><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit css-b7766g" tabindex="0" type="button"><a href="/">Home</a></button><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit css-b7766g" tabindex="0" type="button"><a href="/blogs">Blog</a></button><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit css-b7766g" tabindex="0" type="button"><a href="/presentations">Presentation</a></button><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit css-b7766g" tabindex="0" type="button"><a href="/tools">Tool</a></button></p></div></header><div class="css-f2of98"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation4 css-gnirli"><header><h1 class="MuiTypography-root MuiTypography-body1 css-9l3uo3">使用 s2i Build镜像</h1><div class="MuiTypography-root MuiTypography-body1 css-9l3uo3">Author:<!-- -->Gao</div><div class="MuiTypography-root MuiTypography-body1 css-9l3uo3">Created At:<!-- -->2019-08-15</div></header><hr class="MuiDivider-root MuiDivider-fullWidth css-39bbo6"/><section class="MuiTypography-root MuiTypography-body1 blog-content css-9l3uo3"><div class="css-1xqzmcn"><h1>使用 <code>s2i</code> Build 镜像</h1>
<h2>安装<code>s2i</code></h2>
<ul>
<li>使用 <code>go get</code></li>
</ul>
<pre><code class="hljs language-shell"><span class="hljs-meta prompt_">$ </span><span class="bash">go get github.com/openshift/source-to-image/cmd/s2i</span>
</code></pre>
<ul>
<li>macOS 使用</li>
</ul>
<pre><code class="hljs language-shell"><span class="hljs-meta prompt_">$ </span><span class="bash">brew install source-to-image</span>
</code></pre>
<ul>
<li>Linux 使用</li>
</ul>
<p>在<a href="https://github.com/openshift/source-to-image/releases">版本发布页面</a>找到对应
链接下载</p>
<pre><code class="hljs language-shell">curl -sSL https://github.com/openshift/source-to-image/releases/download/v1.1.14/source-to-image-v1.1.14-874754de-linux-amd64.tar.gz | tar zxf - -C /usr/local/bin/ &#x27;./s2i&#x27;
</code></pre>
<ul>
<li>Windows 使用</li>
</ul>
<p>在<a href="https://github.com/openshift/source-to-image/releases">版本发布页面</a>找到对应
链接下载</p>
<p>下载</p>
<pre><code>https://github.com/openshift/source-to-image/releases/download/v1.1.14/source-to-image-v1.1.14-874754de-windows-amd64.zip
</code></pre>
<ul>
<li>源码编译</li>
</ul>
<pre><code class="hljs language-shell"><span class="hljs-meta prompt_">$ </span><span class="bash">go get github.com/openshift/source-to-image</span>
<span class="hljs-meta prompt_">$ </span><span class="bash"><span class="hljs-built_in">cd</span> <span class="hljs-variable">${GOPATH}</span>/src/github.com/openshift/source-to-image</span>
<span class="hljs-meta prompt_">$ </span><span class="bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">${GOPATH}</span>/src/github.com/openshift/source-to-image/_output/local/bin/linux/amd64/</span>
<span class="hljs-meta prompt_">$ </span><span class="bash">hack/build-go.sh</span>
</code></pre>
<h2>使用<code>s2i</code></h2>
<p>使用方式为：</p>
<pre><code class="hljs language-shell">s2i [source dir] [builder image] [built image name]
</code></pre>
<p>可用的 builder 镜像源码可以在 <a href="https://github.com/sclorg">Software Collection</a>
找到</p>
<h3>创建镜像 PHP 项目镜像</h3>
<p>PHP builder 镜像</p>
<ul>
<li>centos/php-72-centos7</li>
<li>centos/php-71-centos7</li>
<li>centos/php-70-centos7</li>
<li>centos/php-56-centos7</li>
<li>centos/php-55-centos7</li>
</ul>
<p>创建 test-app 镜像</p>
<pre><code>s2i build /root/s2i-php-test-app centos/php-72-centos7 my-test-app

docker run --rm -p 8080:8080 my-test-app

</code></pre>
<h4>配置运行时参数</h4>
<h5>给镜像配置以下环境变量可以作用于<code>php.ini</code>:</h5>
<ul>
<li><strong>ERROR_REPORTING</strong>
<ul>
<li>Informs PHP of which errors, warnings and notices you would like it to take
action for</li>
<li>Default: E_ALL &amp; ~E_NOTICE</li>
</ul>
</li>
<li><strong>DISPLAY_ERRORS</strong>
<ul>
<li>Controls whether or not and where PHP will output errors, notices and
warnings</li>
<li>Default: ON</li>
</ul>
</li>
<li><strong>DISPLAY_STARTUP_ERRORS</strong>
<ul>
<li>Cause display errors which occur during PHP&#x27;s startup sequence to be handled
separately from display errors</li>
<li>Default: OFF</li>
</ul>
</li>
<li><strong>TRACK_ERRORS</strong>
<ul>
<li>Store the last error/warning message in $php_errormsg (boolean)</li>
<li>Default: OFF</li>
</ul>
</li>
<li><strong>HTML_ERRORS</strong>
<ul>
<li>Link errors to documentation related to the error</li>
<li>Default: ON</li>
</ul>
</li>
<li><strong>INCLUDE_PATH</strong>
<ul>
<li>Path for PHP source files</li>
<li>Default: .:/opt/app-root/src:/opt/rh/rh-php72/root/usr/share/pear (EL7)</li>
<li>Default: .:/opt/app-root/src:/usr/share/pear (EL8, Fedora)</li>
</ul>
</li>
<li><strong>PHP_MEMORY_LIMIT</strong>
<ul>
<li>Memory Limit</li>
<li>Default: 128M</li>
</ul>
</li>
<li><strong>SESSION_NAME</strong>
<ul>
<li>Name of the session</li>
<li>Default: PHPSESSID</li>
</ul>
</li>
<li><strong>SESSION_HANDLER</strong>
<ul>
<li>Method for saving sessions</li>
<li>Default: files</li>
</ul>
</li>
<li><strong>SESSION_PATH</strong>
<ul>
<li>Location for session data files</li>
<li>Default: /tmp/sessions</li>
</ul>
</li>
<li><strong>SESSION_COOKIE_DOMAIN</strong>
<ul>
<li>The domain for which the cookie is valid.</li>
<li>Default:</li>
</ul>
</li>
<li><strong>SESSION_COOKIE_HTTPONLY</strong>
<ul>
<li>Whether or not to add the httpOnly flag to the cookie</li>
<li>Default: 0</li>
</ul>
</li>
<li><strong>SESSION_COOKIE_SECURE</strong>
<ul>
<li>Specifies whether cookies should only be sent over secure connections.</li>
<li>Default: Off</li>
</ul>
</li>
<li><strong>SHORT_OPEN_TAG</strong>
<ul>
<li>Determines whether or not PHP will recognize code between <!-- -->&lt;? and ?&gt;<!-- --> tags</li>
<li>Default: OFF</li>
</ul>
</li>
<li><strong>DOCUMENTROOT</strong>
<ul>
<li>Path that defines the DocumentRoot for your application (ie. /public)</li>
<li>Default: /</li>
</ul>
</li>
</ul>
<h5>给镜像配置以下环境变量可以作用于<code>opcache.ini</code>:</h5>
<ul>
<li><strong>OPCACHE_MEMORY_CONSUMPTION</strong>
<ul>
<li>The OPcache shared memory storage size in megabytes</li>
<li>Default: 128</li>
</ul>
</li>
<li><strong>OPCACHE_REVALIDATE_FREQ</strong>
<ul>
<li>How often to check script timestamps for updates, in seconds. 0 will result
in OPcache checking for updates on every request.</li>
<li>Default: 2</li>
</ul>
</li>
</ul>
<h5>以下配置环境变量作用于 Apache 服务，运行于 Apache <a href="https://httpd.apache.org/docs/2.4/mod/mpm_common.html">MPM prefork</a> 模式:</h5>
<ul>
<li><strong>HTTPD_START_SERVERS</strong>
<ul>
<li>The
<a href="https://httpd.apache.org/docs/2.4/mod/mpm_common.html#startservers">StartServers</a>
directive sets the number of child server processes created on startup.</li>
<li>Default: 8</li>
</ul>
</li>
<li><strong>HTTPD_MAX_REQUEST_WORKERS</strong>
<ul>
<li>The
<a href="https://httpd.apache.org/docs/2.4/mod/mpm_common.html#maxrequestworkers">MaxRequestWorkers</a>
directive sets the limit on the number of simultaneous requests that will be
served.</li>
<li><code>MaxRequestWorkers</code> was called <code>MaxClients</code> before version httpd 2.3.13.</li>
<li>Default: 256 (this is automatically tuned by setting Cgroup limits for the
container using this formula: <code>TOTAL_MEMORY / 15MB</code>. The 15MB is average
size of a single httpd process.</li>
</ul>
</li>
</ul>
<h5>以下配置环境变量作用于 composer:</h5>
<ul>
<li><strong>COMPOSER_MIRROR</strong>
<ul>
<li>Adds a custom composer repository mirror URL to composer configuration.
Note: This only affects packages listed in composer.json.</li>
</ul>
</li>
<li><strong>COMPOSER_INSTALLER</strong>
<ul>
<li>Overrides the default URL for downloading Composer of
<a href="https://getcomposer.org/installer">https://getcomposer.org/installer</a>. Useful in disconnected environments.</li>
</ul>
</li>
<li><strong>COMPOSER_ARGS</strong>
<ul>
<li>Adds extra arguments to the <code>composer install</code> command line (for example
<code>--no-dev</code>).</li>
</ul>
</li>
</ul>
<h4>代码目录配置</h4>
<p>当以下文件在代码目录中时，会被使用：</p>
<ul>
<li>
<p><strong>composer.json</strong></p>
<p>List of dependencies to be installed with <code>composer</code>. The format is documented
<a href="https://getcomposer.org/doc/04-schema.md">here</a>.</p>
</li>
</ul>
<ul>
<li>
<p><strong>.htaccess</strong></p>
<p>In case the <strong>DocumentRoot</strong> of the application is nested within the source
directory <code>/opt/app-root/src</code>, users can provide their own Apache
<strong>.htaccess</strong> file. This allows the overriding of Apache&#x27;s behavior and
specifies how application requests should be handled. The <strong>.htaccess</strong> file
needs to be located at the root of the application source.</p>
</li>
<li>
<p><strong>.s2i/environment</strong></p>
<p>也可以用于配置环境变量</p>
</li>
</ul>
<h3>创建 nodejs 项目镜像</h3>
<p>可用 builder 镜像</p>
<ul>
<li>centos/nodejs-10-centos7</li>
<li>centos/nodejs-8-centos7</li>
<li>centos/nodejs-6-centos7</li>
</ul>
<h4>服务启动</h4>
<p>默认会调用 <code>npm start</code> 来启动服务</p>
<p>当<code>DEV_MODE=true</code>时，默认会调用<code>nodemon &lt;main attribute in package.json&gt;</code>,来启动
服务，如果失败再调用，<code>npm start</code> 来启动服务</p>
<h4>可配置环境变量</h4>
<p><strong><code>NODE_ENV</code></strong> NodeJS runtime mode (default: &quot;production&quot;)</p>
<p><strong><code>DEV_MODE</code></strong> When set to &quot;true&quot;, <code>nodemon</code> will be used to automatically
reload the server while you work (default: &quot;false&quot;). Setting <code>DEV_MODE</code> to
&quot;true&quot; will change the <code>NODE_ENV</code> default to &quot;development&quot; (if not explicitly
set).</p>
<p><strong><code>NPM_RUN</code></strong> Select an alternate / custom runtime mode, defined in your
<code>package.json</code> file&#x27;s <a href="https://docs.npmjs.com/misc/scripts"><code>scripts</code></a> section
(default: npm run &quot;start&quot;). These user-defined run-scripts are unavailable while
<code>DEV_MODE</code> is in use.</p>
<p><strong><code>HTTP_PROXY</code></strong> Use an npm proxy during assembly</p>
<p><strong><code>HTTPS_PROXY</code></strong> Use an npm proxy during assembly</p>
<p><strong><code>NPM_MIRROR</code></strong> Use a custom NPM registry mirror to download packages during
the build process</p>
<h3>创建 go 项目镜像</h3>
<p>可用 builder 镜像</p>
<ul>
<li>centos/go-toolset-7-centos7</li>
</ul>
<h4>配置运行时参数</h4>
<ul>
<li><strong>IMPORT_URL</strong></li>
</ul>
<p>指定应用的导入 URL，如 <code>github.com/someorg/somerepo</code></p>
<ul>
<li><strong>INSTALL_URL</strong></li>
</ul>
<p>如果<code>main.go</code>不在代码目录下时，指定 build 目录,如
<code>github.com/someorg/somerepo/somefolder</code></p>
<h3>创建 java 项目镜像</h3>
<p>由于 java 项目的多样性，建议进行定制</p></div></section></div></div><footer style="margin-top:0" class="css-6haedj"><div class="container"><span>Copyright © 2017-2023 GSMLG - Powered by GSMLG Web.</span></div></footer></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"build-with-s2i","blog":{"author":"Gao","content":"# 使用 `s2i` Build 镜像\n\n## 安装`s2i`\n\n- 使用 `go get`\n\n```shell\n$ go get github.com/openshift/source-to-image/cmd/s2i\n```\n\n- macOS 使用\n\n```shell\n$ brew install source-to-image\n```\n\n- Linux 使用\n\n在[版本发布页面](https://github.com/openshift/source-to-image/releases)找到对应\n链接下载\n\n```shell\ncurl -sSL https://github.com/openshift/source-to-image/releases/download/v1.1.14/source-to-image-v1.1.14-874754de-linux-amd64.tar.gz | tar zxf - -C /usr/local/bin/ './s2i'\n```\n\n- Windows 使用\n\n在[版本发布页面](https://github.com/openshift/source-to-image/releases)找到对应\n链接下载\n\n下载\n\n```\nhttps://github.com/openshift/source-to-image/releases/download/v1.1.14/source-to-image-v1.1.14-874754de-windows-amd64.zip\n```\n\n- 源码编译\n\n```shell\n$ go get github.com/openshift/source-to-image\n$ cd ${GOPATH}/src/github.com/openshift/source-to-image\n$ export PATH=$PATH:${GOPATH}/src/github.com/openshift/source-to-image/_output/local/bin/linux/amd64/\n$ hack/build-go.sh\n```\n\n## 使用`s2i`\n\n使用方式为：\n\n```shell\ns2i [source dir] [builder image] [built image name]\n```\n\n可用的 builder 镜像源码可以在 [Software Collection](https://github.com/sclorg)\n找到\n\n### 创建镜像 PHP 项目镜像\n\nPHP builder 镜像\n\n- centos/php-72-centos7\n- centos/php-71-centos7\n- centos/php-70-centos7\n- centos/php-56-centos7\n- centos/php-55-centos7\n\n创建 test-app 镜像\n\n```\ns2i build /root/s2i-php-test-app centos/php-72-centos7 my-test-app\n\ndocker run --rm -p 8080:8080 my-test-app\n\n```\n\n#### 配置运行时参数\n\n##### 给镜像配置以下环境变量可以作用于`php.ini`:\n\n- **ERROR_REPORTING**\n  - Informs PHP of which errors, warnings and notices you would like it to take\n    action for\n  - Default: E_ALL \u0026 ~E_NOTICE\n- **DISPLAY_ERRORS**\n  - Controls whether or not and where PHP will output errors, notices and\n    warnings\n  - Default: ON\n- **DISPLAY_STARTUP_ERRORS**\n  - Cause display errors which occur during PHP's startup sequence to be handled\n    separately from display errors\n  - Default: OFF\n- **TRACK_ERRORS**\n  - Store the last error/warning message in \\$php_errormsg (boolean)\n  - Default: OFF\n- **HTML_ERRORS**\n  - Link errors to documentation related to the error\n  - Default: ON\n- **INCLUDE_PATH**\n  - Path for PHP source files\n  - Default: .:/opt/app-root/src:/opt/rh/rh-php72/root/usr/share/pear (EL7)\n  - Default: .:/opt/app-root/src:/usr/share/pear (EL8, Fedora)\n- **PHP_MEMORY_LIMIT**\n  - Memory Limit\n  - Default: 128M\n- **SESSION_NAME**\n  - Name of the session\n  - Default: PHPSESSID\n- **SESSION_HANDLER**\n  - Method for saving sessions\n  - Default: files\n- **SESSION_PATH**\n  - Location for session data files\n  - Default: /tmp/sessions\n- **SESSION_COOKIE_DOMAIN**\n  - The domain for which the cookie is valid.\n  - Default:\n- **SESSION_COOKIE_HTTPONLY**\n  - Whether or not to add the httpOnly flag to the cookie\n  - Default: 0\n- **SESSION_COOKIE_SECURE**\n  - Specifies whether cookies should only be sent over secure connections.\n  - Default: Off\n- **SHORT_OPEN_TAG**\n  - Determines whether or not PHP will recognize code between \u003c? and ?\u003e tags\n  - Default: OFF\n- **DOCUMENTROOT**\n  - Path that defines the DocumentRoot for your application (ie. /public)\n  - Default: /\n\n##### 给镜像配置以下环境变量可以作用于`opcache.ini`:\n\n- **OPCACHE_MEMORY_CONSUMPTION**\n  - The OPcache shared memory storage size in megabytes\n  - Default: 128\n- **OPCACHE_REVALIDATE_FREQ**\n  - How often to check script timestamps for updates, in seconds. 0 will result\n    in OPcache checking for updates on every request.\n  - Default: 2\n\n##### 以下配置环境变量作用于 Apache 服务，运行于 Apache [MPM prefork](https://httpd.apache.org/docs/2.4/mod/mpm_common.html) 模式:\n\n- **HTTPD_START_SERVERS**\n  - The\n    [StartServers](https://httpd.apache.org/docs/2.4/mod/mpm_common.html#startservers)\n    directive sets the number of child server processes created on startup.\n  - Default: 8\n- **HTTPD_MAX_REQUEST_WORKERS**\n  - The\n    [MaxRequestWorkers](https://httpd.apache.org/docs/2.4/mod/mpm_common.html#maxrequestworkers)\n    directive sets the limit on the number of simultaneous requests that will be\n    served.\n  - `MaxRequestWorkers` was called `MaxClients` before version httpd 2.3.13.\n  - Default: 256 (this is automatically tuned by setting Cgroup limits for the\n    container using this formula: `TOTAL_MEMORY / 15MB`. The 15MB is average\n    size of a single httpd process.\n\n##### 以下配置环境变量作用于 composer:\n\n- **COMPOSER_MIRROR**\n  - Adds a custom composer repository mirror URL to composer configuration.\n    Note: This only affects packages listed in composer.json.\n- **COMPOSER_INSTALLER**\n  - Overrides the default URL for downloading Composer of\n    https://getcomposer.org/installer. Useful in disconnected environments.\n- **COMPOSER_ARGS**\n  - Adds extra arguments to the `composer install` command line (for example\n    `--no-dev`).\n\n#### 代码目录配置\n\n当以下文件在代码目录中时，会被使用：\n\n- **composer.json**\n\n  List of dependencies to be installed with `composer`. The format is documented\n  [here](https://getcomposer.org/doc/04-schema.md).\n\n* **.htaccess**\n\n  In case the **DocumentRoot** of the application is nested within the source\n  directory `/opt/app-root/src`, users can provide their own Apache\n  **.htaccess** file. This allows the overriding of Apache's behavior and\n  specifies how application requests should be handled. The **.htaccess** file\n  needs to be located at the root of the application source.\n\n* **.s2i/environment**\n\n  也可以用于配置环境变量\n\n### 创建 nodejs 项目镜像\n\n可用 builder 镜像\n\n- centos/nodejs-10-centos7\n- centos/nodejs-8-centos7\n- centos/nodejs-6-centos7\n\n#### 服务启动\n\n默认会调用 `npm start` 来启动服务\n\n当`DEV_MODE=true`时，默认会调用`nodemon \u003cmain attribute in package.json\u003e`,来启动\n服务，如果失败再调用，`npm start` 来启动服务\n\n#### 可配置环境变量\n\n**`NODE_ENV`** NodeJS runtime mode (default: \"production\")\n\n**`DEV_MODE`** When set to \"true\", `nodemon` will be used to automatically\nreload the server while you work (default: \"false\"). Setting `DEV_MODE` to\n\"true\" will change the `NODE_ENV` default to \"development\" (if not explicitly\nset).\n\n**`NPM_RUN`** Select an alternate / custom runtime mode, defined in your\n`package.json` file's [`scripts`](https://docs.npmjs.com/misc/scripts) section\n(default: npm run \"start\"). These user-defined run-scripts are unavailable while\n`DEV_MODE` is in use.\n\n**`HTTP_PROXY`** Use an npm proxy during assembly\n\n**`HTTPS_PROXY`** Use an npm proxy during assembly\n\n**`NPM_MIRROR`** Use a custom NPM registry mirror to download packages during\nthe build process\n\n### 创建 go 项目镜像\n\n可用 builder 镜像\n\n- centos/go-toolset-7-centos7\n\n#### 配置运行时参数\n\n- **IMPORT_URL**\n\n指定应用的导入 URL，如 `github.com/someorg/somerepo`\n\n- **INSTALL_URL**\n\n如果`main.go`不在代码目录下时，指定 build 目录,如\n`github.com/someorg/somerepo/somefolder`\n\n### 创建 java 项目镜像\n\n由于 java 项目的多样性，建议进行定制\n","date":"2019-08-15","id":33,"slug":"build-with-s2i","title":"使用 s2i Build镜像"},"lightCss":"pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-built_in,.hljs-class .hljs-title,.hljs-title.class_{color:#c18401}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}","darkCss":"pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-built_in,.hljs-class .hljs-title,.hljs-title.class_{color:#e6c07b}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}"},"__N_SSG":true},"page":"/blogs/[slug]","query":{"slug":"build-with-s2i"},"buildId":"_8HBxX34UB3LF24lu6poG","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>