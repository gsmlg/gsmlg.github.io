<!DOCTYPE html><html lang="en"><head><meta name="theme-color" content="#1976d2"/><meta charSet="utf-8"/><meta name="viewport" content="minimum-scale=1, initial-scale=1, width=device-width"/><meta name="theme-color" content="#1976d2"/><title>无界面浏览器 - Firefox, Chrome</title><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/b38854d43c26436a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b38854d43c26436a.css" data-n-g=""/><link rel="preload" href="/_next/static/css/c2a527101433f11d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c2a527101433f11d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-1fec710eb11e1257.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-d98b4a7f39fdfc80.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d2a6d752ae061d88.js" defer=""></script><script src="/_next/static/chunks/eb1842f2-1728a7c21d6ea0e6.js" defer=""></script><script src="/_next/static/chunks/947-524ff1a298d1e6a0.js" defer=""></script><script src="/_next/static/chunks/609-7e7bf61c87d318e7.js" defer=""></script><script src="/_next/static/chunks/pages/blogs/%5Bslug%5D-a08041307ff64346.js" defer=""></script><script src="/_next/static/vfCLbnG5uw7a7yAACDtLp/_buildManifest.js" defer=""></script><script src="/_next/static/vfCLbnG5uw7a7yAACDtLp/_ssgManifest.js" defer=""></script><script src="/_next/static/vfCLbnG5uw7a7yAACDtLp/_middlewareManifest.js" defer=""></script><style data-emotion="css "></style></head><body><div id="__next" data-reactroot=""><style data-emotion="css-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><section class="css-1vqbnt3"><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation4 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionStatic css-1x7skt0"><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular css-191lty2"><div status="[object Object]" class="css-ad3hhb"></div><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorInherit MuiIconButton-sizeLarge css-1l1167e" tabindex="0" type="button" aria-label="Menu"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" viewBox="0 0 24 24" aria-hidden="true" data-testid="MenuIcon"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></button><p class="MuiTypography-root MuiTypography-body1 css-1ikde92" type="title"><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/">Home</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/blogs">Blog</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/presentations">Presentation</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/tools">Tool</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/games">Game</a></button></p></div></header><section class="css-xxwux"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation4 css-gnirli"><header><h1 class="MuiTypography-root MuiTypography-body1 css-9l3uo3">无界面浏览器 - Firefox, Chrome</h1><div class="MuiTypography-root MuiTypography-body1 css-9l3uo3">Author:<!-- -->Gao</div><div class="MuiTypography-root MuiTypography-body1 css-9l3uo3">Created At:<!-- -->2017-11-30</div></header><hr class="MuiDivider-root MuiDivider-fullWidth css-39bbo6"/><section class="MuiTypography-root MuiTypography-body1 blog-content css-9l3uo3"><div class="css-1xqzmcn"><h1>概述</h1>
<p>无界面浏览器 &lt;<code>headdless mode</code>&gt; 在进行自动化测试和服务器上运行时非常有用。</p>
<p>在服务器上，可能需要运行浏览器去执行一些特殊的任务，但是服务器上是没有 X Window
系统，这个时候就需要使用无界面浏览器了。</p>
<p>无界面浏览器可以去打开一些真正的页面，并且渲染，然后输出到 html，pdf 或图片。</p>
<p>无界面浏览器还可以打开调试端口，在没有图形界面的情况下，调试真正的浏览器页面。</p>
<h2>Chrome</h2>
<p>Chrome 从版本 59 开始，提供了无界面浏览功能，使用方式如下:</p>
<pre><code class="hljs language-shell">chrome \
  --headless \                   # Runs Chrome in headless mode.
  --disable-gpu \                # Temporarily needed for now.
  --remote-debugging-port=9222 \
  https://www.chromestatus.com   # URL to open. Defaults to about:blank.
</code></pre>
<ul>
<li>chrome 命令设置：</li>
</ul>
<pre><code class="hljs language-shell">alias chrome=&quot;/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome&quot;
alias chrome-canary=&quot;/Applications/Google\ Chrome\ Canary.app/Contents/MacOS/Google\ Chrome\ Canary&quot;
alias chromium=&quot;/Applications/Chromium.app/Contents/MacOS/Chromium&quot;
</code></pre>
<p>Chrome headless mode 提供了很多强大功能：</p>
<ul>
<li>输出 DOM 结构</li>
</ul>
<p><code>--dump-dom</code> flag 会输出<code>document.body.innerHTML</code></p>
<pre><code class="hljs language-shell">chrome --headless --disable-gpu --dump-dom https://www.chromestatus.com/
</code></pre>
<ul>
<li>输出 PDF</li>
</ul>
<pre><code class="hljs language-shell">chrome --headless --disable-gpu --print-to-pdf https://www.chromestatus.com/
</code></pre>
<ul>
<li>输出截图</li>
</ul>
<pre><code class="hljs language-shell">chrome --headless --disable-gpu --screenshot https://www.chromestatus.com/
<span class="hljs-meta">
# </span><span class="bash">Size of a standard letterhead.</span>
chrome --headless --disable-gpu --screenshot --window-size=1280,1696 https://www.chromestatus.com/
<span class="hljs-meta">
# </span><span class="bash">Nexus 5x</span>
chrome --headless --disable-gpu --screenshot --window-size=412,732 https://www.chromestatus.com/
</code></pre>
<ul>
<li>REPL</li>
</ul>
<p><code>--repl</code> 会打开一个 JS Console</p>
<pre><code class="hljs language-shell"><span class="hljs-meta">$ </span><span class="bash">chrome --headless --disable-gpu --repl https://www.chromestatus.com/</span>
[0608/112805.245285:INFO:headless_shell.cc(278)] Type a Javascript expression to evaluate or &quot;quit&quot; to exit.
<span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; location.href</span>
{&quot;result&quot;:{&quot;type&quot;:&quot;string&quot;,&quot;value&quot;:&quot;https://www.chromestatus.com/features&quot;}}
<span class="hljs-meta">&gt;</span><span class="bash">&gt;&gt; quit</span>
<span class="hljs-meta">$</span><span class="bash">
</span></code></pre>
<ul>
<li>远程调试</li>
</ul>
<p><code>--remote-debugging-port=9222</code> 会打开调试端口，调试基于<code>DevTools protocol</code>协议可
以通过编辑器连接，来进行远程调试。</p>
<h3>Node 编程接口</h3>
<p><strong>The Puppeteer API</strong></p>
<p>Puppeteer is a Node library developed by the Chrome team. It provides a
high-level API to control headless (or full) Chrome. It&#x27;s similar to other
automated testing libraries like Phantom and NightmareJS, but it only works with
the latest versions of Chrome.</p>
<p>Among other things, Puppeteer can be used to easily take screenshots, create
PDFs, navigate pages, and fetch information about those pages. I recommend the
library if you want to quickly automate browser testing. It hides away the
complexities of the DevTools protocol and takes care of redundant tasks like
launching a debug instance of Chrome.</p>
<p>Install it:</p>
<pre><code class="hljs language-shell">yarn add puppeteer
</code></pre>
<p>Example - print the user agent</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> puppeteer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;puppeteer&#x27;</span>);

(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> puppeteer.<span class="hljs-title hljs-function">launch</span>();
  <span class="hljs-variable hljs-language">console</span>.<span class="hljs-title hljs-function">log</span>(<span class="hljs-keyword">await</span> browser.<span class="hljs-title hljs-function">version</span>());
  browser.<span class="hljs-title hljs-function">close</span>();
})();
</code></pre>
<p>Example - taking a screenshot of the page</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> puppeteer = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;puppeteer&#x27;</span>);

(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> puppeteer.<span class="hljs-title hljs-function">launch</span>();
  <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> browser.<span class="hljs-title hljs-function">newPage</span>();
  <span class="hljs-keyword">await</span> page.<span class="hljs-title hljs-function">goto</span>(<span class="hljs-string">&#x27;https://www.chromestatus.com&#x27;</span>, {<span class="hljs-attr">waitUntil</span>: <span class="hljs-string">&#x27;networkidle&#x27;</span>});
  <span class="hljs-keyword">await</span> page.<span class="hljs-title hljs-function">pdf</span>({<span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;page.pdf&#x27;</span>, <span class="hljs-attr">format</span>: <span class="hljs-string">&#x27;A4&#x27;</span>});

  browser.<span class="hljs-title hljs-function">close</span>();
})();
</code></pre>
<p>Check out
<a href="https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md">Puppeteer&#x27;s documentation</a>
to learn more about the full API.</p>
<h2>Firefox</h2>
<p>Headless Firefox works on Fx55+ on Linux, and 56+ on Windows/Mac.</p>
<p>从 Firefox 57 开始，Firefox 开始支持截图</p>
<pre><code class="hljs language-awk"><span class="hljs-regexp">/path/</span>to<span class="hljs-regexp">/firefox -headless -screenshot https:/</span><span class="hljs-regexp">/developer.mozilla.com
</span></code></pre>
<ul>
<li><code>-screenshot</code> name url — Set a custom name for the screenshot by including it
between the -screenshot flag and the URL you want to capture. Note that you
can specify other web-compatible image formats such as .jpg, .bmp, etc.</li>
<li><code>--window-size=x</code> — Set a custom viewport width when taking the screenshot
(full height is maintained). Note that the single argument version of this
doesn&#x27;t work.</li>
<li><code>--window-size=x,y</code> — Set a custom viewport width and height to capture.</li>
</ul>
<p>Firefox headless 模式可以用于自动化测试，基于<code>Selenium</code>。</p>
<p>MDN 的<a href="https://github.com/mdn/headless-examples"><code>headless-example</code></a></p></div></section></div></section><footer style="margin-top:0" class="css-6haedj"><div class="container"><span id="icp-info" class="css-z2a085">京ICP备20014476号-2</span><span>Copyright © 2017-2021 GSMLG - Powered by GSMLG Web.</span></div></footer></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"headless-browser","blog":{"author":"Gao","content":"# 概述\n\n无界面浏览器 \u003c`headdless mode`\u003e 在进行自动化测试和服务器上运行时非常有用。\n\n在服务器上，可能需要运行浏览器去执行一些特殊的任务，但是服务器上是没有 X Window\n系统，这个时候就需要使用无界面浏览器了。\n\n无界面浏览器可以去打开一些真正的页面，并且渲染，然后输出到 html，pdf 或图片。\n\n无界面浏览器还可以打开调试端口，在没有图形界面的情况下，调试真正的浏览器页面。\n\n## Chrome\n\nChrome 从版本 59 开始，提供了无界面浏览功能，使用方式如下:\n\n```shell\nchrome \\\n  --headless \\                   # Runs Chrome in headless mode.\n  --disable-gpu \\                # Temporarily needed for now.\n  --remote-debugging-port=9222 \\\n  https://www.chromestatus.com   # URL to open. Defaults to about:blank.\n```\n\n- chrome 命令设置：\n\n```shell\nalias chrome=\"/Applications/Google\\ Chrome.app/Contents/MacOS/Google\\ Chrome\"\nalias chrome-canary=\"/Applications/Google\\ Chrome\\ Canary.app/Contents/MacOS/Google\\ Chrome\\ Canary\"\nalias chromium=\"/Applications/Chromium.app/Contents/MacOS/Chromium\"\n```\n\nChrome headless mode 提供了很多强大功能：\n\n- 输出 DOM 结构\n\n`--dump-dom` flag 会输出`document.body.innerHTML`\n\n```shell\nchrome --headless --disable-gpu --dump-dom https://www.chromestatus.com/\n```\n\n- 输出 PDF\n\n```shell\nchrome --headless --disable-gpu --print-to-pdf https://www.chromestatus.com/\n```\n\n- 输出截图\n\n```shell\nchrome --headless --disable-gpu --screenshot https://www.chromestatus.com/\n\n# Size of a standard letterhead.\nchrome --headless --disable-gpu --screenshot --window-size=1280,1696 https://www.chromestatus.com/\n\n# Nexus 5x\nchrome --headless --disable-gpu --screenshot --window-size=412,732 https://www.chromestatus.com/\n```\n\n- REPL\n\n`--repl` 会打开一个 JS Console\n\n```shell\n$ chrome --headless --disable-gpu --repl https://www.chromestatus.com/\n[0608/112805.245285:INFO:headless_shell.cc(278)] Type a Javascript expression to evaluate or \"quit\" to exit.\n\u003e\u003e\u003e location.href\n{\"result\":{\"type\":\"string\",\"value\":\"https://www.chromestatus.com/features\"}}\n\u003e\u003e\u003e quit\n$\n```\n\n- 远程调试\n\n`--remote-debugging-port=9222` 会打开调试端口，调试基于`DevTools protocol`协议可\n以通过编辑器连接，来进行远程调试。\n\n### Node 编程接口\n\n**The Puppeteer API**\n\nPuppeteer is a Node library developed by the Chrome team. It provides a\nhigh-level API to control headless (or full) Chrome. It's similar to other\nautomated testing libraries like Phantom and NightmareJS, but it only works with\nthe latest versions of Chrome.\n\nAmong other things, Puppeteer can be used to easily take screenshots, create\nPDFs, navigate pages, and fetch information about those pages. I recommend the\nlibrary if you want to quickly automate browser testing. It hides away the\ncomplexities of the DevTools protocol and takes care of redundant tasks like\nlaunching a debug instance of Chrome.\n\nInstall it:\n\n```shell\nyarn add puppeteer\n```\n\nExample - print the user agent\n\n```js\nconst puppeteer = require('puppeteer');\n\n(async () =\u003e {\n  const browser = await puppeteer.launch();\n  console.log(await browser.version());\n  browser.close();\n})();\n```\n\nExample - taking a screenshot of the page\n\n```js\nconst puppeteer = require('puppeteer');\n\n(async () =\u003e {\n  const browser = await puppeteer.launch();\n  const page = await browser.newPage();\n  await page.goto('https://www.chromestatus.com', {waitUntil: 'networkidle'});\n  await page.pdf({path: 'page.pdf', format: 'A4'});\n\n  browser.close();\n})();\n```\n\nCheck out\n[Puppeteer's documentation](https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md)\nto learn more about the full API.\n\n## Firefox\n\nHeadless Firefox works on Fx55+ on Linux, and 56+ on Windows/Mac.\n\n从 Firefox 57 开始，Firefox 开始支持截图\n\n```\n/path/to/firefox -headless -screenshot https://developer.mozilla.com\n```\n\n- `-screenshot` name url — Set a custom name for the screenshot by including it\n  between the -screenshot flag and the URL you want to capture. Note that you\n  can specify other web-compatible image formats such as .jpg, .bmp, etc.\n- `--window-size=x` — Set a custom viewport width when taking the screenshot\n  (full height is maintained). Note that the single argument version of this\n  doesn't work.\n- `--window-size=x,y` — Set a custom viewport width and height to capture.\n\nFirefox headless 模式可以用于自动化测试，基于`Selenium`。\n\nMDN 的[`headless-example`](https://github.com/mdn/headless-examples)\n","date":"2017-11-30","id":10,"slug":"headless-browser","title":"无界面浏览器 - Firefox, Chrome"},"lightCss":"pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-built_in,.hljs-class .hljs-title,.hljs-title.class_{color:#c18401}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}","darkCss":"pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-built_in,.hljs-class .hljs-title,.hljs-title.class_{color:#e6c07b}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}"},"__N_SSG":true},"page":"/blogs/[slug]","query":{"slug":"headless-browser"},"buildId":"vfCLbnG5uw7a7yAACDtLp","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>