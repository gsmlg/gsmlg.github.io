<!DOCTYPE html><html lang="en"><head><meta name="theme-color" content="#1976d2"/><meta charSet="utf-8"/><meta name="viewport" content="minimum-scale=1, initial-scale=1, width=device-width"/><meta name="theme-color" content="#1976d2"/><title>HTTP缓存控制</title><link rel="icon" href="/favicon.ico"/><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/b38854d43c26436a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b38854d43c26436a.css" data-n-g=""/><link rel="preload" href="/_next/static/css/c2a527101433f11d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c2a527101433f11d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-1fec710eb11e1257.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-d98b4a7f39fdfc80.js" defer=""></script><script src="/_next/static/chunks/pages/_app-b27bb82b89a0207c.js" defer=""></script><script src="/_next/static/chunks/eb1842f2-a90cf2c0740b21ce.js" defer=""></script><script src="/_next/static/chunks/947-db85610286bf6269.js" defer=""></script><script src="/_next/static/chunks/323-385eb9a54df11fe7.js" defer=""></script><script src="/_next/static/chunks/pages/blogs/%5Bslug%5D-62a56e6ae9e142ea.js" defer=""></script><script src="/_next/static/DKv_8M_IsE2a3szVHsP3h/_buildManifest.js" defer=""></script><script src="/_next/static/DKv_8M_IsE2a3szVHsP3h/_ssgManifest.js" defer=""></script><script src="/_next/static/DKv_8M_IsE2a3szVHsP3h/_middlewareManifest.js" defer=""></script><style data-emotion="css "></style></head><body><div id="__next" data-reactroot=""><style data-emotion="css-global o6gwfi">html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;box-sizing:border-box;-webkit-text-size-adjust:100%;}*,*::before,*::after{box-sizing:inherit;}strong,b{font-weight:700;}body{margin:0;color:rgba(0, 0, 0, 0.87);font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;font-size:1rem;line-height:1.5;letter-spacing:0.00938em;background-color:#fff;}@media print{body{background-color:#fff;}}body::backdrop{background-color:#fff;}</style><section class="css-1vqbnt3"><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation4 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionStatic css-1x7skt0"><div class="MuiToolbar-root MuiToolbar-gutters MuiToolbar-regular css-191lty2"><div status="[object Object]" class="css-ad3hhb"></div><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-colorInherit MuiIconButton-sizeLarge css-1l1167e" tabindex="0" type="button" aria-label="Menu"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" viewBox="0 0 24 24" aria-hidden="true" data-testid="MenuIcon"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></button><p class="MuiTypography-root MuiTypography-body1 css-1ikde92" type="title"><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/">Home</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/blogs">Blog</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/presentations">Presentation</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/tools">Tool</a></button><button class="MuiButton-root MuiButton-text MuiButton-textInherit MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-colorInherit MuiButtonBase-root  css-b7766g" tabindex="0" type="button"><a href="/games">Game</a></button></p></div></header><section class="css-xxwux"><div class="MuiPaper-root MuiPaper-elevation MuiPaper-rounded MuiPaper-elevation4 css-gnirli"><header><h1 class="MuiTypography-root MuiTypography-body1 css-9l3uo3">HTTP缓存控制</h1><div class="MuiTypography-root MuiTypography-body1 css-9l3uo3">Author:<!-- -->Gao</div><div class="MuiTypography-root MuiTypography-body1 css-9l3uo3">Created At:<!-- -->2018-08-08</div></header><hr class="MuiDivider-root MuiDivider-fullWidth css-39bbo6"/><section class="MuiTypography-root MuiTypography-body1 blog-content css-9l3uo3"><div class="css-1xqzmcn"><h1>HTTP 缓存控制</h1>
<p>HTTP 协议是 WWW 的通讯协议，用于处理互联网上成百上千的应用请求</p>
<p>HTTP 中的缓存是非常重要的，线上服务可以处理成千上万的请求，很大程度上，都依赖缓
存</p>
<p>HTTP 协议中定义了在 HTTP 请求中如何缓存数据</p>
<h2>Expires 响应头</h2>
<p>指定内容缓存失效时间</p>
<pre><code class="hljs language-apache"><span class="hljs-comment"># Expires: &lt;http-date&gt;</span>
<span class="hljs-comment"># Exampale</span>
<span class="hljs-attribute">Expires</span>: Wed, <span class="hljs-number">21</span> Oct <span class="hljs-number">2015</span> <span class="hljs-number">07</span>:<span class="hljs-number">28</span>:<span class="hljs-number">00</span> GMT
</code></pre>
<p>表明缓存可以保存的时间，如果当前时间早于这个时间，那么可以使用缓存的副本，可以不
向服务器再次请求</p>
<h2>Cache-Control 响应头</h2>
<h3><code>max-age</code></h3>
<p>指定缓存生存时间</p>
<p>示例：</p>
<pre><code class="hljs language-ini">Cache-Control: <span class="hljs-attr">max-age</span>=<span class="hljs-number">3600</span>
</code></pre>
<p>表示当收到响应后，在 3600 秒内，如果再次请求数据，可以使用缓存的副本，不需要再次
向服务器请求数据</p>
<h3><code>public</code></h3>
<p>表示这是一个开放资源，可以进行缓存</p>
<h3><code>private</code></h3>
<p>表示这是一个私有资源，代理服务器不得缓存</p>
<h3><code>must-revalidate</code></h3>
<p>当发生请求时，必须向服务器再次验证数据</p>
<h2>验证数据相关响应头</h2>
<h3><code>Etag</code></h3>
<p>用于验证当前数据的内容版本的标示符</p>
<p>这可以让缓存更高效，并节省带宽，因为如果内容没有改变，Web 服务器不需要发送完整的
响应。而如果内容发生了变化，使用 ETag 有助于防止资源的同时更新相互覆盖（“空中碰
撞”）。</p>
<p>如果给定 URL 中的资源更改，则一定要生成新的 Etag 值。 因此 Etags 类似于指纹，也
可能被某些服务器用于跟踪。 比较 etags 能快速确定此资源是否变化，但也可能被跟踪服
务器永久存留。</p>
<pre><code class="hljs language-vbnet"><span class="hljs-symbol">ETag:</span> W/<span class="hljs-string">&quot;&lt;etag_value&gt;&quot;</span>
<span class="hljs-symbol">ETag:</span> <span class="hljs-string">&quot;&lt;etag_value&gt;&quot;</span>
</code></pre>
<ul>
<li>
<p>/W &#x27;W/&#x27;(大小写敏感) 表示使用弱验证器。 弱验证器很容易生成，但不利于比较。 强验
证器是比较的理想选择，但很难有效地生成。 相同资源的两个弱 Etag 值可能语义等同
，但不是每个字节都相同。</p>
</li>
<li>
<p>&quot;&lt;etag_value&gt;&quot; 实体标签唯一地表示所请求的资源。 它们是位于双引号之间的 ASCII
字符串（如“675af34563dc-tr34”）。</p>
</li>
</ul>
<h4>避免“空中碰撞”</h4>
<p>在 <code>ETag</code> 和 <code>If-Match</code> 头部的帮助下，可以检测到&quot;空中碰撞&quot;的编辑冲突。</p>
<p>在 <code>POST</code> 请求头中包含 <code>If-Match</code> 头来检查是否最新版本。</p>
<pre><code class="hljs language-sql">If<span class="hljs-operator">-</span><span class="hljs-keyword">Match</span>: &quot;33a64df551&quot;
</code></pre>
<p>如果哈希值不匹配，则发送 412 前提条件失败错误</p>
<h4>缓存未更改的资源</h4>
<p>当用户再次请求对应资源时，会携带<code>if-none-match</code>头来</p>
<pre><code class="hljs language-sql">If<span class="hljs-operator">-</span><span class="hljs-keyword">None</span><span class="hljs-operator">-</span><span class="hljs-keyword">Match</span>: &quot;33a64df551&quot;
</code></pre>
<p>服务器收到后，检查是否和当前<code>etag</code>匹配，如果相同，则发送 304 响应，不包含任何内
容，标示客户端可以使用缓存数据</p>
<h3><code>last-modified</code></h3>
<p>包含源头服务器认定的资源做出修改的日期及时间。</p>
<p>它通常被用作一个验证器来判断接收到的或者存储的资源是否彼此一致。由于精确度比
<code>ETag</code> 要低，所以这是一个备用机制。</p>
<pre><code class="hljs language-sql"><span class="hljs-keyword">Last</span><span class="hljs-operator">-</span>Modified: <span class="hljs-operator">&lt;</span><span class="hljs-keyword">day</span><span class="hljs-operator">-</span>name<span class="hljs-operator">&gt;</span>, <span class="hljs-operator">&lt;</span><span class="hljs-keyword">day</span><span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">month</span><span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">year</span><span class="hljs-operator">&gt;</span> <span class="hljs-operator">&lt;</span><span class="hljs-keyword">hour</span><span class="hljs-operator">&gt;</span>:<span class="hljs-operator">&lt;</span><span class="hljs-keyword">minute</span><span class="hljs-operator">&gt;</span>:<span class="hljs-operator">&lt;</span><span class="hljs-keyword">second</span><span class="hljs-operator">&gt;</span> GMT
</code></pre>
<ul>
<li><code>&lt;day-name&gt;</code> &quot;Mon&quot;, &quot;Tue&quot;, &quot;Wed&quot;, &quot;Thu&quot;, &quot;Fri&quot;, &quot;Sat&quot; 或 &quot;Sun&quot; 之一 （区分大小
写）。</li>
<li><code>&lt;day&gt;</code> 两位数字表示的天数, 例如&quot;04&quot; or &quot;23&quot;。</li>
<li><code>&lt;month&gt;</code> &quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;,
&quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot; 之一（区分大小写）。</li>
<li><code>&lt;year&gt;</code> 4 位数字表示的年份, 例如 &quot;1990&quot; 或者&quot;2016&quot;。</li>
<li><code>&lt;hour&gt;</code> 两位数字表示的小时数, 例如 &quot;09&quot; 或者 &quot;23&quot;。</li>
<li><code>&lt;minute&gt;</code> 两位数字表示的分钟数，例如&quot;04&quot; 或者 &quot;59&quot;。</li>
<li><code>&lt;second&gt;</code> 两位数字表示的秒数，例如 &quot;04&quot; 或者 &quot;59&quot;。</li>
<li><code>GMT</code> 国际标准时间。HTTP 中的时间均用国际标准时间表示，从来不使用当地时间。</li>
</ul>
<h4>避免“空中碰撞”</h4>
<p>在 <code>Last-Modified</code> 和 <code>If-Unmodified-Since</code> 头部的帮助下，可以检测到&quot;空中碰撞&quot;的
编辑冲突。</p>
<p>在 <code>POST</code> 请求头中包含 <code>If-Unmodified-Since</code> 头来检查是否最新版本。</p>
<pre><code class="hljs language-excel"><span class="hljs-built_in">If</span>-Unmodified-<span class="hljs-built_in">Sin</span><span class="hljs-symbol">ce:</span> &lt;<span class="hljs-built_in">day</span>-name&gt;, &lt;<span class="hljs-built_in">day</span>&gt; &lt;<span class="hljs-built_in">month</span>&gt; &lt;<span class="hljs-built_in">year</span>&gt; &lt;<span class="hljs-built_in">hour</span>&gt;<span class="hljs-symbol">:</span>&lt;<span class="hljs-built_in">minute</span>&gt;<span class="hljs-symbol">:</span>&lt;<span class="hljs-built_in">second</span>&gt; GMT
</code></pre>
<p>如果请求资源在时间之后做了修改，则返回 412 前提条件失败错误</p>
<h4>缓存未更改的资源</h4>
<p>当用户再次请求对应资源时，会携带<code>If-Modified-Since</code>头来匹配资源，如果在给定日期
后做了修改，则需要正常响应</p>
<pre><code class="hljs language-excel"><span class="hljs-built_in">If</span>-Modified-<span class="hljs-built_in">Sin</span><span class="hljs-symbol">ce:</span> &lt;<span class="hljs-built_in">day</span>-name&gt;, &lt;<span class="hljs-built_in">day</span>&gt; &lt;<span class="hljs-built_in">month</span>&gt; &lt;<span class="hljs-built_in">year</span>&gt; &lt;<span class="hljs-built_in">hour</span>&gt;<span class="hljs-symbol">:</span>&lt;<span class="hljs-built_in">minute</span>&gt;<span class="hljs-symbol">:</span>&lt;<span class="hljs-built_in">second</span>&gt; GMT
</code></pre>
<p>服务器收到后，检查是否和当前<code>If-Modified-Since</code>时间，如果在给定日期后没有修改，
则发送 304 响应，不包含任何内容，标示客户端可以使用缓存数据</p></div></section></div></section><footer style="margin-top:0" class="css-6haedj"><div class="container"><span id="icp-info" class="css-z2a085">京ICP备20014476号-2</span><span>Copyright © 2017-2021 GSMLG - Powered by GSMLG Web.</span></div></footer></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"slug":"http-cache","blog":{"author":"Gao","content":"# HTTP 缓存控制\n\nHTTP 协议是 WWW 的通讯协议，用于处理互联网上成百上千的应用请求\n\nHTTP 中的缓存是非常重要的，线上服务可以处理成千上万的请求，很大程度上，都依赖缓\n存\n\nHTTP 协议中定义了在 HTTP 请求中如何缓存数据\n\n## Expires 响应头\n\n指定内容缓存失效时间\n\n```\n# Expires: \u003chttp-date\u003e\n# Exampale\nExpires: Wed, 21 Oct 2015 07:28:00 GMT\n```\n\n表明缓存可以保存的时间，如果当前时间早于这个时间，那么可以使用缓存的副本，可以不\n向服务器再次请求\n\n## Cache-Control 响应头\n\n### `max-age`\n\n指定缓存生存时间\n\n示例：\n\n```\nCache-Control: max-age=3600\n```\n\n表示当收到响应后，在 3600 秒内，如果再次请求数据，可以使用缓存的副本，不需要再次\n向服务器请求数据\n\n### `public`\n\n表示这是一个开放资源，可以进行缓存\n\n### `private`\n\n表示这是一个私有资源，代理服务器不得缓存\n\n### `must-revalidate`\n\n当发生请求时，必须向服务器再次验证数据\n\n## 验证数据相关响应头\n\n### `Etag`\n\n用于验证当前数据的内容版本的标示符\n\n这可以让缓存更高效，并节省带宽，因为如果内容没有改变，Web 服务器不需要发送完整的\n响应。而如果内容发生了变化，使用 ETag 有助于防止资源的同时更新相互覆盖（“空中碰\n撞”）。\n\n如果给定 URL 中的资源更改，则一定要生成新的 Etag 值。 因此 Etags 类似于指纹，也\n可能被某些服务器用于跟踪。 比较 etags 能快速确定此资源是否变化，但也可能被跟踪服\n务器永久存留。\n\n```\nETag: W/\"\u003cetag_value\u003e\"\nETag: \"\u003cetag_value\u003e\"\n```\n\n- /W 'W/'(大小写敏感) 表示使用弱验证器。 弱验证器很容易生成，但不利于比较。 强验\n  证器是比较的理想选择，但很难有效地生成。 相同资源的两个弱 Etag 值可能语义等同\n  ，但不是每个字节都相同。\n\n- \"\u003cetag_value\u003e\" 实体标签唯一地表示所请求的资源。 它们是位于双引号之间的 ASCII\n  字符串（如“675af34563dc-tr34”）。\n\n#### 避免“空中碰撞”\n\n在 `ETag` 和 `If-Match` 头部的帮助下，可以检测到\"空中碰撞\"的编辑冲突。\n\n在 `POST` 请求头中包含 `If-Match` 头来检查是否最新版本。\n\n```\nIf-Match: \"33a64df551\"\n```\n\n如果哈希值不匹配，则发送 412 前提条件失败错误\n\n#### 缓存未更改的资源\n\n当用户再次请求对应资源时，会携带`if-none-match`头来\n\n```\nIf-None-Match: \"33a64df551\"\n```\n\n服务器收到后，检查是否和当前`etag`匹配，如果相同，则发送 304 响应，不包含任何内\n容，标示客户端可以使用缓存数据\n\n### `last-modified`\n\n包含源头服务器认定的资源做出修改的日期及时间。\n\n它通常被用作一个验证器来判断接收到的或者存储的资源是否彼此一致。由于精确度比\n`ETag` 要低，所以这是一个备用机制。\n\n```\nLast-Modified: \u003cday-name\u003e, \u003cday\u003e \u003cmonth\u003e \u003cyear\u003e \u003chour\u003e:\u003cminute\u003e:\u003csecond\u003e GMT\n```\n\n- `\u003cday-name\u003e` \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\" 或 \"Sun\" 之一 （区分大小\n  写）。\n- `\u003cday\u003e` 两位数字表示的天数, 例如\"04\" or \"23\"。\n- `\u003cmonth\u003e` \"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\",\n  \"Oct\", \"Nov\", \"Dec\" 之一（区分大小写）。\n- `\u003cyear\u003e` 4 位数字表示的年份, 例如 \"1990\" 或者\"2016\"。\n- `\u003chour\u003e` 两位数字表示的小时数, 例如 \"09\" 或者 \"23\"。\n- `\u003cminute\u003e` 两位数字表示的分钟数，例如\"04\" 或者 \"59\"。\n- `\u003csecond\u003e` 两位数字表示的秒数，例如 \"04\" 或者 \"59\"。\n- `GMT` 国际标准时间。HTTP 中的时间均用国际标准时间表示，从来不使用当地时间。\n\n#### 避免“空中碰撞”\n\n在 `Last-Modified` 和 `If-Unmodified-Since` 头部的帮助下，可以检测到\"空中碰撞\"的\n编辑冲突。\n\n在 `POST` 请求头中包含 `If-Unmodified-Since` 头来检查是否最新版本。\n\n```\nIf-Unmodified-Since: \u003cday-name\u003e, \u003cday\u003e \u003cmonth\u003e \u003cyear\u003e \u003chour\u003e:\u003cminute\u003e:\u003csecond\u003e GMT\n```\n\n如果请求资源在时间之后做了修改，则返回 412 前提条件失败错误\n\n#### 缓存未更改的资源\n\n当用户再次请求对应资源时，会携带`If-Modified-Since`头来匹配资源，如果在给定日期\n后做了修改，则需要正常响应\n\n```\nIf-Modified-Since: \u003cday-name\u003e, \u003cday\u003e \u003cmonth\u003e \u003cyear\u003e \u003chour\u003e:\u003cminute\u003e:\u003csecond\u003e GMT\n```\n\n服务器收到后，检查是否和当前`If-Modified-Since`时间，如果在给定日期后没有修改，\n则发送 304 响应，不包含任何内容，标示客户端可以使用缓存数据\n","date":"2018-08-08","id":23,"slug":"http-cache","title":"HTTP缓存控制"},"lightCss":"pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-built_in,.hljs-class .hljs-title,.hljs-title.class_{color:#c18401}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}","darkCss":"pre code.hljs{display:block;overflow-x:auto;padding:1em}code.hljs{padding:3px 5px}.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta .hljs-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-built_in,.hljs-class .hljs-title,.hljs-title.class_{color:#e6c07b}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}"},"__N_SSG":true},"page":"/blogs/[slug]","query":{"slug":"http-cache"},"buildId":"DKv_8M_IsE2a3szVHsP3h","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>